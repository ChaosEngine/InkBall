!function(t){function e(e){for(var i,r,s=e[0],o=e[1],a=0,h=[];a<s.length;a++)r=s[a],Object.prototype.hasOwnProperty.call(n,r)&&n[r]&&h.push(n[r][0]),n[r]=0;for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i]);for(l&&l(e);h.length;)h.shift()()}var i={},n={1:0};function r(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.e=function(t){var e=[],i=n[t];if(0!==i)if(i)e.push(i[2]);else{var s=new Promise((function(e,r){i=n[t]=[e,r]}));e.push(i[2]=s);var o,a=document.createElement("script");a.charset="utf-8",a.timeout=120,r.nc&&a.setAttribute("nonce",r.nc),a.src=function(t){return r.p+""+({0:"concavemanDeps",2:"svgvml",3:"svgvmlMin"}[t]||t)+"Bundle.js"}(t);var l=new Error;o=function(e){a.onerror=a.onload=null,clearTimeout(h);var i=n[t];if(0!==i){if(i){var r=e&&("load"===e.type?"missing":e.type),s=e&&e.target&&e.target.src;l.message="Loading chunk "+t+" failed.\n("+r+": "+s+")",l.name="ChunkLoadError",l.type=r,l.request=s,i[1](l)}n[t]=void 0}};var h=setTimeout((function(){o({type:"timeout",target:a})}),12e4);a.onerror=a.onload=o,document.head.appendChild(a)}return Promise.all(e)},r.m=t,r.c=i,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="../js/",r.oe=function(t){throw console.error(t),t};var s=window.webpackJsonp=window.webpackJsonp||[],o=s.push.bind(s);s.push=e,s=s.slice();for(var a=0;a<s.length;a++)e(s[a]);var l=o;r(r.s=0)}([function(t,e,i){"use strict";function n(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return r(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return r(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,s=function(){};return{s:s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return a=t.done,t},e:function(t){l=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(l)throw o}}}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function s(t,e,i,n,r,s,o){try{var a=t[s](o),l=a.value}catch(t){return void i(t)}a.done?e(l):Promise.resolve(l).then(n,r)}function o(t){return function(){var e=this,i=arguments;return new Promise((function(n,r){var o=t.apply(e,i);function a(t){s(o,n,r,a,l,"next",t)}function l(t){s(o,n,r,a,l,"throw",t)}a(void 0)}))}}function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=m(t);if(e){var r=m(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return u(this,i)}}function u(t,e){return!e||"object"!==a(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function m(t){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function f(t,e,i){return e&&_(t.prototype,e),i&&_(t,i),t}var S,v,p,y,g,P,b,O,R=Object.freeze({POINT_FREE_RED:-3,POINT_FREE_BLUE:-2,POINT_FREE:-1,POINT_STARTING:0,POINT_IN_PATH:1,POINT_OWNED_BY_RED:2,POINT_OWNED_BY_BLUE:3}),I=Object.freeze({UNKNOWN:-1,PING:0,POINT:1,PATH:2,PLAYER_JOINING:3,PLAYER_SURRENDER:4,WIN:5,POINTS_AND_PATHS:6,USER_SETTINGS:7,STOP_AND_DRAW:8}),C=Object.freeze({FIRST_CAPTURE:0,FIRST_5_CAPTURES:1,FIRST_5_PATHS:2,FIRST_5_ADVANTAGE_PATHS:3}),w=Object.freeze({RED_WINS:0,GREEN_WINS:1,NO_WIN:2,DRAW_WIN:3}),G=function(){function t(){d(this,t)}return f(t,[{key:"GetKind",value:function(){throw new Error("missing GetKind implementation!")}}]),t}(),L=function(t){l(i,t);var e=c(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:R.POINT_FREE,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return d(this,i),(t=e.call(this)).iId=n,t.iGameId=r,t.iPlayerId=s,t.iX=o,t.iY=a,t.Status=l,t.iEnclosingPathId=h,t}return f(i,[{key:"GetKind",value:function(){return I.POINT}}],[{key:"Format",value:function(t,e){var i="("+e.iX+","+e.iY+" - ";switch(void 0!==e.Status?e.Status:e.status){case R.POINT_FREE_RED:i+="red";break;case R.POINT_FREE_BLUE:i+="blue";break;case R.POINT_FREE:i+="";break;case R.POINT_STARTING:i+="starting";break;case R.POINT_IN_PATH:i+="path";break;case R.POINT_OWNED_BY_RED:i+="owned by red";break;case R.POINT_OWNED_BY_BLUE:i+="owned by blue";break;default:throw new Error("Bad point type!")}return t+" places "+i+") point"}}]),i}(G),E=function(t){l(i,t);var e=c(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return d(this,i),(t=e.call(this)).iId=n,t.iGameId=r,t.iPlayerId=s,t.PointsAsString=o,t.OwnedPointsAsString=a,t}return f(i,[{key:"GetKind",value:function(){return I.PATH}}],[{key:"Format",value:function(t,e){var i="(".concat(e.PointsAsString||e.pointsAsString,") [").concat(e.OwnedPointsAsString||e.ownedPointsAsString,"]");return"".concat(t," places ").concat(i," path")}}]),i}(G),D=function(t){l(i,t);var e=c(i);function i(t,n,r){var s;return d(this,i),(s=e.call(this)).OtherPlayerId=t,s.OtherPlayerName=n,s.Message=r,s}return f(i,[{key:"GetKind",value:function(){return I.PLAYER_JOINING}}],[{key:"Format",value:function(t){return t.Message||t.message}}]),i}(G),T=function(t){l(i,t);var e=c(i);function i(t,n,r){var s;return d(this,i),(s=e.call(this)).OtherPlayerId=t,s.thisOrOtherPlayerSurrenders=n,s.Message=r,s}return f(i,[{key:"GetKind",value:function(){return I.PLAYER_SURRENDER}}],[{key:"Format",value:function(t){return t.Message||t.message}}]),i}(G),N=function(t){l(i,t);var e=c(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return d(this,i),(t=e.call(this)).Message=n,t}return f(i,[{key:"GetKind",value:function(){return I.PING}}],[{key:"Format",value:function(t,e){return t+" says '"+(e.Message||e.message)+"'"}}]),i}(G),k=function(t){l(i,t);var e=c(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w.NO_WIN,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"null";return d(this,i),(t=e.call(this)).Status=n,t.WinningPlayerId=r,t.Message=s,t}return f(i,[{key:"GetKind",value:function(){return I.WIN}}],[{key:"Format",value:function(t){var e="";switch(void 0!==t.Status?t.Status:t.status){case w.RED_WINS:e="red.";break;case w.GREEN_WINS:e="blue.";break;case w.NO_WIN:e="no one!";break;case w.DRAW_WIN:e="draw!"}return"And the winner is... "+e}}]),i}(G),A=function(t){l(i,t);var e=c(i);function i(){return d(this,i),e.call(this)}return f(i,[{key:"GetKind",value:function(){return I.STOP_AND_DRAW}}],[{key:"Format",value:function(t){return"User "+t+" started to draw path"}}]),i}(G),W=function(t){l(i,t);var e=c(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return d(this,i),(t=e.call(this)).Points=n,t.Paths=r,t}return f(i,[{key:"GetKind",value:function(){return I.POINTS_AND_PATHS}}],[{key:"Deserialize",value:function(t){var e='{ "Points": '.concat(t.Points||t.points,', "Paths": ').concat(t.Paths||t.paths," }");return JSON.parse(e)}}]),i}(G),M=function(t){l(i,t);var e=c(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return d(this,i),(t=e.call(this)).DesktopNotifications=n,t}return f(i,[{key:"GetKind",value:function(){return I.USER_SETTINGS}}],[{key:"Serialize",value:function(t){return JSON.stringify(t)}},{key:"Deserialize",value:function(t){return JSON.parse(t)}}]),i}(G),x=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.countdownSeconds,n=void 0===i?60:i,r=e.labelSelector,s=void 0===r?null:r,o=e.initialStart,a=void 0!==o&&o,l=e.countdownReachedHandler,h=void 0===l?void 0:l;d(this,t),this.countdownSeconds=n,this.totalSeconds=this.countdownSeconds,this.timerID=-1,this.label=null,this.countdownReachedHandler=h,s&&(this.label=document.querySelector(s)),a&&this.Start()}return f(t,[{key:"setTimeFunc",value:function(){--this.totalSeconds<=0?(this.Stop(),this.countdownReachedHandler&&this.countdownReachedHandler(this.label)):this.label&&(this.label.innerHTML=this.pad(parseInt(this.totalSeconds/60))+":"+this.pad(this.totalSeconds%60))}},{key:"pad",value:function(t){var e=t+"";return e.length<2?"0"+e:e}},{key:"Start",value:function(){this.Stop(),this.timerID=setInterval(this.setTimeFunc.bind(this),1e3)}},{key:"Stop",value:function(){this.timerID>0&&clearInterval(this.timerID),this.label&&(this.label.innerHTML="")}},{key:"Reset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.countdownSeconds,i=void 0===e?60:e,n=t.labelSelector,r=void 0===n?null:n,s=t.initialStart,o=void 0!==s&&s,a=t.countdownReachedHandler,l=void 0===a?void 0:a;this.countdownSeconds=i,this.totalSeconds=this.countdownSeconds,this.label=null,this.countdownReachedHandler=l,r&&(this.label=document.querySelector(r)),o&&this.Start()}}]),t}();function $(t){return F.apply(this,arguments)}function F(){return(F=o(regeneratorRuntime.mark((function t(e){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Array.prototype.slice.call(document.getElementsByTagName("script")).map((function(t){return t.src})).find((function(t){return-1!==t.indexOf("inkball")})).split("/").pop(),!(-1!==n.indexOf("min"))){t.next=8;break}return t.next=5,i.e(3).then(i.bind(null,1));case 5:r=t.sent,t.next=11;break;case 8:return t.next=10,i.e(2).then(i.bind(null,2));case 10:r=t.sent;case 11:if(S=r.$createOval,v=r.$createPolyline,p=r.$RemovePolyline,y=r.$createSVGVML,g=r.$createLine,P=r.hasDuplicates,b=r.sortPointsClockwise,-1!==e.iOtherPlayerID){t.next=17;break}return t.next=15,i.e(0).then(i.bind(null,3));case 15:r=t.sent,O=r;case 17:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function B(t){console.log(t)}function Y(t){console.error(t)}function z(t){return X.apply(this,arguments)}function X(){return(X=o(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){return setTimeout(t,e)})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var H=function(){function t(e,i,n,r,s,a,l,h,c){var u=this,m=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],_=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],f=arguments.length>11&&void 0!==arguments[11]&&arguments[11],S=arguments.length>12&&void 0!==arguments[12]?arguments[12]:60,v=arguments.length>13&&void 0!==arguments[13]?arguments[13]:125;d(this,t),this.g_iGameID=e,this.g_iPlayerID=i,this.m_iOtherPlayerId=n,this.m_bIsCPUGame=-1===this.m_iOtherPlayerId,this.GameType=C[c],this.iConnErrCount=0,this.iExponentialBackOffMillis=2e3,this.COLOR_RED="red",this.COLOR_BLUE="blue",this.COLOR_OWNED_RED="#DC143C",this.COLOR_OWNED_BLUE="#8A2BE2",this.DRAWING_PATH_COLOR="black",this.m_bIsWon=!1,this.m_bPointsAndPathsLoaded=!1,this.m_iDelayBetweenMultiCaptures=4e3,this.m_iTooLong2Duration=v,this.m_Timer=null,this.m_ReconnectTimer=null,this.m_WaitStartTime=null,this.m_TimerOpts={countdownSeconds:S,labelSelector:"#debug2",initialStart:!0,countdownReachedHandler:this.CountDownReachedHandler.bind(this)},this.m_iSlowdownLevel=0,this.m_iGridSizeX=0,this.m_iGridSizeY=0,this.m_iGridWidth=0,this.m_iGridHeight=0,this.m_BoardSize=null,this.m_iLastX=-1,this.m_iLastY=-1,this.m_iMouseX=0,this.m_iMouseY=0,this.m_iPosX=0,this.m_iPosY=0,this.m_Screen=null,this.m_Debug=null,this.m_Player2Name=null,this.m_SurrenderButton=null,this.m_sMsgInputSel=null,this.m_sMsgSendButtonSel=null,this.m_sMsgListSel=null,this.m_CancelPath=null,this.m_StopAndDraw=null,this.m_bMouseDown=!1,this.m_bHandlingEvent=!1,this.m_bDrawLines=!1,this.m_sMessage="",this.m_bIsPlayingWithRed=m,this.m_bIsPlayerActive=_,this.m_sDotColor=this.m_bIsPlayingWithRed?this.COLOR_RED:this.COLOR_BLUE,this.m_PointRadius=4,this.m_Line=null,this.m_Lines=[],this.m_Points=new Map,this.m_bViewOnly=f,this.m_MouseCursorOval=null,this.m_ApplicationUserSettings=null,null!==r&&""!==r&&(this.g_SignalRConnection=(new signalR.HubConnectionBuilder).withUrl(r,{transport:l,accessTokenFactory:function(){return"iGameID=".concat(this.g_iGameID,"&iPlayerID=").concat(this.g_iPlayerID)}.bind(this)}).withHubProtocol(a).configureLogging(s).build(),this.g_SignalRConnection.serverTimeoutInMilliseconds=h,this.g_SignalRConnection.onclose(function(){var t=o(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:null!=e&&(Y(e),u.m_Screen.style.cursor="not-allowed",u.iConnErrCount++,setTimeout((function(){return u.Connect()}),4e3+u.iExponentialBackOffMillis*Math.max(u.iConnErrCount,5)));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()))}var e,i,r,s,l,h,c,u,m;return f(t,[{key:"GetPlayerPointsAndPaths",value:(m=o(regeneratorRuntime.mark((function t(){var e,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.m_bPointsAndPathsLoaded){t.next=11;break}return t.next=3,this.g_SignalRConnection.invoke("GetPlayerPointsAndPaths",this.m_bViewOnly,this.g_iGameID);case 3:return e=t.sent,void 0!==(i=W.Deserialize(e)).Points&&this.SetAllPoints(i.Points),void 0!==i.Paths&&this.SetAllPaths(i.Paths),this.m_bPointsAndPathsLoaded=!0,t.abrupt("return",!0);case 11:return t.abrupt("return",!1);case 12:case"end":return t.stop()}}),t,this)}))),function(){return m.apply(this,arguments)})},{key:"Connect",value:(u=o(regeneratorRuntime.mark((function t(){var e,i,n,r,s=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.g_SignalRConnection.start();case 3:if(this.iConnErrCount=0,B("connected; iConnErrCount = "+this.iConnErrCount),!1!==this.m_bViewOnly){t.next=19;break}if(null!==sessionStorage.getItem("ApplicationUserSettings")){t.next=16;break}return t.next=9,this.g_SignalRConnection.invoke("GetUserSettings");case 9:return(e=t.sent)&&(B(e),e=M.Deserialize(e),i=M.Serialize(e),sessionStorage.setItem("ApplicationUserSettings",i)),this.m_ApplicationUserSettings=new M(e.DesktopNotifications),t.next=14,this.GetPlayerPointsAndPaths();case 14:t.next=19;break;case 16:n=sessionStorage.getItem("ApplicationUserSettings"),r=M.Deserialize(n),this.m_ApplicationUserSettings=new M(r.DesktopNotifications);case 19:if(this.m_bPointsAndPathsLoaded){t.next=22;break}return t.next=22,this.GetPlayerPointsAndPaths();case 22:null!==this.m_ApplicationUserSettings&&!0===this.m_ApplicationUserSettings.DesktopNotifications&&this.SetupNotifications(),!0!==this.m_bIsCPUGame||this.m_bIsPlayerActive||this.StartCPUCalculation(),t.next=32;break;case 26:t.prev=26,t.t0=t.catch(0),Y(t.t0+"; iConnErrCount = "+this.iConnErrCount),this.m_Screen.style.cursor="not-allowed",this.iConnErrCount++,setTimeout((function(){return s.Connect()}),4e3+this.iExponentialBackOffMillis*Math.max(this.iConnErrCount,5));case 32:case"end":return t.stop()}}),t,this,[[0,26]])}))),function(){return u.apply(this,arguments)})},{key:"SetupNotifications",value:function(){return window.Notification?"granted"===Notification.permission||void Notification.requestPermission().then((function(t){return"granted"===t||(B("User blocked notifications."),!1)})).catch((function(t){return Y(t),!1})):(B("Browser does not support notifications."),!1)}},{key:"NotifyBrowser",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Hi there!",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"How are you doing?";return!!document.hidden&&(window.Notification?"granted"===Notification.permission?(new Notification(t,{body:e,icon:"../img/homescreen.webp"}),!0):void Notification.requestPermission().then((function(i){return"granted"===i?(new Notification(t,{body:e,icon:"../img/homescreen.webp"}),!0):(B("User blocked notifications."),!1)})).catch((function(t){return Y(t),!1})):(B("Browser does not support notifications."),!1))}},{key:"StartSignalRConnection",value:(c=o(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!==this.g_SignalRConnection){t.next=2;break}return t.abrupt("return",Promise.reject(new Error("signalr conn is null")));case 2:return this.m_bPointsAndPathsLoaded=!e,this.g_SignalRConnection.on("ServerToClientPoint",function(t){if(this.g_iPlayerID!==t.iPlayerId){var e=this.m_Player2Name.innerHTML,i=L.Format(e,t),n=document.createElement("li");n.textContent=i,document.querySelector(this.m_sMsgListSel).appendChild(n),this.NotifyBrowser("New Point",i)}this.ReceivedPointProcessing(t)}.bind(this)),this.g_SignalRConnection.on("ServerToClientPath",function(t){if(Object.prototype.hasOwnProperty.call(t,"PointsAsString")||Object.prototype.hasOwnProperty.call(t,"pointsAsString")){var e=t;if(this.g_iPlayerID!==e.iPlayerId){var i=this.m_Player2Name.innerHTML,n=E.Format(i,e),r=document.createElement("li");r.textContent=n,document.querySelector(this.m_sMsgListSel).appendChild(r),this.NotifyBrowser("New Path",n)}this.ReceivedPathProcessing(e)}else{if(!Object.prototype.hasOwnProperty.call(t,"WinningPlayerId")&&!Object.prototype.hasOwnProperty.call(t,"winningPlayerId"))throw new Error("ServerToClientPath bad GetKind!");var s=t,o=k.Format(s),a=document.createElement("li");a.textContent=o,document.querySelector(this.m_sMsgListSel).appendChild(a),this.ReceivedWinProcessing(s),this.NotifyBrowser("We have a winner",o)}}.bind(this)),this.g_SignalRConnection.on("ServerToClientPlayerJoin",function(t){var e=t.OtherPlayerId||t.otherPlayerId;this.m_iOtherPlayerId=e;var i=D.Format(t),n=document.createElement("li");n.innerHTML='<strong class="text-primary">'.concat(i,"</strong>"),document.querySelector(this.m_sMsgListSel).appendChild(n),null!==this.m_SurrenderButton&&""!==t.OtherPlayerName&&(this.m_Player2Name.innerHTML=t.OtherPlayerName||t.otherPlayerName,this.m_SurrenderButton.value="surrender",this.ShowMobileStatus("Your move")),this.NotifyBrowser("Player joininig",i),this.m_bHandlingEvent=!1}.bind(this)),this.g_SignalRConnection.on("ServerToClientPlayerSurrender",function(t){var e=T.Format(t),i=document.createElement("li");i.innerHTML='<strong class="text-warning">'.concat(e,"</strong>"),document.querySelector(this.m_sMsgListSel).appendChild(i),this.m_bHandlingEvent=!1,e=""===e?"Game interrupted!":e,this.NotifyBrowser("Game interruption",e),alert(e),window.location.href="Games"}.bind(this)),this.g_SignalRConnection.on("ServerToClientPlayerWin",function(t){var e=k.Format(t),i=document.createElement("li");i.innerHTML='<strong class="text-warning">'.concat(e,"</strong>"),document.querySelector(this.m_sMsgListSel).appendChild(i),this.ReceivedWinProcessing(t),this.NotifyBrowser("We have a winner",e)}.bind(this)),this.g_SignalRConnection.on("ServerToClientPing",function(t){var e=this.m_Player2Name.innerHTML,i=N.Format(e,t),n=document.createElement("li");n.textContent=i,document.querySelector(this.m_sMsgListSel).appendChild(n),this.NotifyBrowser("User Message",i)}.bind(this)),this.g_SignalRConnection.on("ServerToClientOtherPlayerDisconnected",function(t){var e={countdownSeconds:5,initialStart:!0,countdownReachedHandler:function(){var e=t,i=document.createElement("li");i.innerHTML='<strong class="text-warning">'.concat(e,"</strong>"),document.querySelector(this.m_sMsgListSel).appendChild(i),this.NotifyBrowser("User disconnected",e),this.m_ReconnectTimer=null}.bind(this)};this.m_ReconnectTimer?this.m_ReconnectTimer.Reset(e):this.m_ReconnectTimer=new x(e)}.bind(this)),this.g_SignalRConnection.on("ServerToClientOtherPlayerConnected",function(t){if(this.m_ReconnectTimer)this.m_ReconnectTimer.Stop(),this.m_ReconnectTimer=null;else{var e=t,i=document.createElement("li");i.innerHTML='<strong class="text-primary">'.concat(e,"</strong>"),document.querySelector(this.m_sMsgListSel).appendChild(i),this.NotifyBrowser("User disconnected",e),this.m_ReconnectTimer=null}}.bind(this)),this.g_SignalRConnection.on("ServerToClientStopAndDraw",function(t){if(t){var e=this.m_Player2Name.innerHTML,i=A.Format(e),n=document.createElement("li");n.innerHTML='<strong class="text-info">'.concat(i,"</strong>"),document.querySelector(this.m_sMsgListSel).appendChild(n),this.NotifyBrowser("User "+e+" started drawing new path",i)}}.bind(this)),!1===this.m_bIsCPUGame&&(document.querySelector(this.m_sMsgSendButtonSel).addEventListener("click",function(t){t.preventDefault();var e=document.querySelector(this.m_sMsgInputSel).value.trim();if(""!==e){var i=new N(e);this.SendAsyncData(i)}}.bind(this),!1),document.querySelector(this.m_sMsgInputSel).addEventListener("keyup",function(t){t.preventDefault(),13===t.keyCode&&document.querySelector(this.m_sMsgSendButtonSel).click()}.bind(this),!1)),t.abrupt("return",this.Connect());case 14:case"end":return t.stop()}}),t,this)}))),function(t){return c.apply(this,arguments)})},{key:"StopSignalRConnection",value:function(){null!==this.g_SignalRConnection&&(this.g_SignalRConnection.stop(),this.m_ReconnectTimer&&this.m_ReconnectTimer.Stop(),this.m_Timer&&this.m_Timer.Stop(),B("Stopped SignalR connection"))}},{key:"Debug",value:function(){switch(arguments.length){case 1:this.m_Debug.innerHTML=arguments.length<=0?void 0:arguments[0];break;case 2:var t=document.getElementById("debug"+(arguments.length<=1?void 0:arguments[1]));t.innerHTML=arguments.length<=0?void 0:arguments[0];break;default:for(var e=0;e<arguments.length;e++){var i=e<0||arguments.length<=e?void 0:arguments[e];if(i){var n=document.getElementById("debug"+e);n&&(n.innerHTML=i)}}}}},{key:"DisableSelection",value:function(t){void 0!==a(t.onselectstart)?t.onselectstart=function(){return!1}:void 0!==a(t.style.MozUserSelect)?t.style.MozUserSelect="none":t.onmousedown=function(){return!1}}},{key:"f_clientWidth",value:function(){return this.f_filterResults(window.innerWidth?window.innerWidth:0,document.documentElement?document.documentElement.clientWidth:0,document.body?document.body.clientWidth:0)}},{key:"f_clientHeight",value:function(){return this.f_filterResults(window.innerHeight?window.innerHeight:0,document.documentElement?document.documentElement.clientHeight:0,document.body?document.body.clientHeight:0)}},{key:"f_scrollLeft",value:function(){return this.f_filterResults(window.pageXOffset?window.pageXOffset:0,document.documentElement?document.documentElement.scrollLeft:0,document.body?document.body.scrollLeft:0)}},{key:"f_scrollTop",value:function(){return this.f_filterResults(window.pageYOffset?window.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)}},{key:"f_filterResults",value:function(t,e,i){var n=t||0;return e&&(!n||n>e)&&(n=e),i&&(!n||n>i)?i:n}},{key:"SetPoint",value:function(t,e,i,n){if(!this.m_Points.has(e*this.m_iGridWidth+t)){var r,s=t*this.m_iGridSizeX,o=e*this.m_iGridSizeY,a=S(this.m_PointRadius,"true");switch(a.$move(s,o,this.m_PointRadius),i){case R.POINT_FREE_RED:r=this.COLOR_RED,a.$SetStatus(i);break;case R.POINT_FREE_BLUE:r=this.COLOR_BLUE,a.$SetStatus(i);break;case R.POINT_FREE:case R.POINT_STARTING:r=this.m_sDotColor,a.$SetStatus(i);break;case R.POINT_IN_PATH:r=this.g_iPlayerID===n?!0===this.m_bIsPlayingWithRed?this.COLOR_RED:this.COLOR_BLUE:!0===this.m_bIsPlayingWithRed?this.COLOR_BLUE:this.COLOR_RED,a.$SetStatus(i);break;case R.POINT_OWNED_BY_RED:r=this.COLOR_OWNED_RED,a.$SetStatus(i);break;case R.POINT_OWNED_BY_BLUE:r=this.COLOR_OWNED_BLUE,a.$SetStatus(i);break;default:alert("bad point")}a.$SetFillColor(r),a.$SetStrokeColor(r),this.m_Points.set(e*this.m_iGridWidth+t,a)}}},{key:"SetAllPoints",value:function(t){var e=this;t.forEach((function(t){e.SetPoint(t[0],t[1],t[2],t[3])}))}},{key:"SetPath",value:function(t,e,i){var r,s,o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=t.split(" "),h="",c="",u=null,m=R.POINT_STARTING,d=n(l);try{for(d.s();!(o=d.n()).done;){var _=o.value;u=_.split(","),r=parseInt(u[0]),s=parseInt(u[1]),null!=(u=this.m_Points.get(s*this.m_iGridWidth+r))&&(u.$SetStatus(m),m=R.POINT_IN_PATH),r*=this.m_iGridSizeX,s*=this.m_iGridSizeY,c+="".concat(h).concat(r,",").concat(s),h=" "}}catch(t){d.e(t)}finally{d.f()}u=l[0].split(","),r=parseInt(u[0]),s=parseInt(u[1]),null!=(u=this.m_Points.get(s*this.m_iGridWidth+r))&&u.$SetStatus(m),r*=this.m_iGridSizeX,s*=this.m_iGridSizeY,c+="".concat(h).concat(r,",").concat(s);var f=v(3,c,i?this.m_sDotColor:e?this.COLOR_BLUE:this.COLOR_RED);f.$SetID(a),this.m_Lines.push(f)}},{key:"SetAllPaths",value:function(t){var e=this;t.forEach((function(t){if(t.iGameId!==e.g_iGameID)throw new Error("Bad game from path!");e.SetPath(t.PointsAsString,e.m_bIsPlayingWithRed,t.iPlayerId===e.g_iPlayerID,t.iId)}))}},{key:"IsPointBelongingToLine",value:function(t,e,i){var r,s=n(t);try{for(s.s();!(r=s.n()).done;){var o=r.value.split(","),a=o[0],l=o[1];if(a===e&&l===i)return!0}}catch(t){s.e(t)}finally{s.f()}return!1}},{key:"pnpoly",value:function(t,e,i,n,r){var s,o,a=!1;for(s=0,o=t-1;s<t;o=s++)(i[s]<=r&&r<i[o]||i[o]<=r&&r<i[s])&&n<(e[o]-e[s])*(r-i[s])/(i[o]-i[s])+e[s]&&(a=!a);return a}},{key:"pnpoly2",value:function(t,e,i){var n,r,s=t.length,o=!1;for(n=0,r=s-1;n<s;r=n++){var a=t[n],l=t[r];(a.y<=i&&i<l.y||l.y<=i&&i<a.y)&&e<(l.x-a.x)*(i-a.y)/(l.y-a.y)+a.x&&(o=!o)}return o}},{key:"SurroundOponentPoints",value:function(){var t,e,i,r=this.m_Line.$GetPointsArray();if(P(r.slice(0,-1).map((function(t){return t.x+"_"+t.y})))||r[0].x!==r[r.length-1].x||r[0].y!==r[r.length-1].y)return{OwnedPoints:void 0,owned:"",path:"",errorDesc:"Points not unique"};this.m_sDotColor===this.COLOR_RED?(t=this.COLOR_BLUE,e=R.POINT_OWNED_BY_RED,i=this.COLOR_OWNED_RED):(t=this.COLOR_RED,e=R.POINT_OWNED_BY_BLUE,i=this.COLOR_OWNED_BLUE);var s,o="",a="",l="",h=[],c=n(this.m_Points.values());try{for(c.s();!(s=c.n()).done;){var u=s.value;if(void 0!==u&&u.$GetFillColor()===t&&[R.POINT_FREE_BLUE,R.POINT_FREE_RED].includes(u.$GetStatus())){var m=u.$GetPosition(),d=m.x,_=m.y;!1!==this.pnpoly2(r,d,_)&&(d/=this.m_iGridSizeX,_/=this.m_iGridSizeY,a+="".concat(l).concat(d,",").concat(_),l=" ",h.push({point:u,revertStatus:u.$GetStatus(),revertFillColor:u.$GetFillColor(),revertStrokeColor:u.$GetStrokeColor()}),u.$SetStatus(e,!0),u.$SetFillColor(i),u.$SetStrokeColor(i))}}}catch(t){c.e(t)}finally{c.f()}return""!==a&&(o=r.map(function(t){var e=t.x,i=t.y;return null===e||null===i?"":(e/=this.m_iGridSizeX,i/=this.m_iGridSizeY,"".concat(e,",").concat(i))}.bind(this)).join(" ")),{OwnedPoints:h,owned:a,PathPoints:[],path:o,errorDesc:"No surrounded points"}}},{key:"IsPointOutsideAllPaths",value:function(t,e){var i,r=t*this.m_iGridSizeX,s=e*this.m_iGridSizeY,o=n(this.m_Lines);try{for(o.s();!(i=o.n()).done;){var a=i.value.$GetPointsArray();if(!1!==this.pnpoly2(a,r,s))return!1}}catch(t){o.e(t)}finally{o.f()}return!0}},{key:"CreateXMLWaitForPlayerRequest",value:function(){}},{key:"CreateXMLPutPointRequest",value:function(t,e){return new L(0,this.g_iGameID,this.g_iPlayerID,t,e,this.m_bIsPlayingWithRed?R.POINT_FREE_RED:R.POINT_FREE_BLUE,0)}},{key:"CreateXMLPutPathRequest",value:function(t){return new E(0,this.g_iGameID,this.g_iPlayerID,t.path,t.owned)}},{key:"SendAsyncData",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;switch(t.GetKind()){case I.POINT:B(L.Format("some player",t)),this.m_bHandlingEvent=!0,this.g_SignalRConnection.invoke("ClientToServerPoint",t).then(function(t){this.ReceivedPointProcessing(t)}.bind(this)).catch(function(t){Y(t.toString()),void 0!==e&&e()}.bind(this));break;case I.PATH:B(E.Format("some player",t)),this.m_bHandlingEvent=!0,this.g_SignalRConnection.invoke("ClientToServerPath",t).then(function(t){if(Object.prototype.hasOwnProperty.call(t,"WinningPlayerId")||Object.prototype.hasOwnProperty.call(t,"winningPlayerId")){var e=t;this.ReceivedWinProcessing(e)}else{if(!Object.prototype.hasOwnProperty.call(t,"PointsAsString")&&!Object.prototype.hasOwnProperty.call(t,"pointsAsString"))throw new Error("ClientToServerPath bad GetKind!");var i=t;this.ReceivedPathProcessing(i)}}.bind(this)).catch(function(t){Y(t.toString()),void 0!==e&&e()}.bind(this));break;case I.PING:this.g_SignalRConnection.invoke("ClientToServerPing",t).then(function(){document.querySelector(this.m_sMsgInputSel).value="",document.querySelector(this.m_sMsgSendButtonSel).disabled="disabled"}.bind(this)).catch((function(t){Y(t.toString())}));break;case I.STOP_AND_DRAW:this.g_SignalRConnection.invoke("ClientToServerStopAndDraw",t).then(function(){this.m_bDrawLines=!0,this.m_iLastX=this.m_iLastY=-1,this.m_Line=null,this.m_bIsPlayerActive=!0,this.m_StopAndDraw.disabled="disabled"}.bind(this)).catch((function(t){Y(t.toString())}));break;default:Y("unknown object")}}},{key:"CountDownReachedHandler",value:function(t){t&&(t.innerHTML=""),this.m_StopAndDraw.disabled=this.m_CancelPath.disabled="disabled",this.m_Timer=null,this.m_bIsPlayerActive=!1}},{key:"ReceivedPointProcessing",value:function(t){var e=t.iX,i=t.iY,n=void 0!==t.Status?t.Status:t.status;this.SetPoint(e,i,n,t.iPlayerId),this.g_iPlayerID!==t.iPlayerId?(this.m_bIsPlayerActive=!0,this.ShowMobileStatus("Oponent has moved, your turn"),this.m_Screen.style.cursor="crosshair",null!==this.m_Line&&this.OnCancelClick(),this.m_StopAndDraw.disabled="",this.m_bDrawLines?this.m_StopAndDraw.value="Draw dot":this.m_StopAndDraw.value="Draw line",this.m_Timer&&(this.m_Timer.Stop(),this.m_Timer=null)):(this.m_bIsPlayerActive=!1,this.ShowMobileStatus("Waiting for oponent move"),this.m_Screen.style.cursor="wait",this.m_CancelPath.disabled="disabled",this.m_StopAndDraw.disabled="",this.m_StopAndDraw.value="Stop and Draw",this.m_Timer?this.m_Timer.Reset(this.m_TimerOpts):this.m_Timer=new x(this.m_TimerOpts),!0!==this.m_bIsCPUGame||this.m_bIsPlayerActive||this.StartCPUCalculation()),this.m_bHandlingEvent=!1}},{key:"ReceivedPathProcessing",value:function(t){if(this.g_iPlayerID!==t.iPlayerId){var e=t.PointsAsString||t.pointsAsString,i=t.OwnedPointsAsString||t.ownedPointsAsString;this.SetPath(e,this.m_sDotColor===this.COLOR_RED,!1,t.iId);var r,s=i.split(" "),o=this.m_sDotColor===this.COLOR_RED?R.POINT_OWNED_BY_RED:R.POINT_OWNED_BY_BLUE,a=this.m_sDotColor===this.COLOR_RED?this.COLOR_OWNED_RED:this.COLOR_OWNED_BLUE,l=n(s);try{for(l.s();!(r=l.n()).done;){var h=r.value.split(","),c=parseInt(h[0]),u=parseInt(h[1]);void 0!==(h=this.m_Points.get(u*this.m_iGridWidth+c))&&(h.$SetStatus(o),h.$SetFillColor(a),h.$SetStrokeColor(a))}}catch(t){l.e(t)}finally{l.f()}this.m_bIsPlayerActive=!0,this.ShowMobileStatus("Oponent has moved, your turn"),this.m_Screen.style.cursor="crosshair",null!==this.m_Line&&this.OnCancelClick(),this.m_StopAndDraw.disabled=""}else{var m=this.m_Line.$GetPointsArray(),d=m[0].x,_=m[0].y;d/=this.m_iGridSizeX,_/=this.m_iGridSizeY;var f=this.m_Points.get(_*this.m_iGridWidth+d);void 0!==f&&f.$SetStatus(R.POINT_IN_PATH),this.m_Line.$SetWidthAndColor(3,this.m_sDotColor),this.m_Line.$SetID(t.iId),this.m_Lines.push(this.m_Line),this.m_iLastX=this.m_iLastY=-1,this.m_Line=null,this.m_bIsPlayerActive=!1,this.ShowMobileStatus("Waiting for oponent move"),this.m_Screen.style.cursor="wait",this.m_StopAndDraw.disabled=this.m_CancelPath.disabled="disabled",!0!==this.m_bIsCPUGame||this.m_bIsPlayerActive||this.StartCPUCalculation()}this.m_bDrawLines?this.m_StopAndDraw.value="Draw dot":this.m_StopAndDraw.value="Draw line",this.m_bHandlingEvent=!1,this.m_Timer&&(this.m_Timer.Stop(),this.m_Timer=null)}},{key:"ReceivedWinProcessing",value:function(t){this.ShowMobileStatus("Win situation"),this.m_bHandlingEvent=!1;var e=k.Format(t),i=void 0!==t.Status?t.Status:t.status,n=t.WinningPlayerId||t.winningPlayerId;((i===w.RED_WINS||i===w.GREEN_WINS)&&n>0||i===w.DRAW_WIN)&&(alert(""===e?"Game won!":e),window.location.href="Games")}},{key:"Check4Win",value:function(t,e,i,n){var r;switch(this.GameType){case C.FIRST_CAPTURE:return t.length>0?this.m_bIsPlayingWithRed?w.RED_WINS:w.GREEN_WINS:e.length>0?this.m_bIsPlayingWithRed?w.GREEN_WINS:w.RED_WINS:w.NO_WIN;case C.FIRST_5_CAPTURES:return r=this.m_bIsPlayingWithRed?R.POINT_OWNED_BY_BLUE:R.POINT_OWNED_BY_RED,n.filter((function(t){return null!==t.iEnclosingPathId&&t.$GetStatus()===r})).length>=5?this.m_bIsPlayingWithRed?w.GREEN_WINS:w.RED_WINS:(r=this.m_bIsPlayingWithRed?R.POINT_OWNED_BY_RED:R.POINT_OWNED_BY_BLUE,i.filter((function(t){return null!==t.iEnclosingPathId&&t.$GetStatus()===r})).length>=5?this.m_bIsPlayingWithRed?w.RED_WINS:w.GREEN_WINS:w.NO_WIN);case C.FIRST_5_PATHS:return e.length>=5?this.m_bIsPlayingWithRed?w.GREEN_WINS:w.RED_WINS:t.length>=5?this.m_bIsPlayingWithRed?w.RED_WINS:w.GREEN_WINS:w.NO_WIN;case C.FIRST_5_ADVANTAGE_PATHS:var s=t.length-e.length;return s>=5?this.m_bIsPlayingWithRed?w.RED_WINS:w.GREEN_WINS:s<=-5?this.m_bIsPlayingWithRed?w.GREEN_WINS:w.RED_WINS:w.NO_WIN;default:throw new Error("Wrong game type")}}},{key:"ShowMobileStatus",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";"???"===this.m_Player2Name.innerHTML?this.m_bIsPlayerActive?this.m_GameStatus.style.color=this.COLOR_RED:this.m_GameStatus.style.color=this.COLOR_BLUE:this.m_bIsPlayerActive?this.m_bIsPlayingWithRed?this.m_GameStatus.style.color=this.COLOR_RED:this.m_GameStatus.style.color=this.COLOR_BLUE:this.m_bIsPlayingWithRed?this.m_GameStatus.style.color=this.COLOR_BLUE:this.m_GameStatus.style.color=this.COLOR_RED,null!==t&&""!==t?this.Debug(t,0):this.Debug("",0)}},{key:"OnMouseMove",value:function(t){var e=this;if(!this.m_bIsPlayerActive||"???"===this.m_Player2Name.innerHTML||!0===this.m_bHandlingEvent||this.iConnErrCount>0)this.iConnErrCount<=0&&!this.m_bIsPlayerActive&&(this.m_Screen.style.cursor="wait");else{var i=(t?t.clientX:window.event.clientX)-this.m_Screen.offsetLeft+this.f_scrollLeft()+.5*this.m_iGridSizeX,n=(t?t.clientY:window.event.clientY)-this.m_Screen.offsetTop+this.f_scrollTop()+.5*this.m_iGridSizeY;i=parseInt(i/this.m_iGridSizeX),n=parseInt(n/this.m_iGridSizeY);var r=i*this.m_iGridSizeX,s=n*this.m_iGridSizeY;if(this.m_MouseCursorOval.$move(r,s,this.m_PointRadius),this.m_MouseCursorOval.$Show(),this.Debug("[".concat(i,",").concat(n,"]"),1),this.m_bDrawLines){if(null!==this.m_Line?this.m_Screen.style.cursor="move":this.m_Screen.style.cursor="crosshair",!0===this.m_bMouseDown&&(this.m_iLastX!==i||this.m_iLastY!==n)&&Math.abs(parseInt(this.m_iLastX-i))<=1&&Math.abs(parseInt(this.m_iLastY-n))<=1&&this.m_iLastX>=0&&this.m_iLastY>=0)if(null!==this.m_Line){var o=this.m_Points.get(this.m_iLastY*this.m_iGridWidth+this.m_iLastX),a=this.m_Points.get(n*this.m_iGridWidth+i);if(this.m_CancelPath.disabled=this.m_Line.$GetLength()>=2?"":"disabled",void 0!==o&&void 0!==a&&o.$GetFillColor()===this.m_sDotColor&&a.$GetFillColor()===this.m_sDotColor){var l=this.m_Line.$ContainsPoint(r,s);if(l<1&&a.$GetStatus()!==R.POINT_STARTING&&!0===this.m_Line.$AppendPoints(r,s,this.m_iGridSizeX))a.$SetStatus(R.POINT_IN_PATH,!0),this.m_iLastX=i,this.m_iLastY=n;else if(1===l&&a.$GetStatus()===R.POINT_STARTING&&!0===this.m_Line.$AppendPoints(r,s,this.m_iGridSizeX)){var h=this.SurroundOponentPoints();h.owned.length>0?(this.Debug("Closing path",0),this.rAF_FrameID=null,this.SendAsyncData(this.CreateXMLPutPathRequest(h),(function(){e.OnCancelClick(),h.OwnedPoints.forEach((function(t){var e=t.point,i=t.revertFillColor,n=t.revertStrokeColor;e.$RevertOldStatus(),e.$SetFillColor(i),e.$SetStrokeColor(n)})),e.m_bHandlingEvent=!1}))):this.Debug("".concat(h.errorDesc?h.errorDesc:"Wrong path",", cancell it or refresh page"),0),this.m_iLastX=i,this.m_iLastY=n}else l>=1&&o.$GetStatus()===R.POINT_IN_PATH&&this.m_Line.$GetPointsString().endsWith("".concat(this.m_iLastX*this.m_iGridSizeX,",").concat(this.m_iLastY*this.m_iGridSizeY))&&(this.m_Line.$GetLength()>2?(o.$RevertOldStatus(),this.m_Line.$RemoveLastPoint(),this.m_iLastX=i,this.m_iLastY=n):this.OnCancelClick())}}else{var c=this.m_Points.get(this.m_iLastY*this.m_iGridWidth+this.m_iLastX),u=this.m_Points.get(n*this.m_iGridWidth+i);if(void 0!==c&&void 0!==u&&c.$GetFillColor()===this.m_sDotColor&&u.$GetFillColor()===this.m_sDotColor){var m=this.m_iLastX*this.m_iGridSizeX,d=this.m_iLastY*this.m_iGridSizeY;this.m_Line=v(6,m+","+d+" "+r+","+s,this.DRAWING_PATH_COLOR),this.m_CancelPath.disabled="",c.$SetStatus(R.POINT_STARTING,!0),u.$SetStatus(R.POINT_IN_PATH,!0),this.m_iLastX=i,this.m_iLastY=n}}}else this.m_Screen.style.cursor="crosshair"}}},{key:"OnMouseDown",value:function(t){var e=this;if(this.m_bIsPlayerActive&&"???"!==this.m_Player2Name.innerHTML&&!0!==this.m_bHandlingEvent&&!(this.iConnErrCount>0)){var i=(t?t.clientX:window.event.clientX)-this.m_Screen.offsetLeft+this.f_scrollLeft()+.5*this.m_iGridSizeX,n=(t?t.clientY:window.event.clientY)-this.m_Screen.offsetTop+this.f_scrollTop()+.5*this.m_iGridSizeY;if(i=this.m_iMouseX=parseInt(i/this.m_iGridSizeX),n=this.m_iMouseY=parseInt(n/this.m_iGridSizeY),this.m_bMouseDown=!0,this.m_bDrawLines){if((this.m_iLastX!==i||this.m_iLastY!==n)&&Math.abs(parseInt(this.m_iLastX-i))<=1&&Math.abs(parseInt(this.m_iLastY-n))<=1&&this.m_iLastX>=0&&this.m_iLastY>=0)if(null!==this.m_Line){var r=this.m_Points.get(this.m_iLastY*this.m_iGridWidth+this.m_iLastX),s=this.m_Points.get(n*this.m_iGridWidth+i);if(this.m_CancelPath.disabled=this.m_Line.$GetLength()>=2?"":"disabled",void 0!==r&&void 0!==s&&r.$GetFillColor()===this.m_sDotColor&&s.$GetFillColor()===this.m_sDotColor){var o=i*this.m_iGridSizeX,a=n*this.m_iGridSizeY,l=this.m_Line.$ContainsPoint(o,a);if(l<1&&s.$GetStatus()!==R.POINT_STARTING&&!0===this.m_Line.$AppendPoints(o,a,this.m_iGridSizeX))s.$SetStatus(R.POINT_IN_PATH,!0),this.m_iLastX=i,this.m_iLastY=n;else if(1===l&&s.$GetStatus()===R.POINT_STARTING&&!0===this.m_Line.$AppendPoints(o,a,this.m_iGridSizeX)){var h=this.SurroundOponentPoints();h.owned.length>0?(this.Debug("Closing path",0),this.rAF_FrameID=null,this.SendAsyncData(this.CreateXMLPutPathRequest(h),(function(){e.OnCancelClick(),h.OwnedPoints.forEach((function(t){var e=t.point,i=t.revertFillColor,n=t.revertStrokeColor;e.$RevertOldStatus(),e.$SetFillColor(i),e.$SetStrokeColor(n)})),e.m_bMouseDown=!1,e.m_bHandlingEvent=!1}))):this.Debug("".concat(h.errorDesc?h.errorDesc:"Wrong path",", cancell it or refresh page"),0),this.m_iLastX=i,this.m_iLastY=n}else l>=1&&r.$GetStatus()===R.POINT_IN_PATH&&this.m_Line.$GetPointsString().endsWith("".concat(this.m_iLastX*this.m_iGridSizeX,",").concat(this.m_iLastY*this.m_iGridSizeY))&&(this.m_Line.$GetLength()>2?(r.$RevertOldStatus(),this.m_Line.$RemoveLastPoint(),this.m_iLastX=i,this.m_iLastY=n):this.OnCancelClick())}}else{var c=this.m_Points.get(this.m_iLastY*this.m_iGridWidth+this.m_iLastX),u=this.m_Points.get(n*this.m_iGridWidth+i);if(void 0!==c&&void 0!==u&&c.$GetFillColor()===this.m_sDotColor&&u.$GetFillColor()===this.m_sDotColor){var m=this.m_iLastX*this.m_iGridSizeX,d=this.m_iLastY*this.m_iGridSizeY,_=i*this.m_iGridSizeX,f=n*this.m_iGridSizeY;this.m_Line=v(6,m+","+d+" "+_+","+f,this.DRAWING_PATH_COLOR),this.m_CancelPath.disabled="",c.$SetStatus(R.POINT_STARTING,!0),u.$SetStatus(R.POINT_IN_PATH,!0)}this.m_iLastX=i,this.m_iLastY=n}else if(this.m_iLastX<0||this.m_iLastY<0){var S=this.m_Points.get(n*this.m_iGridWidth+i);void 0!==S&&S.$GetFillColor()===this.m_sDotColor&&(this.m_iLastX=i,this.m_iLastY=n)}}else{this.m_iLastX=i,this.m_iLastY=n;var p=i,y=n;if(i=p*this.m_iGridSizeX,n=y*this.m_iGridSizeY,void 0!==this.m_Points.get(y*this.m_iGridWidth+p))return void this.Debug("Wrong point - already existing",0);if(!this.IsPointOutsideAllPaths(p,y))return void this.Debug("Wrong point, Point is not outside all paths",0);this.rAF_FrameID=null,this.SendAsyncData(this.CreateXMLPutPointRequest(p,y),(function(){e.m_bMouseDown=!1,e.m_bHandlingEvent=!1}))}}}},{key:"OnMouseUp",value:function(){this.m_bMouseDown=!1}},{key:"OnMouseLeave",value:function(){this.m_MouseCursorOval.$Hide()}},{key:"OnStopAndDraw",value:function(t){if(this.m_Timer)null===this.m_Line&&this.SendAsyncData(new A);else{null!==this.m_Line&&this.OnCancelClick(),this.m_bDrawLines=!this.m_bDrawLines;var e=t.target;this.m_bDrawLines?e.value="Draw dot":e.value="Draw line",this.m_iLastX=this.m_iLastY=-1,this.m_Line=null}}},{key:"OnCancelClick",value:function(){if(this.m_bDrawLines){if(null!==this.m_Line){var t=this.m_Line.$GetPointsArray();this.m_CancelPath.disabled="disabled";var e,i=n(t);try{for(i.s();!(e=i.n()).done;){var r=e.value,s=r.x,o=r.y;if(null!==s&&null!==o){s/=this.m_iGridSizeX,o/=this.m_iGridSizeY;var a=this.m_Points.get(o*this.m_iGridWidth+s);void 0!==a&&a.$RevertOldStatus()}}}catch(t){i.e(t)}finally{i.f()}p(this.m_Line),this.m_Line=null}this.m_iLastX=this.m_iLastY=-1,this.m_Timer&&(this.m_StopAndDraw.disabled="disabled"),this.Debug("",0)}}},{key:"CountPointsDebug",value:function(t){var e="";[{query:"circle:not([z-index])",display:"circles: %s, "},{query:"polyline",display:"lines: %s, "},{query:"circle[data-status='2']",display:"intercepted(P1:%s, "},{query:"circle[data-status='3']",display:"P2:%s)"}].forEach((function(t){var i=document.querySelectorAll(t.query);e+=t.display.replace("%s",i.length)})),document.querySelector(t).innerHTML="SVGs by tags: "+e}},{key:"OnTestBuildCurrentGraph",value:(h=o(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.preventDefault(),B(this.BuildGraph());case 2:case"end":return t.stop()}}),t,this)}))),function(t){return h.apply(this,arguments)})},{key:"OnTestConcaveman",value:(l=o(regeneratorRuntime.mark((function t(e){var i,r,s,o,a,l,h,c,u,m,d,_,f;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.preventDefault(),!((i=this.BuildGraph().vertices.map(function(t){var e=t.$GetPosition();return[e.x/this.m_iGridSizeX,e.y/this.m_iGridSizeX]}.bind(this)))&&i.length>0)){t.next=30;break}r=O.concaveman(i,2,0),v(6,r.map(function(t){return parseInt(t[0])*this.m_iGridSizeX+","+parseInt(t[1])*this.m_iGridSizeY}.bind(this)).join(" "),"green"),B("convex_hull = ".concat(r)),s=r.map(function(t){return{x:t[0],y:t[1]}}.bind(this)),o=b(s),a="var(--orange)",l=n(o),t.prev=10,l.s();case 12:if((h=l.n()).done){t.next=22;break}return c=h.value,u=c.x,m=c.y,d=u*this.m_iGridSizeX,_=m*this.m_iGridSizeY,(f=document.querySelector('svg > circle[cx="'.concat(d,'"][cy="').concat(_,'"]')))&&(f.$SetStrokeColor(a),f.$SetFillColor(a),f.$SetZIndex(100),f.setAttribute("r","6")),t.next=20,z(50);case 20:t.next=12;break;case 22:t.next=27;break;case 24:t.prev=24,t.t0=t.catch(10),l.e(t.t0);case 27:return t.prev=27,l.f(),t.finish(27);case 30:case"end":return t.stop()}}),t,this,[[10,24,27,30]])}))),function(t){return l.apply(this,arguments)})},{key:"OnTestMarkAllCycles",value:(s=o(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),t.t0=B,t.next=4,this.MarkAllCycles(this.BuildGraph());case 4:t.t1=t.sent,(0,t.t0)(t.t1);case 6:case"end":return t.stop()}}),t,this)}))),function(t){return s.apply(this,arguments)})},{key:"OnTestGroupPoints",value:(r=o(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.preventDefault(),v(6,this.GroupPointsRecurse([],this.m_Points.get(9*this.m_iGridWidth+26)).map((function(t){var e=t.$GetPosition();return e.x+","+e.y})).join(" "),"green"),B("game.lastCycle = ".concat(this.lastCycle));case 3:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"OnTestFindFullSurroundedPoints",value:(i=o(regeneratorRuntime.mark((function t(e){var i,r,s,o,a,l,h,c,u,m,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.preventDefault(),i=this.COLOR_RED,r="var(--orange)",s=n(this.m_Points.values()),t.prev=4,s.s();case 6:if((o=s.n()).done){t.next=17;break}if(void 0===(a=o.value)||a.$GetFillColor()!==i||R.POINT_FREE_RED!==a.$GetStatus()){t.next=15;break}if(l=a.$GetPosition(),h=l.x,c=l.y,u=h/this.m_iGridSizeX,m=c/this.m_iGridSizeY,!1!==this.IsPointOutsideAllPaths(u,m)){t.next=13;break}return t.abrupt("continue",15);case 13:(d=document.querySelector('svg > circle[cx="'.concat(h,'"][cy="').concat(c,'"]')))&&(d.$SetStrokeColor(r),d.$SetFillColor(r),d.setAttribute("r","6"));case 15:t.next=6;break;case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(4),s.e(t.t0);case 22:return t.prev=22,s.f(),t.finish(22);case 25:case"end":return t.stop()}}),t,this,[[4,19,22,25]])}))),function(t){return i.apply(this,arguments)})},{key:"PrepareDrawing",value:function(t,e,i,n,r,s,o,a,l,h,c){var u=arguments.length>11&&void 0!==arguments[11]?arguments[11]:125;if(this.m_bIsWon=!1,this.m_iDelayBetweenMultiCaptures=4e3,this.m_iTooLong2Duration=u,this.m_Timer=null,this.m_WaitStartTime=null,this.m_iSlowdownLevel=0,this.m_iLastX=-1,this.m_iLastY=-1,this.m_iMouseX=0,this.m_iMouseY=0,this.m_iPosX=0,this.m_iPosY=0,this.m_bMouseDown=!1,this.m_bHandlingEvent=!1,this.m_bDrawLines=!1,this.m_sMessage="",this.m_sDotColor=this.m_bIsPlayingWithRed?this.COLOR_RED:this.COLOR_BLUE,this.m_Line=null,this.m_Lines=[],this.m_Points=new Map,this.m_Debug=document.getElementById("debug0"),this.m_Player2Name=document.querySelector(e),this.m_GameStatus=document.querySelector(i),this.m_SurrenderButton=document.querySelector(n),this.m_CancelPath=document.querySelector(r),this.m_StopAndDraw=document.querySelector(o),this.m_sMsgInputSel=a,this.m_sMsgListSel=l,this.m_sMsgSendButtonSel=h,this.m_Screen=document.querySelector(t),this.m_Screen){this.m_iPosX=this.m_Screen.offsetLeft,this.m_iPosY=this.m_Screen.offsetTop,this.m_BoardSize={width:parseInt(this.m_Screen.style.width),height:parseInt(this.m_Screen.style.height)};var m=this.m_Screen.clientWidth,d=this.m_Screen.clientHeight;if(this.m_iGridSizeX=parseInt(Math.ceil(m/this.m_BoardSize.width)),this.m_iGridSizeY=parseInt(Math.ceil(d/this.m_BoardSize.height)),this.m_iGridWidth=parseInt(Math.ceil(m/this.m_iGridSizeX)),this.m_iGridHeight=parseInt(Math.ceil(d/this.m_iGridSizeY)),this.rAF_StartTimestamp=null,this.rAF_FrameID=null,this.lastCycle=[],y(this.m_Screen,this.m_Screen.style.width,this.m_Screen.style.height,!0),this.DisableSelection(this.m_Screen),this.m_bViewOnly)document.querySelector(s).innerHTML="back to Game List";else{if(null===this.m_MouseCursorOval&&(this.m_MouseCursorOval=S(this.m_PointRadius,"true"),this.m_MouseCursorOval.$SetFillColor(this.m_sDotColor),this.m_MouseCursorOval.$SetStrokeColor(this.m_sDotColor),this.m_MouseCursorOval.$SetZIndex(-1),this.m_MouseCursorOval.$Hide()),this.m_Screen.onmousedown=this.OnMouseDown.bind(this),this.m_Screen.onmousemove=this.OnMouseMove.bind(this),this.m_Screen.onmouseup=this.OnMouseUp.bind(this),this.m_Screen.onmouseleave=this.OnMouseLeave.bind(this),this.m_CancelPath.onclick=this.OnCancelClick.bind(this),this.m_StopAndDraw.onclick=this.OnStopAndDraw.bind(this),!1===this.m_bIsCPUGame)document.querySelector(this.m_sMsgInputSel).disabled="",document.getElementById("testArea").textContent="";else{var _=0;c.length>_&&(document.querySelector(c[_++]).onclick=this.OnTestBuildCurrentGraph.bind(this)),c.length>_&&(document.querySelector(c[_++]).onclick=this.OnTestConcaveman.bind(this)),c.length>_&&(document.querySelector(c[_++]).onclick=this.OnTestMarkAllCycles.bind(this)),c.length>_&&(document.querySelector(c[_++]).onclick=this.OnTestGroupPoints.bind(this)),c.length>_&&(document.querySelector(c[_++]).onclick=this.OnTestFindFullSurroundedPoints.bind(this));for(var f=document.getElementById("chatSection");f.lastElementChild;)f.removeChild(f.lastElementChild)}this.m_SurrenderButton.disabled="","???"===this.m_Player2Name.innerHTML?(this.ShowMobileStatus("Waiting for other player to connect"),this.m_Screen.style.cursor="wait"):(this.m_SurrenderButton.value="surrender",this.m_bIsPlayerActive?(this.ShowMobileStatus("Your move"),this.m_Screen.style.cursor="crosshair",this.m_StopAndDraw.disabled=""):(this.ShowMobileStatus("Waiting for oponent move"),this.m_Screen.style.cursor="wait"),this.m_bDrawLines?this.m_StopAndDraw.value="Draw dot":this.m_StopAndDraw.value="Draw line")}}else alert("no board")}},{key:"GetRandomInt",value:function(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t}},{key:"FindRandomCPUPoint",value:function(){for(var t,e,i=100;--i>0&&(t=this.GetRandomInt(0,this.m_iGridWidth),e=this.GetRandomInt(0,this.m_iGridHeight),this.m_Points.has(e*this.m_iGridWidth+t)||!this.IsPointOutsideAllPaths(t,e)););return new L(0,this.g_iGameID,-1,t,e,R.POINT_FREE_BLUE,0)}},{key:"CalculateCPUCentroid",value:function(){var t,e,i,r=0,s=0,o=0,a=this.COLOR_RED,l=n(this.m_Points.values());try{for(l.s();!(i=l.n()).done;){var h=i.value;if(void 0!==h&&h.$GetFillColor()===a&&h.$GetStatus()===R.POINT_FREE_RED){var c=h.$GetPosition();t=c.x,e=c.y,t/=this.m_iGridSizeX,e/=this.m_iGridSizeY,r+=t,s+=e,o++}}}catch(t){l.e(t)}finally{l.f()}if(o<=0)return null;t=r/o,e=s/o,t*=this.m_iGridSizeX,e*=this.m_iGridSizeY;var u=parseInt(t/this.m_iGridSizeX),m=parseInt(e/this.m_iGridSizeY);t=u,e=m;for(var d=20;--d>0&&(this.m_Points.has(e*this.m_iGridWidth+t)||!this.IsPointOutsideAllPaths(t,e));)t=this.GetRandomInt(u-2,u+3),e=this.GetRandomInt(m-2,m+3);return d<=0?null:new L(0,this.g_iGameID,-1,t,e,R.POINT_FREE_BLUE,0)}},{key:"BuildGraph",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.freeStat,r=void 0===i?R.POINT_FREE_BLUE:i,s=e.fillCol,o=void 0===s?this.COLOR_BLUE:s,a=e.visuals,l=void 0===a||a,h=[],c=new Map,u=function(t,e){var i=e.$GetStatus();return!(!t.includes(i)||e.$GetFillColor()!==o)},m=function(t,e,i,n,s,o,a){if(e>=0&&e<this.m_iGridWidth&&i>=0&&i<this.m_iGridHeight){var m=this.m_Points.get(i*this.m_iGridWidth+e);if(m&&!0===u([r],m)){var d=m.$GetPosition();if(!1===c.has("".concat(o,",").concat(a,"_").concat(e,",").concat(i))&&!1===c.has("".concat(e,",").concat(i,"_").concat(o,",").concat(a))){var _={from:t,to:m};if(!0===l){var f=g(3,"green");f.$move(n,s,d.x,d.y),_.line=f}if(c.set("".concat(o,",").concat(a,"_").concat(e,",").concat(i),_),!1===h.includes(t))t.adjacents=[m],h.push(t);else h.find((function(e){return e===t})).adjacents.push(m);if(!1===h.includes(m))m.adjacents=[t],h.push(m);else h.find((function(t){return t===m})).adjacents.push(t)}}}}.bind(this),d=n(this.m_Points.values());try{for(d.s();!(t=d.n()).done;){var _=t.value;if(_&&!0===u([r,R.POINT_STARTING,R.POINT_IN_PATH],_)){var f=_.$GetPosition(),S=f.x,v=f.y,p=S/this.m_iGridSizeX,y=v/this.m_iGridSizeY;m(_,p+1,y,S,v,p,y),m(_,p-1,y,S,v,p,y),m(_,p,y-1,S,v,p,y),m(_,p,y+1,S,v,p,y),m(_,p-1,y-1,S,v,p,y),m(_,p+1,y-1,S,v,p,y),m(_,p-1,y+1,S,v,p,y),m(_,p+1,y+1,S,v,p,y)}}}catch(t){d.e(t)}finally{d.f()}return{vertices:h,edges:Array.from(c.values())}}},{key:"IsGraphCyclic",value:function(t){for(var e=t.vertices,i=function(t,e){t.visited=!0;var r,s=n(t.adjacents);try{for(s.s();!(r=s.n()).done;){var o=r.value;if(o.visited){if(o!==e){var a=o.$GetPosition(),l=a.x,h=a.y,c=l/this.m_iGridSizeX,u=h/this.m_iGridSizeY;return B("cycle found at ".concat(c,",").concat(u)),!0}}else if(i(o,t))return!0}}catch(t){s.e(t)}finally{s.f()}return!1}.bind(this),r=0;r<e.length;r++)e[r].visited=!1;for(var s=0;s<e.length;s++)if(!e[s].visited&&i(e[s],-1))return!0;return!1}},{key:"MarkAllCycles",value:(e=o(regeneratorRuntime.mark((function t(e){var i,r,s,a,l,h,c,u,m,d,_,f;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(i=e.vertices,r=i.length,s=new Array(r),a=new Array(r),l=new Array(r),h=new Array(r),c=0;c<r;c++)a[c]=[],s[c]=[];for(u=function t(e,r){if(2!==l[e])if(1!==l[e]){h[e]=r,l[e]=1;var s=i[e];if(s){var o,c=n(s.adjacents);try{for(c.s();!(o=c.n()).done;){var u=o.value,m=i.indexOf(u);m!==h[e]&&t(m,e)}}catch(t){c.e(t)}finally{c.f()}}l[e]=2}else{d++;var _=r;for(a[_].push(d);_!==e;)_=h[_],a[_].push(d)}},m=function(){var t=o(regeneratorRuntime.mark((function t(e,r){var o,a,l,h,c,u,m,_,f,S,v,p,y,g,P,O,I,C,w,G,L,E,D,T,N,k,A,W,M,x,$,F,Y,X,H=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(o=0;o<e;o++)if(void 0!==(a=r[o])&&a.length>0)for(l=0;l<a.length;l++)void 0!==(h=s[a[l]])&&h.push(o);s=s.filter((function(t){return t.length>=4})).sort((function(t,e){return e.length-t.length})),c=[],u=this.COLOR_RED,m=n(this.m_Points.values()),t.prev=5,m.s();case 7:if((_=m.n()).done){t.next=18;break}if(void 0===(f=_.value)||f.$GetFillColor()!==u||R.POINT_FREE_RED!==f.$GetStatus()){t.next=16;break}if(S=f.$GetPosition(),v=S.x,p=S.y,y=v/this.m_iGridSizeX,g=p/this.m_iGridSizeY,!1!==this.IsPointOutsideAllPaths(y,g)){t.next=14;break}return t.abrupt("continue",16);case 14:document.querySelector('svg > circle[cx="'.concat(v,'"][cy="').concat(p,'"]'))&&c.push({x:y,y:g});case 16:t.next=7;break;case 18:t.next=23;break;case 20:t.prev=20,t.t0=t.catch(5),m.e(t.t0);case 23:return t.prev=23,m.f(),t.finish(23);case 26:P=[],O=0;case 28:if(!(O<=d)){t.next=66;break}if(!((I=s[O])&&I.length>0)){t.next=63;break}C="Cycle Number ".concat(O,": "),w=[],G="var(--indigo)",L=I.map(function(t){var e=i[t].$GetPosition();return{x:e.x/this.m_iGridSizeX,y:e.y/this.m_iGridSizeY}}.bind(this)),E=b(L),D=n(E),t.prev=36,D.s();case 38:if((T=D.n()).done){t.next=47;break}return N=T.value,k=N.x,A=N.y,(W=document.querySelector('svg > circle[cx="'.concat(k*this.m_iGridSizeX,'"][cy="').concat(A*this.m_iGridSizeY,'"]')))&&(C+="(".concat(k,",").concat(A,")"),W.$SetStrokeColor(G),W.$SetFillColor(G),W.setAttribute("r","6")),t.next=45,z(50);case 45:t.next=38;break;case 47:t.next=52;break;case 49:t.prev=49,t.t1=t.catch(36),D.e(t.t1);case 52:return t.prev=52,D.f(),t.finish(52);case 55:M="",x="",$=n(c);try{for($.s();!(F=$.n()).done;)Y=F.value,!1!==this.pnpoly2(E,Y.x,Y.y)&&(M+="".concat(x,"(").concat(Y.x,",").concat(Y.y,")"),(X=document.querySelector('svg > circle[cx="'.concat(Y.x*this.m_iGridSizeX,'"][cy="').concat(Y.y*this.m_iGridSizeY,'"]')))&&(X.$SetStrokeColor("var(--yellow)"),X.$SetFillColor("var(--yellow)"),X.setAttribute("r","6")),x=",")}catch(t){$.e(t)}finally{$.f()}w.unshift(C),P.push(w),B(C+(""!==M?" possible intercepts: ".concat(M):"")),Array.from(document.querySelectorAll('svg > circle[fill="'.concat(G,'"][r="6"]'))).forEach((function(t){t.$SetStrokeColor(H.COLOR_BLUE),t.$SetFillColor(H.COLOR_BLUE),t.setAttribute("r","4")}));case 63:O++,t.next=28;break;case 66:return t.abrupt("return",P);case 67:case"end":return t.stop()}}),t,this,[[5,20,23,26],[36,49,52,55]])})));return function(e,i){return t.apply(this,arguments)}}().bind(this),d=0,_=r,f=0;f<r;f++)u(f+1,f);return t.next=12,m(_,a);case 12:return t.abrupt("return",t.sent);case 13:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"GroupPointsRecurse",value:function(t,e){if(void 0===e||t.includes(e))return t;if(!1===[R.POINT_FREE_BLUE,R.POINT_STARTING,R.POINT_IN_PATH].includes(e.$GetStatus())||e.$GetFillColor()!==this.COLOR_BLUE)return t;var i=e.$GetPosition(),n=i.x,r=i.y;n/=this.m_iGridSizeX,r/=this.m_iGridSizeY;var s,o,a=null;if(t.length>0){var l=(a=t[t.length-1]).$GetPosition();if(s=l.x,o=l.y,s/=this.m_iGridSizeX,o/=this.m_iGridSizeY,!(Math.abs(parseInt(s-n))<=1&&Math.abs(parseInt(o-r))<=1))return t;t.push(e)}else t.push(e);if(t.length>2&&null!==a){var h=t[0].$GetPosition();h.x/=this.m_iGridSizeX,h.y/=this.m_iGridSizeY;var c=(a=t[t.length-1]).$GetPosition();if(s=c.x,o=c.y,s/=this.m_iGridSizeX,o/=this.m_iGridSizeY,Math.abs(parseInt(s-h.x))<=1&&Math.abs(parseInt(o-h.y))<=1){var u=[];t.forEach((function(t){return u.push(t)})),this.lastCycle.push(u)}}var m=this.m_Points.get(r*this.m_iGridWidth+n+1),d=this.m_Points.get(r*this.m_iGridWidth+n-1),_=this.m_Points.get((r-1)*this.m_iGridWidth+n),f=this.m_Points.get((r+1)*this.m_iGridWidth+n),S=this.m_Points.get((r-1)*this.m_iGridWidth+n-1),v=this.m_Points.get((r-1)*this.m_iGridWidth+n+1),p=this.m_Points.get((r+1)*this.m_iGridWidth+n-1),y=this.m_Points.get((r+1)*this.m_iGridWidth+n+1);return m&&this.GroupPointsRecurse(t,m),d&&this.GroupPointsRecurse(t,d),_&&this.GroupPointsRecurse(t,_),f&&this.GroupPointsRecurse(t,f),S&&this.GroupPointsRecurse(t,S),v&&this.GroupPointsRecurse(t,v),p&&this.GroupPointsRecurse(t,p),y&&this.GroupPointsRecurse(t,y),t}},{key:"GroupPointsIterative",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.g,i=void 0===e?null:e;if(i){var r,s,o=i.vertices,a=[],l=n(o);try{for(l.s();!(s=l.n()).done;){var h=s.value;r=h;var c=[],u=this.GroupPointsRecurse(c,r);u.length>0&&this.lastCycle.length>0&&(a.push(this.lastCycle),this.lastCycle=[])}}catch(t){l.e(t)}finally{l.f()}return a}}},{key:"rAFCallBack",value:function(t){var e=this;null===this.rAF_StartTimestamp&&(this.rAF_StartTimestamp=t);var i=t-this.rAF_StartTimestamp,n=null,r=this.CalculateCPUCentroid();null===(n=null!==r?r:this.FindRandomCPUPoint())?i<2e3&&(this.rAF_FrameID=window.requestAnimationFrame(this.rAFCallBack.bind(this))):this.SendAsyncData(n,(function(){e.m_bMouseDown=!1,e.m_bHandlingEvent=!1}))}},{key:"StartCPUCalculation",value:function(){null===this.rAF_FrameID&&(this.rAF_FrameID=window.requestAnimationFrame(this.rAFCallBack.bind(this)))}}]),t}();window.addEventListener("load",o(regeneratorRuntime.mark((function t(){var e,i,n,r,s,o,a,l,h,c,u,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=gameOptions.inkBallHubName,i=gameOptions.iGameID,document.getElementById("gameID").innerHTML=i,document.querySelector(".container .inkgame form > input[type='hidden'][name='GameID']").value=i,n=gameOptions.iPlayerID,r=gameOptions.iOtherPlayerID,document.getElementById("playerID").innerHTML=n,s=gameOptions.bPlayingWithRed,o=gameOptions.bPlayerActive,a=gameOptions.gameType,l=gameOptions.protocol,h=gameOptions.servTimeoutMillis,c=gameOptions.isReadonly,u=gameOptions.pathAfterPointDrawAllowanceSecAmount,t.next=16,$(gameOptions);case 16:if((m=new H(i,n,r,e,signalR.LogLevel.Warning,l,signalR.HttpTransportType.None,h,a,s,o,c,u)).PrepareDrawing("#screen","#Player2Name","#gameStatus","#SurrenderButton","#CancelPath","#Pause","#StopAndDraw","#messageInput","#messagesList","#sendButton",["#TestBuildGraph","#TestConcaveman","#TestMarkAllCycles","#TestGroupPoints","#TestFindFullSurroundedPoints"]),null===gameOptions.PointsAsJavaScriptArray){t.next=25;break}return t.next=21,m.StartSignalRConnection(!1);case 21:m.SetAllPoints(gameOptions.PointsAsJavaScriptArray),m.SetAllPaths(gameOptions.PathsAsJavaScriptArray),t.next=27;break;case 25:return t.next=27,m.StartSignalRConnection(!0);case 27:document.getElementsByClassName("whichColor")[0].style.color=s?"red":"blue",m.CountPointsDebug("#debug2"),window.game=m;case 30:case"end":return t.stop()}}),t)})))),window.addEventListener("beforeunload",(function(){window.game&&window.game.StopSignalRConnection()}))}]);