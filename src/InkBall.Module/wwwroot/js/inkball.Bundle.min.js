!function(){"use strict";var e,t,n,i,r,s,a,o,c,u,l={},h={};function m(e){var t=h[e];if(void 0!==t)return t.exports;var n=h[e]={exports:{}};return l[e](n,n.exports,m),n.exports}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,r,s=[],a=!0,o=!1;try{for(n=n.call(e);!(a=(i=n.next()).done)&&(s.push(i.value),!t||s.length!==t);a=!0);}catch(e){o=!0,r=e}finally{try{a||null==n.return||n.return()}finally{if(o)throw r}}return s}(e,t)||S(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=S(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||S(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function y(e,t,n,i,r,s,a){try{var o=e[s](a),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(i,r)}function b(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var s=e.apply(t,n);function a(e){y(s,i,r,a,o,"next",e)}function o(e){y(s,i,r,a,o,"throw",e)}a(void 0)}))}}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=x(e);if(t){var r=x(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return R(this,n)}}function R(e,t){if(t&&("object"===p(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function I(e,t,n){return t&&C(e.prototype,t),n&&C(e,n),e}m.m=l,m.d=function(e,t){for(var n in t)m.o(t,n)&&!m.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},m.f={},m.e=function(e){return Promise.all(Object.keys(m.f).reduce((function(t,n){return m.f[n](e,t),t}),[]))},m.u=function(e){return{51:"shared.Min",712:"shared"}[e]+".Bundle.js"},m.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e={},m.l=function(t,n,i,r){if(e[t])e[t].push(n);else{var s,a;if(void 0!==i)for(var o=document.getElementsByTagName("script"),c=0;c<o.length;c++){var u=o[c];if(u.getAttribute("src")==t){s=u;break}}s||(a=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,m.nc&&s.setAttribute("nonce",m.nc),s.src=t),e[t]=[n];var l=function(n,i){s.onerror=s.onload=null,clearTimeout(h);var r=e[t];if(delete e[t],s.parentNode&&s.parentNode.removeChild(s),r&&r.forEach((function(e){return e(i)})),n)return n(i)},h=setTimeout(l.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=l.bind(null,s.onerror),s.onload=l.bind(null,s.onload),a&&document.head.appendChild(s)}},m.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},m.p="../js/",function(){var e={817:0};m.f.j=function(t,n){var i=m.o(e,t)?e[t]:void 0;if(0!==i)if(i)n.push(i[2]);else{var r=new Promise((function(n,r){i=e[t]=[n,r]}));n.push(i[2]=r);var s=m.p+m.u(t),a=new Error;m.l(s,(function(n){if(m.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var r=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+r+": "+s+")",a.name="ChunkLoadError",a.type=r,a.request=s,i[1](a)}}),"chunk-"+t,t)}};var t=function(t,n){var i,r,s=n[0],a=n[1],o=n[2],c=0;if(s.some((function(t){return 0!==e[t]}))){for(i in a)m.o(a,i)&&(m.m[i]=a[i]);if(o)o(m)}for(t&&t(n);c<s.length;c++)r=s[c],m.o(e,r)&&e[r]&&e[r][0](),e[s[c]]=0},n=self.webpackChunk=self.webpackChunk||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var O=Object.freeze({UNKNOWN:-1,PING:0,POINT:1,PATH:2,PLAYER_JOINING:3,PLAYER_SURRENDER:4,WIN:5,POINTS_AND_PATHS:6,USER_SETTINGS:7,STOP_AND_DRAW:8}),L=Object.freeze({FIRST_CAPTURE:0,FIRST_5_CAPTURES:1,FIRST_5_PATHS:2,FIRST_5_ADVANTAGE_PATHS:3}),G=Object.freeze({RED_WINS:0,GREEN_WINS:1,NO_WIN:2,DRAW_WIN:3}),E=function(){function e(){w(this,e)}return I(e,[{key:"GetKind",value:function(){throw new Error("missing GetKind implementation!")}}]),e}(),D=function(e){g(n,e);var t=k(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:r.POINT_FREE,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return w(this,n),(e=t.call(this)).iId=i,e.iGameId=s,e.iPlayerId=a,e.iX=o,e.iY=c,e.Status=u,e.iEnclosingPathId=l,e}return I(n,[{key:"GetKind",value:function(){return O.POINT}}],[{key:"Format",value:function(e,t){var n="("+t.iX+","+t.iY+" - ";switch(void 0!==t.Status?t.Status:t.status){case r.POINT_FREE_RED:n+="red";break;case r.POINT_FREE_BLUE:n+="blue";break;case r.POINT_FREE:n+="";break;case r.POINT_STARTING:n+="starting";break;case r.POINT_IN_PATH:n+="path";break;case r.POINT_OWNED_BY_RED:n+="owned by red";break;case r.POINT_OWNED_BY_BLUE:n+="owned by blue";break;default:throw new Error("Bad point type!")}return e+" places "+n+") point"}}]),n}(E),T=function(e){g(n,e);var t=k(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return w(this,n),(e=t.call(this)).iId=i,e.iGameId=r,e.iPlayerId=s,e.PointsAsString=a,e.OwnedPointsAsString=o,e}return I(n,[{key:"GetKind",value:function(){return O.PATH}}],[{key:"Format",value:function(e,t){var n="(".concat(t.PointsAsString||t.pointsAsString,") [").concat(t.OwnedPointsAsString||t.ownedPointsAsString,"]");return"".concat(e," places ").concat(n," path")}}]),n}(E),A=function(e){g(n,e);var t=k(n);function n(e,i,r){var s;return w(this,n),(s=t.call(this)).OtherPlayerId=e,s.OtherPlayerName=i,s.Message=r,s}return I(n,[{key:"GetKind",value:function(){return O.PLAYER_JOINING}}],[{key:"Format",value:function(e){return e.Message||e.message}}]),n}(E),N=function(e){g(n,e);var t=k(n);function n(e,i,r){var s;return w(this,n),(s=t.call(this)).OtherPlayerId=e,s.thisOrOtherPlayerSurrenders=i,s.Message=r,s}return I(n,[{key:"GetKind",value:function(){return O.PLAYER_SURRENDER}}],[{key:"Format",value:function(e){return e.Message||e.message}}]),n}(E),W=function(e){g(n,e);var t=k(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return w(this,n),(e=t.call(this)).Message=i,e}return I(n,[{key:"GetKind",value:function(){return O.PING}}],[{key:"Format",value:function(e,t){return e+" says '"+(t.Message||t.message)+"'"}}]),n}(E),M=function(e){g(n,e);var t=k(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G.NO_WIN,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"null";return w(this,n),(e=t.call(this)).Status=i,e.WinningPlayerId=r,e.Message=s,e}return I(n,[{key:"GetKind",value:function(){return O.WIN}}],[{key:"Format",value:function(e){var t="";switch(void 0!==e.Status?e.Status:e.status){case G.RED_WINS:t="red.";break;case G.GREEN_WINS:t="blue.";break;case G.NO_WIN:t="no one!";break;case G.DRAW_WIN:t="draw!"}return"And the winner is... "+t}}]),n}(E),z=function(e){g(n,e);var t=k(n);function n(){return w(this,n),t.call(this)}return I(n,[{key:"GetKind",value:function(){return O.STOP_AND_DRAW}}],[{key:"Format",value:function(e){return"User "+e+" started to draw path"}}]),n}(E),B=function(e){g(n,e);var t=k(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return w(this,n),(e=t.call(this)).Points=i,e.Paths=r,e}return I(n,[{key:"GetKind",value:function(){return O.POINTS_AND_PATHS}}],[{key:"Deserialize",value:function(e){var t='{ "Points": '.concat(e.Points||e.points,', "Paths": ').concat(e.Paths||e.paths," }");return JSON.parse(t)}}]),n}(E),F=function(e){g(n,e);var t=k(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return w(this,n),(e=t.call(this)).DesktopNotifications=i,e}return I(n,[{key:"GetKind",value:function(){return O.USER_SETTINGS}}],[{key:"Serialize",value:function(e){return JSON.stringify(e)}},{key:"Deserialize",value:function(e){return JSON.parse(e)}}]),n}(E),Y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.countdownSeconds,i=void 0===n?60:n,r=t.labelSelector,s=void 0===r?null:r,a=t.initialStart,o=void 0!==a&&a,c=t.countdownReachedHandler,u=void 0===c?void 0:c;w(this,e),this.countdownSeconds=i,this.totalSeconds=this.countdownSeconds,this.timerID=-1,this.label=null,this.countdownReachedHandler=u,s&&(this.label=document.querySelector(s)),o&&this.Start()}return I(e,[{key:"setTimeFunc",value:function(){--this.totalSeconds<=0?(this.Stop(),this.countdownReachedHandler&&this.countdownReachedHandler(this.label)):this.label&&(this.label.innerHTML=this.pad(parseInt(this.totalSeconds/60))+":"+this.pad(this.totalSeconds%60))}},{key:"pad",value:function(e){var t=e+"";return t.length<2?"0"+t:t}},{key:"Start",value:function(){this.Stop(),this.timerID=setInterval(this.setTimeFunc.bind(this),1e3)}},{key:"Stop",value:function(){this.timerID>0&&clearInterval(this.timerID),this.label&&(this.label.innerHTML="")}},{key:"Reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.countdownSeconds,n=void 0===t?60:t,i=e.labelSelector,r=void 0===i?null:i,s=e.initialStart,a=void 0!==s&&s,o=e.countdownReachedHandler,c=void 0===o?void 0:o;this.countdownSeconds=n,this.totalSeconds=this.countdownSeconds,this.label=null,this.countdownReachedHandler=c,r&&(this.label=document.querySelector(r)),a&&this.Start()}}]),e}();function X(){return H.apply(this,arguments)}function H(){return(H=b(regeneratorRuntime.mark((function e(){var l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=Array.prototype.slice.call(document.getElementsByTagName("script")).map((function(e){return e.src})).find((function(e){return-1!==e.indexOf("inkball")})).split("/").pop(),!(-1!==l.indexOf("min"))){e.next=8;break}return e.next=5,m.e(51).then(m.bind(m,980));case 5:t=e.sent,e.next=11;break;case 8:return e.next=10,m.e(712).then(m.bind(m,289));case 10:t=e.sent;case 11:n=t.LocalLog,i=t.LocalError,r=t.StatusEnum,s=t.hasDuplicates,a=t.pnpoly2,o=t.sortPointsClockwise,c=t.Sleep,u=t.isESModuleSupport;case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(){return"#"+Math.floor(16777215*Math.random()).toString(16)}Function.prototype.callAsWorker=function(e,t){var n=this;return new Promise((function(i,r){var s="\n".concat(e?f(e).reduce((function(e,t){return e+t.toString()+"\n"})):"","\n\nself.onmessage = async function (e) { \n\tconst result = await ( ").concat(n.toString(),".call(null, e.data) );\n\n\tself.postMessage( result ); \n}"),a=new Blob([s],{type:"text/javascript"}),o=new Worker(window.URL.createObjectURL(a));o.onmessage=function(e){return i(e.data),o.terminate(),window.URL.revokeObjectURL(a)},o.onerror=function(e){return r(e.message),o.terminate(),window.URL.revokeObjectURL(a)},o.postMessage(t)}))};var q=function(){function e(t,n,r,s,a,o,c,u,l){var h=this,m=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],d=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],_=arguments.length>11&&void 0!==arguments[11]&&arguments[11],p=arguments.length>12&&void 0!==arguments[12]?arguments[12]:60,f=arguments.length>13&&void 0!==arguments[13]?arguments[13]:125;w(this,e),this.g_iGameID=t,this.g_iPlayerID=n,this.m_iOtherPlayerId=r,this.m_bIsCPUGame=-1===this.m_iOtherPlayerId,this.GameType=L[l],this.iConnErrCount=0,this.iExponentialBackOffMillis=2e3,this.COLOR_RED="red",this.COLOR_BLUE="blue",this.COLOR_OWNED_RED="#DC143C",this.COLOR_OWNED_BLUE="#8A2BE2",this.DRAWING_PATH_COLOR="black",this.m_bIsWon=!1,this.m_bPointsAndPathsLoaded=!1,this.m_iDelayBetweenMultiCaptures=4e3,this.m_iTooLong2Duration=f,this.m_Timer=null,this.m_ReconnectTimer=null,this.m_WaitStartTime=null,this.m_TimerOpts={countdownSeconds:p,labelSelector:"#debug2",initialStart:!0,countdownReachedHandler:this.CountDownReachedHandler.bind(this)},this.m_iSlowdownLevel=0,this.m_iGridSizeX=0,this.m_iGridSizeY=0,this.m_iGridWidth=0,this.m_iGridHeight=0,this.m_BoardSize=null,this.m_iLastX=-1,this.m_iLastY=-1,this.m_iMouseX=0,this.m_iMouseY=0,this.m_iPosX=0,this.m_iPosY=0,this.m_Screen=null,this.m_Debug=null,this.m_Player2Name=null,this.m_SurrenderButton=null,this.m_sMsgInputSel=null,this.m_sMsgSendButtonSel=null,this.m_sMsgListSel=null,this.m_CancelPath=null,this.m_StopAndDraw=null,this.m_bMouseDown=!1,this.m_bHandlingEvent=!1,this.m_bDrawLines=!1,this.m_sMessage="",this.m_bIsPlayingWithRed=m,this.m_bIsPlayerActive=d,this.m_sDotColor=this.m_bIsPlayingWithRed?this.COLOR_RED:this.COLOR_BLUE,this.m_PointRadius=4,this.SvgVml=null,this.m_Line=null,this.m_Lines=null,this.m_Points=null,this.m_bViewOnly=_,this.m_MouseCursorOval=null,this.CursorPos={x:-1,y:-1},this.m_ApplicationUserSettings=null,this.m_sLastMoveGameTimeStamp=null,this.m_sVersion=null,this.m_Worker=null,null!==s&&""!==s&&(this.g_SignalRConnection=(new signalR.HubConnectionBuilder).withUrl(s,{transport:c,accessTokenFactory:function(){return"iGameID=".concat(this.g_iGameID,"&iPlayerID=").concat(this.g_iPlayerID)}.bind(this)}).withHubProtocol(o).configureLogging(a).build(),this.g_SignalRConnection.serverTimeoutInMilliseconds=u,this.g_SignalRConnection.onclose(function(){var e=b(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null!=t&&(i(t),h.m_Screen.style.cursor="not-allowed",h.iConnErrCount++,setTimeout((function(){return h.Connect()}),4e3+h.iExponentialBackOffMillis*Math.max(h.iConnErrCount,5)));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))}var l,h,m,f,S,v,y,g,P,k,R,x,C,E,X,H,q,j,V,K,J,Z,$,Q,ee,te,ne,ie,re,se,ae;return I(e,[{key:"GetPlayerPointsAndPaths",value:(ae=b(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==this.m_bPointsAndPathsLoaded){e.next=15;break}return e.next=3,this.g_SignalRConnection.invoke("GetPlayerPointsAndPaths",this.m_bViewOnly,this.g_iGameID);case 3:if(t=e.sent,void 0===(n=B.Deserialize(t)).Points){e.next=8;break}return e.next=8,this.SetAllPoints(n.Points);case 8:if(void 0===n.Paths){e.next=11;break}return e.next=11,this.SetAllPaths(n.Paths);case 11:return this.m_bPointsAndPathsLoaded=!0,e.abrupt("return",!0);case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,this)}))),function(){return ae.apply(this,arguments)})},{key:"Connect",value:(se=b(regeneratorRuntime.mark((function e(){var t,r,s,a,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.g_SignalRConnection.start();case 3:if(this.iConnErrCount=0,n("connected; iConnErrCount = "+this.iConnErrCount),!1!==this.m_bViewOnly){e.next=19;break}if(null!==sessionStorage.getItem("ApplicationUserSettings")){e.next=16;break}return e.next=9,this.g_SignalRConnection.invoke("GetUserSettings");case 9:return(t=e.sent)&&(n(t),t=F.Deserialize(t),r=F.Serialize(t),sessionStorage.setItem("ApplicationUserSettings",r)),this.m_ApplicationUserSettings=new F(t.DesktopNotifications),e.next=14,this.GetPlayerPointsAndPaths();case 14:e.next=19;break;case 16:s=sessionStorage.getItem("ApplicationUserSettings"),a=F.Deserialize(s),this.m_ApplicationUserSettings=new F(a.DesktopNotifications);case 19:if(!1!==this.m_bPointsAndPathsLoaded){e.next=22;break}return e.next=22,this.GetPlayerPointsAndPaths();case 22:null!==this.m_ApplicationUserSettings&&!0===this.m_ApplicationUserSettings.DesktopNotifications&&this.SetupNotifications(),!0!==this.m_bIsCPUGame||this.m_bIsPlayerActive||this.StartCPUCalculation(),e.next=32;break;case 26:e.prev=26,e.t0=e.catch(0),i(e.t0+"; iConnErrCount = "+this.iConnErrCount),this.m_Screen.style.cursor="not-allowed",this.iConnErrCount++,setTimeout((function(){return o.Connect()}),4e3+this.iExponentialBackOffMillis*Math.max(this.iConnErrCount,5));case 32:case"end":return e.stop()}}),e,this,[[0,26]])}))),function(){return se.apply(this,arguments)})},{key:"SetupNotifications",value:function(){return window.Notification?"granted"===Notification.permission||void Notification.requestPermission().then((function(e){return"granted"===e||(n("User blocked notifications."),!1)})).catch((function(e){return i(e),!1})):(n("Browser does not support notifications."),!1)}},{key:"NotifyBrowser",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Hi there!",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"How are you doing?";return!!document.hidden&&(window.Notification?"granted"===Notification.permission?(new Notification(e,{body:t,icon:"../img/homescreen.webp"}),!0):void Notification.requestPermission().then((function(i){return"granted"===i?(new Notification(e,{body:t,icon:"../img/homescreen.webp"}),!0):(n("User blocked notifications."),!1)})).catch((function(e){return i(e),!1})):(n("Browser does not support notifications."),!1))}},{key:"StartSignalRConnection",value:(re=b(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this.g_SignalRConnection){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("signalr conn is null")));case 2:return!1===this.m_bPointsAndPathsLoaded&&(this.m_bPointsAndPathsLoaded=!t),this.g_SignalRConnection.on("ServerToClientPoint",function(){var e=b(regeneratorRuntime.mark((function e(t){var n,i,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.g_iPlayerID!==t.iPlayerId&&(n=this.m_Player2Name.innerHTML,i=D.Format(n,t),(r=document.createElement("li")).textContent=i,document.querySelector(this.m_sMsgListSel).appendChild(r),this.NotifyBrowser("New Point",i)),e.next=3,this.ReceivedPointProcessing(t);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}().bind(this)),this.g_SignalRConnection.on("ServerToClientPath",function(e){if(Object.prototype.hasOwnProperty.call(e,"PointsAsString")||Object.prototype.hasOwnProperty.call(e,"pointsAsString")){var t=e;if(this.g_iPlayerID!==t.iPlayerId){var n=this.m_Player2Name.innerHTML,i=T.Format(n,t),r=document.createElement("li");r.textContent=i,document.querySelector(this.m_sMsgListSel).appendChild(r),this.NotifyBrowser("New Path",i)}this.ReceivedPathProcessing(t)}else{if(!Object.prototype.hasOwnProperty.call(e,"WinningPlayerId")&&!Object.prototype.hasOwnProperty.call(e,"winningPlayerId"))throw new Error("ServerToClientPath bad GetKind!");var s=e,a=M.Format(s),o=document.createElement("li");o.textContent=a,document.querySelector(this.m_sMsgListSel).appendChild(o),this.ReceivedWinProcessing(s),this.NotifyBrowser("We have a winner",a)}}.bind(this)),this.g_SignalRConnection.on("ServerToClientPlayerJoin",function(e){var t=e.OtherPlayerId||e.otherPlayerId;this.m_iOtherPlayerId=t;var n=A.Format(e);document.querySelector(".msgchat").dataset.otherplayerid=t;var i=document.createElement("li");i.innerHTML='<strong class="text-primary">'.concat(n,"</strong>"),document.querySelector(this.m_sMsgListSel).appendChild(i),null!==this.m_SurrenderButton&&""!==e.OtherPlayerName&&(this.m_Player2Name.innerHTML=e.OtherPlayerName||e.otherPlayerName,this.m_SurrenderButton.value="surrender",this.ShowMobileStatus("Your move")),this.NotifyBrowser("Player joininig",n),this.m_bHandlingEvent=!1}.bind(this)),this.g_SignalRConnection.on("ServerToClientPlayerSurrender",function(e){var t=N.Format(e),n=document.createElement("li");n.innerHTML='<strong class="text-warning">'.concat(t,"</strong>"),document.querySelector(this.m_sMsgListSel).appendChild(n),this.m_bHandlingEvent=!1,t=""===t?"Game interrupted!":t,this.NotifyBrowser("Game interruption",t),alert(t),window.location.href="GamesList"}.bind(this)),this.g_SignalRConnection.on("ServerToClientPlayerWin",function(e){var t=M.Format(e),n=document.querySelector(this.m_sMsgListSel);if(null!==n){var i=document.createElement("li");i.innerHTML='<strong class="text-warning">'.concat(t,"</strong>"),n.appendChild(i)}this.ReceivedWinProcessing(e),this.NotifyBrowser("We have a winner",t)}.bind(this)),this.g_SignalRConnection.on("ServerToClientPing",function(e){var t=this.m_Player2Name.innerHTML,n=W.Format(t,e),i=document.createElement("li");i.textContent=n,document.querySelector(this.m_sMsgListSel).appendChild(i),this.NotifyBrowser("User Message",n)}.bind(this)),this.g_SignalRConnection.on("ServerToClientOtherPlayerDisconnected",function(e){var t={countdownSeconds:5,initialStart:!0,countdownReachedHandler:function(){var t=e,n=document.createElement("li");n.innerHTML='<strong class="text-warning">'.concat(t,"</strong>"),document.querySelector(this.m_sMsgListSel).appendChild(n),this.NotifyBrowser("User disconnected",t),this.m_ReconnectTimer=null}.bind(this)};this.m_ReconnectTimer?this.m_ReconnectTimer.Reset(t):this.m_ReconnectTimer=new Y(t)}.bind(this)),this.g_SignalRConnection.on("ServerToClientOtherPlayerConnected",function(e){if(this.m_ReconnectTimer)this.m_ReconnectTimer.Stop(),this.m_ReconnectTimer=null;else{var t=e,n=document.createElement("li");n.innerHTML='<strong class="text-primary">'.concat(t,"</strong>"),document.querySelector(this.m_sMsgListSel).appendChild(n),this.NotifyBrowser("User disconnected",t),this.m_ReconnectTimer=null}}.bind(this)),this.g_SignalRConnection.on("ServerToClientStopAndDraw",function(e){if(e){var t=this.m_Player2Name.innerHTML,n=z.Format(t),i=document.createElement("li");i.innerHTML='<strong class="text-info">'.concat(n,"</strong>"),document.querySelector(this.m_sMsgListSel).appendChild(i),this.NotifyBrowser("User "+t+" started drawing new path",n)}}.bind(this)),!1===this.m_bIsCPUGame&&(document.querySelector(this.m_sMsgSendButtonSel).addEventListener("click",function(){var e=b(regeneratorRuntime.mark((function e(t){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),""!==(n=document.querySelector(this.m_sMsgInputSel).value.trim())){e.next=4;break}return e.abrupt("return");case 4:return i=new W(n),e.next=7,this.SendAsyncData(i);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}().bind(this),!1),document.querySelector(this.m_sMsgInputSel).addEventListener("keyup",function(e){e.preventDefault(),13===e.keyCode&&document.querySelector(this.m_sMsgSendButtonSel).click()}.bind(this),!1)),e.abrupt("return",this.Connect());case 14:case"end":return e.stop()}}),e,this)}))),function(e){return re.apply(this,arguments)})},{key:"StopSignalRConnection",value:function(){null!==this.g_SignalRConnection&&(this.g_SignalRConnection.stop(),this.m_ReconnectTimer&&this.m_ReconnectTimer.Stop(),this.m_Timer&&this.m_Timer.Stop(),n("Stopped SignalR connection"))}},{key:"Debug",value:function(){switch(arguments.length){case 1:this.m_Debug.innerHTML=arguments.length<=0?void 0:arguments[0];break;case 2:var e=document.getElementById("debug"+(arguments.length<=1?void 0:arguments[1]));e.innerHTML=arguments.length<=0?void 0:arguments[0];break;default:for(var t=0;t<arguments.length;t++){var n=t<0||arguments.length<=t?void 0:arguments[t];if(n){var i=document.getElementById("debug"+t);i&&(i.innerHTML=n)}}}}},{key:"DisableSelection",value:function(e){void 0!==p(e.onselectstart)?e.onselectstart=function(){return!1}:void 0!==p(e.style.MozUserSelect)?e.style.MozUserSelect="none":e.onmousedown=function(){return!1}}},{key:"f_clientWidth",value:function(){return this.f_filterResults(window.innerWidth?window.innerWidth:0,document.documentElement?document.documentElement.clientWidth:0,document.body?document.body.clientWidth:0)}},{key:"f_clientHeight",value:function(){return this.f_filterResults(window.innerHeight?window.innerHeight:0,document.documentElement?document.documentElement.clientHeight:0,document.body?document.body.clientHeight:0)}},{key:"f_scrollLeft",value:function(){return this.f_filterResults(window.pageXOffset?window.pageXOffset:0,document.documentElement?document.documentElement.scrollLeft:0,document.body?document.body.scrollLeft:0)}},{key:"f_scrollTop",value:function(){return this.f_filterResults(window.pageYOffset?window.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)}},{key:"f_filterResults",value:function(e,t,n){var i=e||0;return t&&(!i||i>t)&&(i=t),n&&(!i||i>n)?n:i}},{key:"SetPoint",value:(ie=b(regeneratorRuntime.mark((function e(t,n,i,s){var a,o,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.m_Points.has(n*this.m_iGridWidth+t);case 2:if(!e.sent){e.next=4;break}return e.abrupt("return");case 4:a=t*this.m_iGridSizeX,o=n*this.m_iGridSizeY,(c=this.SvgVml.CreateOval(this.m_PointRadius)).move(a,o,this.m_PointRadius),e.t0=i,e.next=e.t0===r.POINT_FREE_RED?11:e.t0===r.POINT_FREE_BLUE?14:e.t0===r.POINT_FREE?17:e.t0===r.POINT_STARTING?20:e.t0===r.POINT_IN_PATH?23:e.t0===r.POINT_OWNED_BY_RED?26:e.t0===r.POINT_OWNED_BY_BLUE?29:32;break;case 11:return u=this.COLOR_RED,c.SetStatus(i),e.abrupt("break",34);case 14:return u=this.COLOR_BLUE,c.SetStatus(i),e.abrupt("break",34);case 17:case 20:return u=this.m_sDotColor,c.SetStatus(i),e.abrupt("break",34);case 23:return u=this.g_iPlayerID===s?!0===this.m_bIsPlayingWithRed?this.COLOR_RED:this.COLOR_BLUE:!0===this.m_bIsPlayingWithRed?this.COLOR_BLUE:this.COLOR_RED,c.SetStatus(i),e.abrupt("break",34);case 26:return u=this.COLOR_OWNED_RED,c.SetStatus(i),e.abrupt("break",34);case 29:return u=this.COLOR_OWNED_BLUE,c.SetStatus(i),e.abrupt("break",34);case 32:return alert("bad point"),e.abrupt("break",34);case 34:return c.SetFillColor(u),c.SetStrokeColor(u),e.next=38,this.m_Points.set(n*this.m_iGridWidth+t,c);case 38:case"end":return e.stop()}}),e,this)}))),function(e,t,n,i){return ie.apply(this,arguments)})},{key:"GetGameStateForIndexedDb",value:function(){return{iGameID:this.g_iGameID,iPlayerID:this.g_iPlayerID,iOtherPlayerId:this.m_iOtherPlayerId,sLastMoveGameTimeStamp:this.m_sLastMoveGameTimeStamp,bPointsAndPathsLoaded:this.m_bPointsAndPathsLoaded,iGridWidth:this.m_iGridWidth,iGridHeight:this.m_iGridHeight,iGridSizeX:this.m_iGridSizeX,iGridSizeY:this.m_iGridSizeY}}},{key:"CreateScreenPointFromIndexedDb",value:function(e,t,n,i){var s,a=e*this.m_iGridSizeX,o=t*this.m_iGridSizeY,c=this.SvgVml.CreateOval(this.m_PointRadius);switch(c.move(a,o,this.m_PointRadius),n){case r.POINT_FREE_RED:s=this.COLOR_RED,c.SetStatus(n);break;case r.POINT_FREE_BLUE:s=this.COLOR_BLUE,c.SetStatus(n);break;case r.POINT_FREE:case r.POINT_STARTING:s=this.m_sDotColor,c.SetStatus(n);break;case r.POINT_IN_PATH:s=i,c.SetStatus(n);break;case r.POINT_OWNED_BY_RED:s=this.COLOR_OWNED_RED,c.SetStatus(n);break;case r.POINT_OWNED_BY_BLUE:s=this.COLOR_OWNED_BLUE,c.SetStatus(n);break;default:alert("bad point")}return c.SetFillColor(s),c.SetStrokeColor(s),c}},{key:"SetAllPoints",value:(ne=b(regeneratorRuntime.mark((function e(t){var n,i,r,s,a,o,c,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=function(e){return e-1},n=function(e){return e-3},e.prev=2,e.next=5,this.m_Points.BeginBulkStorage();case 5:r=_(t),e.prev=6,r.s();case 8:if((s=r.n()).done){e.next=14;break}return a=d(s.value,4),o=a[0],c=a[1],u=a[2],l=a[3],e.next=12,this.SetPoint(o,c,n(u),i(l));case 12:e.next=8;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(6),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:return e.prev=22,e.next=25,this.m_Points.EndBulkStorage();case 25:return e.finish(22);case 26:case"end":return e.stop()}}),e,this,[[2,,22,26],[6,16,19,22]])}))),function(e){return ne.apply(this,arguments)})},{key:"SetPath",value:(te=b(regeneratorRuntime.mark((function e(t,n,i){var s,a,o,c,u,l,h,m,d,p,f,S,v=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=v.length>3&&void 0!==v[3]?v[3]:0,a=t.split(" "),o="",c="",u=null,m=r.POINT_STARTING,d=_(a),e.prev=4,d.s();case 6:if((p=d.n()).done){e.next=21;break}return f=p.value,u=f.split(","),l=parseInt(u[0]),h=parseInt(u[1]),e.next=13,this.m_Points.get(h*this.m_iGridWidth+l);case 13:null!=(u=e.sent)&&(u.SetStatus(m),m=r.POINT_IN_PATH),l*=this.m_iGridSizeX,h*=this.m_iGridSizeY,c+="".concat(o).concat(l,",").concat(h),o=" ";case 19:e.next=6;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(4),d.e(e.t0);case 26:return e.prev=26,d.f(),e.finish(26);case 29:return u=a[0].split(","),l=parseInt(u[0]),h=parseInt(u[1]),e.next=34,this.m_Points.get(h*this.m_iGridWidth+l);case 34:return null!=(u=e.sent)&&u.SetStatus(m),a[0]!==a[a.length-1]&&(l*=this.m_iGridSizeX,h*=this.m_iGridSizeY,c+="".concat(o).concat(l,",").concat(h)),(S=this.SvgVml.CreatePolyline(3,c,i?this.m_sDotColor:n?this.COLOR_BLUE:this.COLOR_RED)).SetID(s),e.next=41,this.m_Lines.push(S);case 41:case"end":return e.stop()}}),e,this,[[4,23,26,29]])}))),function(e,t,n){return te.apply(this,arguments)})},{key:"CreateScreenPathFromIndexedDb",value:(ee=b(regeneratorRuntime.mark((function e(t,n,i){var s,a,o,c,u,l,h,m,d,p,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=t.split(" "),a="",o="",c=null,h=r.POINT_STARTING,m=_(s),e.prev=3,m.s();case 5:if((d=m.n()).done){e.next=20;break}return p=d.value,c=p.split(","),u=parseInt(c[0]),l=parseInt(c[1]),e.next=12,this.m_Points.get(l*this.m_iGridWidth+u);case 12:null!=(c=e.sent)&&(c.SetStatus(h),h=r.POINT_IN_PATH),u*=this.m_iGridSizeX,l*=this.m_iGridSizeY,o+="".concat(a).concat(u,",").concat(l),a=" ";case 18:e.next=5;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(3),m.e(e.t0);case 25:return e.prev=25,m.f(),e.finish(25);case 28:return c=s[0].split(","),u=parseInt(c[0]),l=parseInt(c[1]),e.next=33,this.m_Points.get(l*this.m_iGridWidth+u);case 33:return null!=(c=e.sent)&&c.SetStatus(h),s[0]!==s[s.length-1]&&(u*=this.m_iGridSizeX,l*=this.m_iGridSizeY,o+="".concat(a).concat(u,",").concat(l)),(f=this.SvgVml.CreatePolyline(3,o,n)).SetID(i),e.abrupt("return",f);case 39:case"end":return e.stop()}}),e,this,[[3,22,25,28]])}))),function(e,t,n){return ee.apply(this,arguments)})},{key:"SetAllPaths",value:(Q=b(regeneratorRuntime.mark((function e(t){var n,i,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.m_Lines.BeginBulkStorage();case 3:n=_(t),e.prev=4,n.s();case 6:if((i=n.n()).done){e.next=12;break}return r=i.value,e.next=10,this.SetPath(r.PointsAsString,this.m_bIsPlayingWithRed,r.iPlayerId===this.g_iPlayerID,r.iId);case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),n.e(e.t0);case 17:return e.prev=17,n.f(),e.finish(17);case 20:return e.prev=20,e.next=23,this.m_Lines.EndBulkStorage();case 23:return e.finish(20);case 24:case"end":return e.stop()}}),e,this,[[0,,20,24],[4,14,17,20]])}))),function(e){return Q.apply(this,arguments)})},{key:"IsPointBelongingToLine",value:function(e,t,n){var i,r=_(e);try{for(r.s();!(i=r.n()).done;){var s=d(i.value.split(","),2),a=s[0],o=s[1];if(a===t&&o===n)return!0}}catch(e){r.e(e)}finally{r.f()}return!1}},{key:"SurroundOponentPoints",value:($=b(regeneratorRuntime.mark((function e(){var t,n,i,o,c,u,l,h,m,d,p,f,S,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.m_Line.GetPointsArray(),!s(t.slice(0,-1).map((function(e){return e.x+"_"+e.y})))&&t[0].x===t[t.length-1].x&&t[0].y===t[t.length-1].y){e.next=4;break}return e.abrupt("return",{OwnedPoints:void 0,owned:"",path:"",errorDesc:"Points not unique"});case 4:return this.m_sDotColor===this.COLOR_RED?(n=this.COLOR_BLUE,i=r.POINT_OWNED_BY_RED,o=this.COLOR_OWNED_RED):(n=this.COLOR_RED,i=r.POINT_OWNED_BY_BLUE,o=this.COLOR_OWNED_BLUE),c="",u="",l="",h=[],e.t0=_,e.next=9,this.m_Points.values();case 9:e.t1=e.sent,m=(0,e.t0)(e.t1);try{for(m.s();!(d=m.n()).done;)void 0!==(p=d.value)&&p.GetFillColor()===n&&[r.POINT_FREE_BLUE,r.POINT_FREE_RED].includes(p.GetStatus())&&(f=p.GetPosition(),S=f.x,v=f.y,!1!==a(t,S,v)&&(S/=this.m_iGridSizeX,v/=this.m_iGridSizeY,u+="".concat(l).concat(S,",").concat(v),l=" ",h.push({point:p,revertStatus:p.GetStatus(),revertFillColor:p.GetFillColor(),revertStrokeColor:p.GetStrokeColor()}),p.SetStatus(i,!0),p.SetFillColor(o),p.SetStrokeColor(o)))}catch(e){m.e(e)}finally{m.f()}return""!==u&&(c=t.map(function(e){var t=e.x,n=e.y;return null===t||null===n?"":(t/=this.m_iGridSizeX,n/=this.m_iGridSizeY,"".concat(t,",").concat(n))}.bind(this)).join(" ")),e.abrupt("return",{OwnedPoints:h,owned:u,PathPoints:[],path:c,errorDesc:"No surrounded points"});case 14:case"end":return e.stop()}}),e,this)}))),function(){return $.apply(this,arguments)})},{key:"IsPointOutsideAllPaths",value:(Z=b(regeneratorRuntime.mark((function e(t,n){var i,r,s,o,c,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t*this.m_iGridSizeX,r=n*this.m_iGridSizeY,e.next=3,this.m_Lines.all();case 3:s=e.sent,o=_(s),e.prev=5,o.s();case 7:if((c=o.n()).done){e.next=14;break}if(u=c.value,l=u.GetPointsArray(),!1===a(l,i,r)){e.next=12;break}return e.abrupt("return",!1);case 12:e.next=7;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(5),o.e(e.t0);case 19:return e.prev=19,o.f(),e.finish(19);case 22:return e.abrupt("return",!0);case 23:case"end":return e.stop()}}),e,this,[[5,16,19,22]])}))),function(e,t){return Z.apply(this,arguments)})},{key:"CreateXMLWaitForPlayerRequest",value:function(){}},{key:"CreateXMLPutPointRequest",value:function(e,t){return new D(0,this.g_iGameID,this.g_iPlayerID,e,t,this.m_bIsPlayingWithRed?r.POINT_FREE_RED:r.POINT_FREE_BLUE,0)}},{key:"CreateXMLPutPathRequest",value:function(e){return new T(0,this.g_iGameID,this.g_iPlayerID,e.path,e.owned)}},{key:"SendAsyncData",value:(J=b(regeneratorRuntime.mark((function e(t){var r,s,a,o,c,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=u.length>1&&void 0!==u[1]?u[1]:void 0,e.t0=t.GetKind(),e.next=e.t0===O.POINT?4:e.t0===O.PATH?19:e.t0===O.PING?44:e.t0===O.STOP_AND_DRAW?55:69;break;case 4:return n(D.Format("some player",t)),this.m_bHandlingEvent=!0,e.prev=6,e.next=9,this.g_SignalRConnection.invoke("ClientToServerPoint",t);case 9:return s=e.sent,e.next=12,this.ReceivedPointProcessing(s);case 12:e.next=18;break;case 14:e.prev=14,e.t1=e.catch(6),i(e.t1.toString()),void 0!==r&&r();case 18:return e.abrupt("break",71);case 19:return n(T.Format("some player",t)),this.m_bHandlingEvent=!0,e.prev=21,e.next=24,this.g_SignalRConnection.invoke("ClientToServerPath",t);case 24:if(a=e.sent,!Object.prototype.hasOwnProperty.call(a,"WinningPlayerId")&&!Object.prototype.hasOwnProperty.call(a,"winningPlayerId")){e.next=30;break}o=a,this.ReceivedWinProcessing(o),e.next=37;break;case 30:if(!Object.prototype.hasOwnProperty.call(a,"PointsAsString")&&!Object.prototype.hasOwnProperty.call(a,"pointsAsString")){e.next=36;break}return c=a,e.next=34,this.ReceivedPathProcessing(c);case 34:e.next=37;break;case 36:throw new Error("ClientToServerPath bad GetKind!");case 37:e.next=43;break;case 39:e.prev=39,e.t2=e.catch(21),i(e.t2.toString()),void 0!==r&&r();case 43:return e.abrupt("break",71);case 44:return e.prev=44,e.next=47,this.g_SignalRConnection.invoke("ClientToServerPing",t);case 47:document.querySelector(this.m_sMsgInputSel).value="",document.querySelector(this.m_sMsgSendButtonSel).disabled="disabled",e.next=54;break;case 51:e.prev=51,e.t3=e.catch(44),i(e.t3.toString());case 54:return e.abrupt("break",71);case 55:return e.prev=55,e.next=58,this.g_SignalRConnection.invoke("ClientToServerStopAndDraw",t);case 58:this.m_bDrawLines=!0,this.m_iLastX=this.m_iLastY=-1,this.m_Line=null,this.m_bIsPlayerActive=!0,this.m_StopAndDraw.disabled="disabled",e.next=68;break;case 65:e.prev=65,e.t4=e.catch(55),i(e.t4.toString());case 68:return e.abrupt("break",71);case 69:return i("unknown object"),e.abrupt("break",71);case 71:case"end":return e.stop()}}),e,this,[[6,14],[21,39],[44,51],[55,65]])}))),function(e){return J.apply(this,arguments)})},{key:"CountDownReachedHandler",value:function(e){e&&(e.innerHTML=""),this.m_StopAndDraw.disabled=this.m_CancelPath.disabled="disabled",this.m_Timer=null,this.m_bIsPlayerActive=!1}},{key:"ReceivedPointProcessing",value:(K=b(regeneratorRuntime.mark((function e(t){var n,i,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.iX,i=t.iY,r=void 0!==t.Status?t.Status:t.status,this.m_sLastMoveGameTimeStamp=(void 0!==t.TimeStamp?t.TimeStamp:new Date(t.timeStamp)).toISOString(),e.next=4,this.SetPoint(n,i,r,t.iPlayerId);case 4:if(this.g_iPlayerID===t.iPlayerId){e.next=16;break}if(this.m_bIsPlayerActive=!0,this.ShowMobileStatus("Oponent has moved, your turn"),this.m_Screen.style.cursor="crosshair",null===this.m_Line){e.next=11;break}return e.next=11,this.OnCancelClick();case 11:this.m_StopAndDraw.disabled="",this.m_bDrawLines?this.m_StopAndDraw.value="Draw dot":this.m_StopAndDraw.value="Draw line",this.m_Timer&&(this.m_Timer.Stop(),this.m_Timer=null),e.next=24;break;case 16:this.m_bIsPlayerActive=!1,this.ShowMobileStatus("Waiting for oponent move"),this.m_Screen.style.cursor="wait",this.m_CancelPath.disabled="disabled",this.m_StopAndDraw.disabled="",this.m_StopAndDraw.value="Stop and Draw",this.m_Timer?this.m_Timer.Reset(this.m_TimerOpts):this.m_Timer=new Y(this.m_TimerOpts),!0!==this.m_bIsCPUGame||this.m_bIsPlayerActive||this.StartCPUCalculation();case 24:this.m_bHandlingEvent=!1;case 25:case"end":return e.stop()}}),e,this)}))),function(e){return K.apply(this,arguments)})},{key:"ReceivedPathProcessing",value:(V=b(regeneratorRuntime.mark((function e(t){var n,i,s,a,o,c,u,l,h,m,d,p,f,S,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.m_sLastMoveGameTimeStamp=(void 0!==t.TimeStamp?t.TimeStamp:new Date(t.timeStamp)).toISOString(),this.g_iPlayerID===t.iPlayerId){e.next=38;break}return n=t.PointsAsString||t.pointsAsString,i=t.OwnedPointsAsString||t.ownedPointsAsString,e.next=5,this.SetPath(n,this.m_sDotColor===this.COLOR_RED,!1,t.iId);case 5:s=i.split(" "),a=this.m_sDotColor===this.COLOR_RED?r.POINT_OWNED_BY_RED:r.POINT_OWNED_BY_BLUE,o=this.m_sDotColor===this.COLOR_RED?this.COLOR_OWNED_RED:this.COLOR_OWNED_BLUE,c=_(s),e.prev=9,c.s();case 11:if((u=c.n()).done){e.next=21;break}return l=u.value,h=l.split(","),m=parseInt(h[0]),d=parseInt(h[1]),e.next=17,this.m_Points.get(d*this.m_iGridWidth+m);case 17:void 0!==(h=e.sent)&&(h.SetStatus(a),h.SetFillColor(o),h.SetStrokeColor(o));case 19:e.next=11;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(9),c.e(e.t0);case 26:return e.prev=26,c.f(),e.finish(26);case 29:if(this.m_bIsPlayerActive=!0,this.ShowMobileStatus("Oponent has moved, your turn"),this.m_Screen.style.cursor="crosshair",null===this.m_Line){e.next=35;break}return e.next=35,this.OnCancelClick();case 35:this.m_StopAndDraw.disabled="",e.next=57;break;case 38:return p=this.m_Line.GetPointsArray(),f=p[0].x,S=p[0].y,f/=this.m_iGridSizeX,S/=this.m_iGridSizeY,e.next=44,this.m_Points.get(S*this.m_iGridWidth+f);case 44:return void 0!==(v=e.sent)&&v.SetStatus(r.POINT_IN_PATH),this.m_Line.SetWidthAndColor(3,this.m_sDotColor),this.m_Line.SetID(t.iId),e.next=50,this.m_Lines.push(this.m_Line);case 50:this.m_iLastX=this.m_iLastY=-1,this.m_Line=null,this.m_bIsPlayerActive=!1,this.ShowMobileStatus("Waiting for oponent move"),this.m_Screen.style.cursor="wait",this.m_StopAndDraw.disabled=this.m_CancelPath.disabled="disabled",!0!==this.m_bIsCPUGame||this.m_bIsPlayerActive||this.StartCPUCalculation();case 57:this.m_bDrawLines?this.m_StopAndDraw.value="Draw dot":this.m_StopAndDraw.value="Draw line",this.m_bHandlingEvent=!1,this.m_Timer&&(this.m_Timer.Stop(),this.m_Timer=null);case 60:case"end":return e.stop()}}),e,this,[[9,23,26,29]])}))),function(e){return V.apply(this,arguments)})},{key:"ReceivedWinProcessing",value:function(e){this.ShowMobileStatus("Win situation"),this.m_bHandlingEvent=!1;var t=M.Format(e),n=void 0!==e.Status?e.Status:e.status,i=e.WinningPlayerId||e.winningPlayerId;((n===G.RED_WINS||n===G.GREEN_WINS)&&i>0||n===G.DRAW_WIN)&&(alert(""===t?"Game won!":t),window.location.href="GamesList")}},{key:"Check4Win",value:function(e,t,n,i){var s;switch(this.GameType){case L.FIRST_CAPTURE:return e.length>0?this.m_bIsPlayingWithRed?G.RED_WINS:G.GREEN_WINS:t.length>0?this.m_bIsPlayingWithRed?G.GREEN_WINS:G.RED_WINS:G.NO_WIN;case L.FIRST_5_CAPTURES:return s=this.m_bIsPlayingWithRed?r.POINT_OWNED_BY_BLUE:r.POINT_OWNED_BY_RED,i.filter((function(e){return null!==e.iEnclosingPathId&&e.GetStatus()===s})).length>=5?this.m_bIsPlayingWithRed?G.GREEN_WINS:G.RED_WINS:(s=this.m_bIsPlayingWithRed?r.POINT_OWNED_BY_RED:r.POINT_OWNED_BY_BLUE,n.filter((function(e){return null!==e.iEnclosingPathId&&e.GetStatus()===s})).length>=5?this.m_bIsPlayingWithRed?G.RED_WINS:G.GREEN_WINS:G.NO_WIN);case L.FIRST_5_PATHS:return t.length>=5?this.m_bIsPlayingWithRed?G.GREEN_WINS:G.RED_WINS:e.length>=5?this.m_bIsPlayingWithRed?G.RED_WINS:G.GREEN_WINS:G.NO_WIN;case L.FIRST_5_ADVANTAGE_PATHS:var a=e.length-t.length;return a>=5?this.m_bIsPlayingWithRed?G.RED_WINS:G.GREEN_WINS:a<=-5?this.m_bIsPlayingWithRed?G.GREEN_WINS:G.RED_WINS:G.NO_WIN;default:throw new Error("Wrong game type")}}},{key:"ShowMobileStatus",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";"???"===this.m_Player2Name.innerHTML?this.m_bIsPlayerActive?this.m_GameStatus.style.color=this.COLOR_RED:this.m_GameStatus.style.color=this.COLOR_BLUE:this.m_bIsPlayerActive?this.m_bIsPlayingWithRed?this.m_GameStatus.style.color=this.COLOR_RED:this.m_GameStatus.style.color=this.COLOR_BLUE:this.m_bIsPlayingWithRed?this.m_GameStatus.style.color=this.COLOR_BLUE:this.m_GameStatus.style.color=this.COLOR_RED,null!==e&&""!==e?this.Debug(e,0):this.Debug("",0)}},{key:"OnMouseMove",value:(j=b(regeneratorRuntime.mark((function e(t){var n,i,s,a,o,c,u,l,h,m,d,_,p=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.m_bIsPlayerActive&&"???"!==this.m_Player2Name.innerHTML&&!0!==this.m_bHandlingEvent&&!(this.iConnErrCount>0)){e.next=3;break}return this.iConnErrCount<=0&&!this.m_bIsPlayerActive&&(this.m_Screen.style.cursor="wait"),e.abrupt("return");case 3:if(n=(t?t.clientX:window.event.clientX)-this.m_Screen.offsetLeft+this.f_scrollLeft()+.5*this.m_iGridSizeX,i=(t?t.clientY:window.event.clientY)-this.m_Screen.offsetTop+this.f_scrollTop()+.5*this.m_iGridSizeY,n=parseInt(n/this.m_iGridSizeX),i=parseInt(i/this.m_iGridSizeY),s=n*this.m_iGridSizeX,a=i*this.m_iGridSizeY,this.CursorPos.x===s&&this.CursorPos.y===a||(this.m_MouseCursorOval.move(s,a,this.m_PointRadius),this.m_MouseCursorOval.Show(),this.Debug("[".concat(n,",").concat(i,"]"),1),this.CursorPos.x=s,this.CursorPos.y=a),!this.m_bDrawLines){e.next=67;break}if(null!==this.m_Line?this.m_Screen.style.cursor="move":this.m_Screen.style.cursor="crosshair",!0!==this.m_bMouseDown){e.next=65;break}if(!((this.m_iLastX!==n||this.m_iLastY!==i)&&Math.abs(parseInt(this.m_iLastX-n))<=1&&Math.abs(parseInt(this.m_iLastY-i))<=1&&this.m_iLastX>=0&&this.m_iLastY>=0)){e.next=65;break}if(null===this.m_Line){e.next=58;break}return e.next=17,this.m_Points.get(this.m_iLastY*this.m_iGridWidth+this.m_iLastX);case 17:return o=e.sent,e.next=20,this.m_Points.get(i*this.m_iGridWidth+n);case 20:if(c=e.sent,this.m_CancelPath.disabled=this.m_Line.GetLength()>=2?"":"disabled",void 0===o||void 0===c||o.GetFillColor()!==this.m_sDotColor||c.GetFillColor()!==this.m_sDotColor){e.next=56;break}if(!((u=this.m_Line.ContainsPoint(s,a))<1&&c.GetStatus()!==r.POINT_STARTING&&!0===this.m_Line.AppendPoints(s,a,this.m_iGridSizeX,this.m_iGridSizeY))){e.next=30;break}c.SetStatus(r.POINT_IN_PATH,!0),this.m_iLastX=n,this.m_iLastY=i,e.next=56;break;case 30:if(1!==u||c.GetStatus()!==r.POINT_STARTING||!0!==this.m_Line.AppendPoints(s,a,this.m_iGridSizeX,this.m_iGridSizeY)){e.next=46;break}return e.next=33,this.SurroundOponentPoints();case 33:if(!((l=e.sent).owned.length>0)){e.next=41;break}return this.Debug("Closing path",0),this.rAF_FrameID=null,e.next=39,this.SendAsyncData(this.CreateXMLPutPathRequest(l),b(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.OnCancelClick();case 2:l.OwnedPoints.forEach((function(e){var t=e.point,n=e.revertFillColor,i=e.revertStrokeColor;t.RevertOldStatus(),t.SetFillColor(n),t.SetStrokeColor(i)})),p.m_bHandlingEvent=!1;case 4:case"end":return e.stop()}}),e)}))));case 39:e.next=42;break;case 41:this.Debug("".concat(l.errorDesc?l.errorDesc:"Wrong path",", cancell it or refresh page"),0);case 42:this.m_iLastX=n,this.m_iLastY=i,e.next=56;break;case 46:if(!(u>=1&&o.GetStatus()===r.POINT_IN_PATH&&this.m_Line.GetPointsString().endsWith("".concat(this.m_iLastX*this.m_iGridSizeX,",").concat(this.m_iLastY*this.m_iGridSizeY)))){e.next=56;break}if(!(this.m_Line.GetLength()>2)){e.next=54;break}o.RevertOldStatus(),this.m_Line.RemoveLastPoint(),this.m_iLastX=n,this.m_iLastY=i,e.next=56;break;case 54:return e.next=56,this.OnCancelClick();case 56:e.next=65;break;case 58:return e.next=60,this.m_Points.get(this.m_iLastY*this.m_iGridWidth+this.m_iLastX);case 60:return h=e.sent,e.next=63,this.m_Points.get(i*this.m_iGridWidth+n);case 63:m=e.sent,void 0!==h&&void 0!==m&&h.GetFillColor()===this.m_sDotColor&&m.GetFillColor()===this.m_sDotColor&&(d=this.m_iLastX*this.m_iGridSizeX,_=this.m_iLastY*this.m_iGridSizeY,this.m_Line=this.SvgVml.CreatePolyline(6,d+","+_+" "+s+","+a,this.DRAWING_PATH_COLOR),this.m_CancelPath.disabled="",h.SetStatus(r.POINT_STARTING,!0),m.SetStatus(r.POINT_IN_PATH,!0),this.m_iLastX=n,this.m_iLastY=i);case 65:e.next=68;break;case 67:this.m_Screen.style.cursor="crosshair";case 68:case"end":return e.stop()}}),e,this)}))),function(e){return j.apply(this,arguments)})},{key:"OnMouseDown",value:(q=b(regeneratorRuntime.mark((function e(t){var n,i,s,a,o,c,u,l,h,m,d,_,p,f,S,v,y,g=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.m_bIsPlayerActive&&"???"!==this.m_Player2Name.innerHTML&&!0!==this.m_bHandlingEvent&&!(this.iConnErrCount>0)){e.next=2;break}return e.abrupt("return");case 2:if(n=(t?t.clientX:window.event.clientX)-this.m_Screen.offsetLeft+this.f_scrollLeft()+.5*this.m_iGridSizeX,i=(t?t.clientY:window.event.clientY)-this.m_Screen.offsetTop+this.f_scrollTop()+.5*this.m_iGridSizeY,n=this.m_iMouseX=parseInt(n/this.m_iGridSizeX),i=this.m_iMouseY=parseInt(i/this.m_iGridSizeY),this.m_bMouseDown=!0,this.m_bDrawLines){e.next=31;break}return this.m_iLastX=n,this.m_iLastY=i,a=i,n=(s=n)*this.m_iGridSizeX,i=a*this.m_iGridSizeY,e.next=16,this.m_Points.get(a*this.m_iGridWidth+s);case 16:if(e.t0=e.sent,e.t1=void 0,e.t0===e.t1){e.next=21;break}return this.Debug("Wrong point - already existing",0),e.abrupt("return");case 21:return e.next=23,this.IsPointOutsideAllPaths(s,a);case 23:if(e.sent){e.next=26;break}return this.Debug("Wrong point, Point is not outside all paths",0),e.abrupt("return");case 26:return this.rAF_FrameID=null,e.next=29,this.SendAsyncData(this.CreateXMLPutPointRequest(s,a),(function(){g.m_bMouseDown=!1,g.m_bHandlingEvent=!1}));case 29:e.next=94;break;case 31:if(!((this.m_iLastX!==n||this.m_iLastY!==i)&&Math.abs(parseInt(this.m_iLastX-n))<=1&&Math.abs(parseInt(this.m_iLastY-i))<=1&&this.m_iLastX>=0&&this.m_iLastY>=0)){e.next=89;break}if(null===this.m_Line){e.next=78;break}return e.next=35,this.m_Points.get(this.m_iLastY*this.m_iGridWidth+this.m_iLastX);case 35:return o=e.sent,e.next=38,this.m_Points.get(i*this.m_iGridWidth+n);case 38:if(c=e.sent,this.m_CancelPath.disabled=this.m_Line.GetLength()>=2?"":"disabled",void 0===o||void 0===c||o.GetFillColor()!==this.m_sDotColor||c.GetFillColor()!==this.m_sDotColor){e.next=76;break}if(u=n*this.m_iGridSizeX,l=i*this.m_iGridSizeY,!((h=this.m_Line.ContainsPoint(u,l))<1&&c.GetStatus()!==r.POINT_STARTING&&!0===this.m_Line.AppendPoints(u,l,this.m_iGridSizeX,this.m_iGridSizeY))){e.next=50;break}c.SetStatus(r.POINT_IN_PATH,!0),this.m_iLastX=n,this.m_iLastY=i,e.next=76;break;case 50:if(1!==h||c.GetStatus()!==r.POINT_STARTING||!0!==this.m_Line.AppendPoints(u,l,this.m_iGridSizeX,this.m_iGridSizeY)){e.next=66;break}return e.next=53,this.SurroundOponentPoints();case 53:if(!((m=e.sent).owned.length>0)){e.next=61;break}return this.Debug("Closing path",0),this.rAF_FrameID=null,e.next=59,this.SendAsyncData(this.CreateXMLPutPathRequest(m),b(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.OnCancelClick();case 2:m.OwnedPoints.forEach((function(e){var t=e.point,n=e.revertFillColor,i=e.revertStrokeColor;t.RevertOldStatus(),t.SetFillColor(n),t.SetStrokeColor(i)})),g.m_bMouseDown=!1,g.m_bHandlingEvent=!1;case 5:case"end":return e.stop()}}),e)}))));case 59:e.next=62;break;case 61:this.Debug("".concat(m.errorDesc?m.errorDesc:"Wrong path",", cancell it or refresh page"),0);case 62:this.m_iLastX=n,this.m_iLastY=i,e.next=76;break;case 66:if(!(h>=1&&o.GetStatus()===r.POINT_IN_PATH&&this.m_Line.GetPointsString().endsWith("".concat(this.m_iLastX*this.m_iGridSizeX,",").concat(this.m_iLastY*this.m_iGridSizeY)))){e.next=76;break}if(!(this.m_Line.GetLength()>2)){e.next=74;break}o.RevertOldStatus(),this.m_Line.RemoveLastPoint(),this.m_iLastX=n,this.m_iLastY=i,e.next=76;break;case 74:return e.next=76,this.OnCancelClick();case 76:e.next=87;break;case 78:return e.next=80,this.m_Points.get(this.m_iLastY*this.m_iGridWidth+this.m_iLastX);case 80:return d=e.sent,e.next=83,this.m_Points.get(i*this.m_iGridWidth+n);case 83:_=e.sent,void 0!==d&&void 0!==_&&d.GetFillColor()===this.m_sDotColor&&_.GetFillColor()===this.m_sDotColor&&(p=this.m_iLastX*this.m_iGridSizeX,f=this.m_iLastY*this.m_iGridSizeY,S=n*this.m_iGridSizeX,v=i*this.m_iGridSizeY,this.m_Line=this.SvgVml.CreatePolyline(6,p+","+f+" "+S+","+v,this.DRAWING_PATH_COLOR),this.m_CancelPath.disabled="",d.SetStatus(r.POINT_STARTING,!0),_.SetStatus(r.POINT_IN_PATH,!0)),this.m_iLastX=n,this.m_iLastY=i;case 87:e.next=94;break;case 89:if(!(this.m_iLastX<0||this.m_iLastY<0)){e.next=94;break}return e.next=92,this.m_Points.get(i*this.m_iGridWidth+n);case 92:void 0!==(y=e.sent)&&y.GetFillColor()===this.m_sDotColor&&(this.m_iLastX=n,this.m_iLastY=i);case 94:case"end":return e.stop()}}),e,this)}))),function(e){return q.apply(this,arguments)})},{key:"OnMouseUp",value:function(){this.m_bMouseDown=!1}},{key:"OnMouseLeave",value:function(){this.m_MouseCursorOval.Hide()}},{key:"OnStopAndDraw",value:(H=b(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.m_Timer){e.next=11;break}if(null===this.m_Line){e.next=4;break}return e.next=4,this.OnCancelClick();case 4:this.m_bDrawLines=!this.m_bDrawLines,n=t.target,this.m_bDrawLines?n.value="Draw dot":n.value="Draw line",this.m_iLastX=this.m_iLastY=-1,this.m_Line=null,e.next=14;break;case 11:if(null!==this.m_Line){e.next=14;break}return e.next=14,this.SendAsyncData(new z);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return H.apply(this,arguments)})},{key:"OnCancelClick",value:(X=b(regeneratorRuntime.mark((function e(){var t,n,i,r,s,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.m_bDrawLines){e.next=33;break}if(null===this.m_Line){e.next=30;break}t=this.m_Line.GetPointsArray(),this.m_CancelPath.disabled="disabled",n=_(t),e.prev=5,n.s();case 7:if((i=n.n()).done){e.next=20;break}if(r=i.value,s=r.x,a=r.y,null!==s&&null!==a){e.next=12;break}return e.abrupt("continue",18);case 12:return s/=this.m_iGridSizeX,a/=this.m_iGridSizeY,e.next=16,this.m_Points.get(a*this.m_iGridWidth+s);case 16:void 0!==(o=e.sent)&&o.RevertOldStatus();case 18:e.next=7;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(5),n.e(e.t0);case 25:return e.prev=25,n.f(),e.finish(25);case 28:this.SvgVml.RemovePolyline(this.m_Line),this.m_Line=null;case 30:this.m_iLastX=this.m_iLastY=-1,this.m_Timer&&(this.m_StopAndDraw.disabled="disabled"),this.Debug("",0);case 33:case"end":return e.stop()}}),e,this,[[5,22,25,28]])}))),function(){return X.apply(this,arguments)})},{key:"CountPointsDebug",value:function(e){var t="";[{query:"circle:not([z-index])",display:"circles: %s, "},{query:"polyline",display:"lines: %s, "},{query:"circle[data-status='2']",display:"intercepted(P1:%s, "},{query:"circle[data-status='3']",display:"P2:%s)"}].forEach((function(e){var n=document.querySelectorAll(e.query);t+=e.display.replace("%s",n.length)})),document.querySelector(e).innerHTML="SVGs by tags: "+t}},{key:"RunAIWorker",value:(E=b(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var s;n.m_Worker=null!==(s=n.m_Worker)&&void 0!==s?s:new Worker(u()?"../js/AIWorker.Bundle.js":"../js/AIWorker.PolyfillBundle.js"),n.m_Worker.onerror=function(){this.m_Worker.terminate(),this.m_Worker=null,r(new Error("no data"))},n.m_Worker.onmessage=function(t){var n=t.data;switch(n.operation){case"BUILD_GRAPH":case"CONCAVEMAN":case"MARK_ALL_CYCLES":e(n);break;default:i("unknown params.operation = ".concat(n.operation)),r(new Error("unknown params.operation = ".concat(n.operation)))}},t&&t(n.m_Worker)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return E.apply(this,arguments)})},{key:"OnTestBuildCurrentGraph",value:(C=b(regeneratorRuntime.mark((function e(t){var i,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,this.RunAIWorker((function(e){var t=Array.from(r.m_Points.store.entries()).map((function(e){var t=d(e,2);return{key:t[0],value:t[1].Serialize()}})),n=r.m_Lines.store.map((function(e){return e.Serialize()}));e.postMessage({operation:"BUILD_GRAPH",state:r.GetGameStateForIndexedDb(),points:t,paths:n})}));case 3:i=e.sent,n("Message received from worker "+i);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"OnTestConcaveman",value:(x=b(regeneratorRuntime.mark((function e(t){var i,r,s,a,o,u,l,h,m,p,f,S,v=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,this.RunAIWorker((function(e){var t=Array.from(v.m_Points.store.entries()).map((function(e){var t=d(e,2);return{key:t[0],value:t[1].Serialize()}}));e.postMessage({operation:"CONCAVEMAN",state:v.GetGameStateForIndexedDb(),points:t})}));case 3:if(!((i=e.sent).convex_hull&&i.convex_hull.length>0)){e.next=31;break}r=i.convex_hull,this.SvgVml.CreatePolyline(6,r.map(function(e){var t=d(e,2),n=t[0],i=t[1];return parseInt(n)*this.m_iGridSizeX+","+parseInt(i)*this.m_iGridSizeY}.bind(this)).join(" "),"green"),n("convex_hull = ".concat(r)),s=i.cw_sorted_verts,a=U(),o=_(s),e.prev=11,o.s();case 13:if((u=o.n()).done){e.next=23;break}return l=u.value,h=l.x,m=l.y,p=h*this.m_iGridSizeX,f=m*this.m_iGridSizeY,(S=document.querySelector('svg > circle[cx="'.concat(p,'"][cy="').concat(f,'"]')))&&(S.SetStrokeColor(a),S.SetFillColor(a),S.SetZIndex(100),S.setAttribute("r","6")),e.next=21,c(50);case 21:e.next=13;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(11),o.e(e.t0);case 28:return e.prev=28,o.f(),e.finish(28);case 31:case"end":return e.stop()}}),e,this,[[11,25,28,31]])}))),function(e){return x.apply(this,arguments)})},{key:"OnTestMarkAllCycles",value:(R=b(regeneratorRuntime.mark((function e(t){var i,r,s,o,u,l,h,m,p,f,S,v,y,b,g,P,k,R,x,w,C,I,O,L,G,E,D,T,A=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,this.RunAIWorker((function(e){var t=Array.from(A.m_Points.store.entries()).map((function(e){var t=d(e,2);return{key:t[0],value:t[1].Serialize()}})),n=A.m_Lines.store.map((function(e){return e.Serialize()}));e.postMessage({operation:"MARK_ALL_CYCLES",state:A.GetGameStateForIndexedDb(),points:t,paths:n,colorRed:A.COLOR_RED,colorBlue:A.COLOR_BLUE})}));case 3:if(!((i=e.sent).cycles&&i.free_human_player_points&&i.free_human_player_points.length>0)){e.next=47;break}r=[],s=_(i.free_human_player_points);try{for(s.s();!(o=s.n()).done;)u=o.value,l=u.x,h=u.y,m=l*this.m_iGridSizeX,p=h*this.m_iGridSizeY,document.querySelector('svg > circle[cx="'.concat(m,'"][cy="').concat(p,'"]'))&&r.push({x:l,y:h})}catch(e){s.e(e)}finally{s.f()}f=[],S=0;case 10:if(!(S<=i.cyclenumber)){e.next=47;break}if(!((v=i.cycles[S])&&v.cycl&&v.cycl.length>0&&v.cw_sorted_verts)){e.next=44;break}y="Cycle Number ".concat(S,": "),b=[],g="var(--indigo)",P=v.cw_sorted_verts,k=_(P),e.prev=17,k.s();case 19:if((R=k.n()).done){e.next=28;break}return x=R.value,w=x.x,C=x.y,(I=document.querySelector('svg > circle[cx="'.concat(w*this.m_iGridSizeX,'"][cy="').concat(C*this.m_iGridSizeY,'"]')))&&(y+="(".concat(w,",").concat(C,")"),I.SetStrokeColor(g),I.SetFillColor(g),I.setAttribute("r","6")),e.next=26,c(50);case 26:e.next=19;break;case 28:e.next=33;break;case 30:e.prev=30,e.t0=e.catch(17),k.e(e.t0);case 33:return e.prev=33,k.f(),e.finish(33);case 36:O="",L="",G=_(r);try{for(G.s();!(E=G.n()).done;)D=E.value,!1!==a(P,D.x,D.y)&&(O+="".concat(L,"(").concat(D.x,",").concat(D.y,")"),(T=document.querySelector('svg > circle[cx="'.concat(D.x*this.m_iGridSizeX,'"][cy="').concat(D.y*this.m_iGridSizeY,'"]')))&&(T.SetStrokeColor("var(--yellow)"),T.SetFillColor("var(--yellow)"),T.setAttribute("r","6")),L=",")}catch(e){G.e(e)}finally{G.f()}b.unshift(y),f.push(b),n(y+(""!==O?" possible intercepts: ".concat(O):"")),Array.from(document.querySelectorAll('svg > circle[fill="'.concat(g,'"][r="6"]'))).forEach((function(e){e.SetStrokeColor(A.COLOR_BLUE),e.SetFillColor(A.COLOR_BLUE),e.setAttribute("r","4")}));case 44:S++,e.next=10;break;case 47:case"end":return e.stop()}}),e,this,[[17,30,33,36]])}))),function(e){return R.apply(this,arguments)})},{key:"OnTestGroupPoints",value:(k=b(regeneratorRuntime.mark((function e(t){var i,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,this.m_Points.get(this.m_iMouseY*this.m_iGridWidth+this.m_iMouseX);case 3:return i=e.sent,e.next=6,this.GroupPointsRecurse([],i);case 6:this.workingCyclePolyLine&&(this.SvgVml.RemovePolyline(this.workingCyclePolyLine),this.workingCyclePolyLine=null),this.lastCycle.forEach((function(e){r.SvgVml.CreatePolyline(6,e.map((function(e){var t=e.GetPosition();return"".concat(t.x,",").concat(t.y)})).join(" "),U())})),n("game.lastCycle = ",this.lastCycle),this.lastCycle=[];case 10:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"OnTestFindSurroundablePoints",value:(P=b(regeneratorRuntime.mark((function e(t){var n,i,s,a,o,c,u,l,h,m,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n=this.COLOR_RED,i=U(),e.t0=_,e.next=6,this.m_Points.values();case 6:e.t1=e.sent,s=(0,e.t0)(e.t1),e.prev=8,s.s();case 10:if((a=s.n()).done){e.next=24;break}if(void 0===(o=a.value)||o.GetFillColor()!==n||r.POINT_FREE_RED!==o.GetStatus()){e.next=22;break}return c=o.GetPosition(),u=c.x,l=c.y,h=u/this.m_iGridSizeX,m=l/this.m_iGridSizeY,e.next=17,this.IsPointOutsideAllPaths(h,m);case 17:if(e.t2=e.sent,!1!==e.t2){e.next=20;break}return e.abrupt("continue",22);case 20:(d=document.querySelector('svg > circle[cx="'.concat(u,'"][cy="').concat(l,'"]')))&&(d.SetStrokeColor(i),d.SetFillColor(i),d.setAttribute("r","6"));case 22:e.next=10;break;case 24:e.next=29;break;case 26:e.prev=26,e.t3=e.catch(8),s.e(e.t3);case 29:return e.prev=29,s.f(),e.finish(29);case 32:case"end":return e.stop()}}),e,this,[[8,26,29,32]])}))),function(e){return P.apply(this,arguments)})},{key:"OnTestWorkerify",value:(g=b(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault();case 1:case"end":return e.stop()}}),e)}))),function(e){return g.apply(this,arguments)})},{key:"PrepareDrawing",value:(y=b(regeneratorRuntime.mark((function e(n,i,r,s,a,o,c,u,l,h,m,d,_,p){var f,S,v,y,b,g,P,k=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=k.length>14&&void 0!==k[14]?k[14]:125,this.m_bIsWon=!1,this.m_iDelayBetweenMultiCaptures=4e3,this.m_iTooLong2Duration=f,this.m_Timer=null,this.m_WaitStartTime=null,this.m_iSlowdownLevel=0,this.m_iLastX=-1,this.m_iLastY=-1,this.m_iMouseX=0,this.m_iMouseY=0,this.m_iPosX=0,this.m_iPosY=0,this.m_bMouseDown=!1,this.m_bHandlingEvent=!1,this.m_bDrawLines=!1,this.m_sMessage="",this.m_sDotColor=this.m_bIsPlayingWithRed?this.COLOR_RED:this.COLOR_BLUE,this.m_Line=null,this.m_Debug=document.getElementById("debug0"),this.m_Player2Name=document.querySelector(i),this.m_GameStatus=document.querySelector(r),this.m_SurrenderButton=document.querySelector(s),this.m_CancelPath=document.querySelector(a),this.m_StopAndDraw=document.querySelector(c),this.m_sMsgInputSel=u,this.m_sMsgListSel=l,this.m_sMsgSendButtonSel=h,this.m_Screen=document.querySelector(n),this.m_Screen){e.next=32;break}return alert("no board"),e.abrupt("return");case 32:return this.m_iPosX=this.m_Screen.offsetLeft,this.m_iPosY=this.m_Screen.offsetTop,S=Array.from(this.m_Screen.classList).find((function(e){return e.startsWith("boardsize")})).split("-")[1].split("x"),this.m_BoardSize={width:parseInt(S[0]),height:parseInt(S[1])},v=this.m_Screen.clientWidth,y=this.m_Screen.clientHeight,b=null,y<=0&&(y=16*this.m_BoardSize.height,this.m_Screen.style.height=y+"px",b="100%"),this.m_iGridSizeX=parseInt(Math.ceil(v/this.m_BoardSize.width)),this.m_iGridSizeY=parseInt(Math.ceil(y/this.m_BoardSize.height)),this.m_iGridWidth=parseInt(Math.ceil(v/this.m_iGridSizeX)),this.m_iGridHeight=parseInt(Math.ceil(y/this.m_iGridSizeY)),this.m_sLastMoveGameTimeStamp=m,this.m_sVersion=_,this.rAF_StartTimestamp=null,this.rAF_FrameID=null,this.lastCycle=[],this.SvgVml=new t.SvgVml,null===this.SvgVml.CreateSVGVML(this.m_Screen,b,b,!0)&&alert("SVG is not supported!"),this.DisableSelection(this.m_Screen),g=new t.GameStateStore(d,this.CreateScreenPointFromIndexedDb.bind(this),this.CreateScreenPathFromIndexedDb.bind(this),this.GetGameStateForIndexedDb.bind(this),this.m_sVersion),this.m_Lines=g.GetPathStore(),this.m_Points=g.GetPointStore(),e.next=57,g.PrepareStore();case 57:this.m_bPointsAndPathsLoaded=e.sent,!1===this.m_bViewOnly?(null===this.m_MouseCursorOval&&(this.m_MouseCursorOval=this.SvgVml.CreateOval(this.m_PointRadius),this.m_MouseCursorOval.SetFillColor(this.m_sDotColor),this.m_MouseCursorOval.SetStrokeColor(this.m_sDotColor),this.m_MouseCursorOval.SetZIndex(-1),this.m_MouseCursorOval.Hide()),this.m_Screen.onmousedown=this.OnMouseDown.bind(this),this.m_Screen.onmousemove=this.OnMouseMove.bind(this),this.m_Screen.onmouseup=this.OnMouseUp.bind(this),this.m_Screen.onmouseleave=this.OnMouseLeave.bind(this),this.m_CancelPath.onclick=this.OnCancelClick.bind(this),this.m_StopAndDraw.onclick=this.OnStopAndDraw.bind(this),!1===this.m_bIsCPUGame?(document.querySelector(this.m_sMsgInputSel).disabled="",document.getElementById("testArea").textContent=""):(P=0,p.length>P&&(document.querySelector(p[P++]).onclick=this.OnTestBuildCurrentGraph.bind(this)),p.length>P&&(document.querySelector(p[P++]).onclick=this.OnTestConcaveman.bind(this)),p.length>P&&(document.querySelector(p[P++]).onclick=this.OnTestMarkAllCycles.bind(this)),p.length>P&&(document.querySelector(p[P++]).onclick=this.OnTestGroupPoints.bind(this)),p.length>P&&(document.querySelector(p[P++]).onclick=this.OnTestFindSurroundablePoints.bind(this)),p.length>P&&(document.querySelector(p[P++]).onclick=this.OnTestWorkerify.bind(this))),this.m_SurrenderButton.disabled="","???"===this.m_Player2Name.innerHTML?(this.ShowMobileStatus("Waiting for other player to connect"),this.m_Screen.style.cursor="wait"):(this.m_SurrenderButton.value="surrender",this.m_bIsPlayerActive?(this.ShowMobileStatus("Your move"),this.m_Screen.style.cursor="crosshair",this.m_StopAndDraw.disabled=""):(this.ShowMobileStatus("Waiting for oponent move"),this.m_Screen.style.cursor="wait"),this.m_bDrawLines?this.m_StopAndDraw.value="Draw dot":this.m_StopAndDraw.value="Draw line")):document.querySelector(o).innerHTML="back to Game List";case 59:case"end":return e.stop()}}),e,this)}))),function(e,t,n,i,r,s,a,o,c,u,l,h,m,d){return y.apply(this,arguments)})},{key:"GetRandomInt",value:function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e}},{key:"FindRandomCPUPoint",value:(v=b(regeneratorRuntime.mark((function e(){var t,n,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=100;case 1:if(!(--t>0)){e.next=15;break}return n=this.GetRandomInt(0,this.m_iGridWidth),i=this.GetRandomInt(0,this.m_iGridHeight),e.next=6,this.m_Points.has(i*this.m_iGridWidth+n);case 6:if(e.t0=!e.sent,!e.t0){e.next=11;break}return e.next=10,this.IsPointOutsideAllPaths(n,i);case 10:e.t0=e.sent;case 11:if(!e.t0){e.next=13;break}return e.abrupt("break",15);case 13:e.next=1;break;case 15:return s=new D(0,this.g_iGameID,-1,n,i,r.POINT_FREE_BLUE,0),e.abrupt("return",s);case 17:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"CalculateCPUCentroid",value:(S=b(regeneratorRuntime.mark((function e(){var t,n,i,s,a,o,c,u,l,h,m,d,p,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=0,n=0,i=0,o=this.COLOR_RED,e.t0=_,e.next=5,this.m_Points.values();case 5:e.t1=e.sent,c=(0,e.t0)(e.t1);try{for(c.s();!(u=c.n()).done;)void 0!==(l=u.value)&&l.GetFillColor()===o&&l.GetStatus()===r.POINT_FREE_RED&&(h=l.GetPosition(),s=h.x,a=h.y,s/=this.m_iGridSizeX,a/=this.m_iGridSizeY,t+=s,n+=a,i++)}catch(e){c.e(e)}finally{c.f()}if(!(i<=0)){e.next=10;break}return e.abrupt("return",null);case 10:s=t/i,a=n/i,s*=this.m_iGridSizeX,a*=this.m_iGridSizeY,m=parseInt(s/this.m_iGridSizeX),d=parseInt(a/this.m_iGridSizeY),s=m,a=d,p=20;case 19:if(!(--p>0)){e.next=31;break}if(e.t2=!this.m_Points.has(a*this.m_iGridWidth+s),!e.t2){e.next=25;break}return e.next=24,this.IsPointOutsideAllPaths(s,a);case 24:e.t2=e.sent;case 25:if(!e.t2){e.next=27;break}return e.abrupt("break",31);case 27:s=this.GetRandomInt(m-2,m+3),a=this.GetRandomInt(d-2,d+3),e.next=19;break;case 31:if(!(p<=0)){e.next=33;break}return e.abrupt("return",null);case 33:return f=new D(0,this.g_iGameID,-1,s,a,r.POINT_FREE_BLUE,0),e.abrupt("return",f);case 35:case"end":return e.stop()}}),e,this)}))),function(){return S.apply(this,arguments)})},{key:"IsGraphCyclic",value:function(e){for(var t=e.vertices,i=function(e,t){e.visited=!0;var r,s=_(e.adjacents);try{for(s.s();!(r=s.n()).done;){var a=r.value;if(a.visited){if(a!==t){var o=a.GetPosition(),c=o.x,u=o.y,l=c/this.m_iGridSizeX,h=u/this.m_iGridSizeY;return n("cycle found at ".concat(l,",").concat(h)),!0}}else if(i(a,e))return!0}}catch(e){s.e(e)}finally{s.f()}return!1}.bind(this),r=0;r<t.length;r++)t[r].visited=!1;for(var s=0;s<t.length;s++)if(!t[s].visited&&i(t[s],-1))return!0;return!1}},{key:"MarkAllCycles",value:(f=b(regeneratorRuntime.mark((function e(t){var i,s,u,l,h,m,d,p,f,S,v,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=t.vertices,s=i.length,u=new Array(s),l=new Array(s),h=new Array(s),m=new Array(s),d=0;d<s;d++)l[d]=[],u[d]=[];p=function(){var e=b(regeneratorRuntime.mark((function e(t,n){var r,s,a,o,u,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(2!==h[t]){e.next=2;break}return e.abrupt("return");case 2:if(1!==h[t]){e.next=8;break}for(S++,l[r=n].push(S);r!==t;)r=m[r],l[r].push(S);return e.abrupt("return");case 8:if(m[t]=n,h[t]=1,!(s=i[t])){e.next=36;break}return s.SetStrokeColor("black"),s.SetFillColor("black"),e.next=16,c(10);case 16:a=_(s.adjacents),e.prev=17,a.s();case 19:if((o=a.n()).done){e.next=28;break}if(u=o.value,(d=i.indexOf(u))!==m[t]){e.next=24;break}return e.abrupt("continue",26);case 24:return e.next=26,p(d,t);case 26:e.next=19;break;case 28:e.next=33;break;case 30:e.prev=30,e.t0=e.catch(17),a.e(e.t0);case 33:return e.prev=33,a.f(),e.finish(33);case 36:h[t]=2;case 37:case"end":return e.stop()}}),e,null,[[17,30,33,36]])})));return function(t,n){return e.apply(this,arguments)}}(),f=function(){var e=b(regeneratorRuntime.mark((function e(t,s){var l,h,m,d,p,f,v,y,b,g,P,k,R,x,w,C,I,O,L,G,E,D,T,A,N,W,M,z,B,F,Y,X,H,U,q=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(l=0;l<t;l++)if(void 0!==(h=s[l])&&h.length>0)for(m=0;m<h.length;m++)void 0!==(d=u[h[m]])&&d.push(l);return u=u.filter((function(e){return e.length>=4})).sort((function(e,t){return t.length-e.length})),p=[],f=this.COLOR_RED,e.t0=_,e.next=7,this.m_Points.values();case 7:e.t1=e.sent,v=(0,e.t0)(e.t1),e.prev=9,v.s();case 11:if((y=v.n()).done){e.next=25;break}if(void 0===(b=y.value)||b.GetFillColor()!==f||r.POINT_FREE_RED!==b.GetStatus()){e.next=23;break}return g=b.GetPosition(),P=g.x,k=g.y,R=P/this.m_iGridSizeX,x=k/this.m_iGridSizeY,e.next=18,this.IsPointOutsideAllPaths(R,x);case 18:if(e.t2=e.sent,!1!==e.t2){e.next=21;break}return e.abrupt("continue",23);case 21:document.querySelector('svg > circle[cx="'.concat(P,'"][cy="').concat(k,'"]'))&&p.push({x:R,y:x});case 23:e.next=11;break;case 25:e.next=30;break;case 27:e.prev=27,e.t3=e.catch(9),v.e(e.t3);case 30:return e.prev=30,v.f(),e.finish(30);case 33:w=[],C=0;case 35:if(!(C<=S)){e.next=73;break}if(!((I=u[C])&&I.length>0)){e.next=70;break}O="Cycle Number ".concat(C,": "),L=[],G="var(--indigo)",E=I.map(function(e){var t=i[e].GetPosition();return{x:t.x/this.m_iGridSizeX,y:t.y/this.m_iGridSizeY}}.bind(this)),D=o(E),T=_(D),e.prev=43,T.s();case 45:if((A=T.n()).done){e.next=54;break}return N=A.value,W=N.x,M=N.y,(z=document.querySelector('svg > circle[cx="'.concat(W*this.m_iGridSizeX,'"][cy="').concat(M*this.m_iGridSizeY,'"]')))&&(O+="(".concat(W,",").concat(M,")"),z.SetStrokeColor(G),z.SetFillColor(G),z.setAttribute("r","6")),e.next=52,c(50);case 52:e.next=45;break;case 54:e.next=59;break;case 56:e.prev=56,e.t4=e.catch(43),T.e(e.t4);case 59:return e.prev=59,T.f(),e.finish(59);case 62:B="",F="",Y=_(p);try{for(Y.s();!(X=Y.n()).done;)H=X.value,!1!==a(D,H.x,H.y)&&(B+="".concat(F,"(").concat(H.x,",").concat(H.y,")"),(U=document.querySelector('svg > circle[cx="'.concat(H.x*this.m_iGridSizeX,'"][cy="').concat(H.y*this.m_iGridSizeY,'"]')))&&(U.SetStrokeColor("var(--yellow)"),U.SetFillColor("var(--yellow)"),U.setAttribute("r","6")),F=",")}catch(e){Y.e(e)}finally{Y.f()}L.unshift(O),w.push(L),n(O+(""!==B?" possible intercepts: ".concat(B):"")),Array.from(document.querySelectorAll('svg > circle[fill="'.concat(G,'"][r="6"]'))).forEach((function(e){e.SetStrokeColor(q.COLOR_BLUE),e.SetFillColor(q.COLOR_BLUE),e.setAttribute("r","4")}));case 70:C++,e.next=35;break;case 73:return e.abrupt("return",w);case 74:case"end":return e.stop()}}),e,this,[[9,27,30,33],[43,56,59,62]])})));return function(t,n){return e.apply(this,arguments)}}().bind(this),S=0,v=s,y=0;case 10:if(!(y<s)){e.next=16;break}return e.next=13,p(y+1,y);case 13:y++,e.next=10;break;case 16:return e.next=18,f(v,l);case 18:return e.abrupt("return",e.sent);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"GroupPointsRecurse",value:(m=b(regeneratorRuntime.mark((function e(t,n){var i,s,a,o,u,l,h,m,_,p,f,S,v,y,b,g,P,k,R,x,w,C,I;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(void 0===n||t.includes(n)||t.length>60||this.lastCycle.length>3)){e.next=2;break}return e.abrupt("return",t);case 2:if(!1!==[r.POINT_FREE_BLUE,r.POINT_STARTING,r.POINT_IN_PATH].includes(n.GetStatus())&&n.GetFillColor()===this.COLOR_BLUE){e.next=4;break}return e.abrupt("return",t);case 4:if(i=n.GetPosition(),s=i.x,a=i.y,s/=this.m_iGridSizeX,a/=this.m_iGridSizeY,o=null,!(t.length>0)){e.next=19;break}if(o=t[t.length-1],h=o.GetPosition(),u=h.x/this.m_iGridSizeX,l=h.y/this.m_iGridSizeY,!(Math.abs(parseInt(u-s))<=1&&Math.abs(parseInt(l-a))<=1)){e.next=16;break}t.push(n),e.next=17;break;case 16:return e.abrupt("return",t);case 17:e.next=20;break;case 19:t.push(n);case 20:return t.length>2&&null!==o&&(m=t[0],(_=m.GetPosition()).x/=this.m_iGridSizeX,_.y/=this.m_iGridSizeY,o=t[t.length-1],p=o.GetPosition(),u=p.x/this.m_iGridSizeX,l=p.y/this.m_iGridSizeY,Math.abs(parseInt(u-_.x))<=1&&Math.abs(parseInt(l-_.y))<=1&&t.length>=4&&((f=t.slice()).push(t[0]),this.lastCycle.push(f))),e.next=23,Promise.all([this.m_Points.get(a*this.m_iGridWidth+s+1),this.m_Points.get(a*this.m_iGridWidth+s-1),this.m_Points.get((a-1)*this.m_iGridWidth+s),this.m_Points.get((a+1)*this.m_iGridWidth+s),this.m_Points.get((a-1)*this.m_iGridWidth+s-1),this.m_Points.get((a-1)*this.m_iGridWidth+s+1),this.m_Points.get((a+1)*this.m_iGridWidth+s-1),this.m_Points.get((a+1)*this.m_iGridWidth+s+1)]);case 23:if(S=e.sent,v=d(S,8),y=v[0],b=v[1],g=v[2],P=v[3],k=v[4],R=v[5],x=v[6],w=v[7],!y){e.next=36;break}return e.next=36,this.GroupPointsRecurse(t,y);case 36:if(!b){e.next=39;break}return e.next=39,this.GroupPointsRecurse(t,b);case 39:if(!g){e.next=42;break}return e.next=42,this.GroupPointsRecurse(t,g);case 42:if(!P){e.next=45;break}return e.next=45,this.GroupPointsRecurse(t,P);case 45:if(!k){e.next=48;break}return e.next=48,this.GroupPointsRecurse(t,k);case 48:if(!R){e.next=51;break}return e.next=51,this.GroupPointsRecurse(t,R);case 51:if(!x){e.next=54;break}return e.next=54,this.GroupPointsRecurse(t,x);case 54:if(!w){e.next=57;break}return e.next=57,this.GroupPointsRecurse(t,w);case 57:if(-1===(C=t.lastIndexOf(n))){e.next=64;break}return t.splice(C),I=t.map((function(e){var t=e.GetPosition();return"".concat(t.x,",").concat(t.y)})).join(" "),this.workingCyclePolyLine?this.workingCyclePolyLine.SetPoints(I):this.workingCyclePolyLine=this.SvgVml.CreatePolyline(6,I,"black"),e.next=64,c(50);case 64:return e.abrupt("return",t);case 65:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"GroupPointsIterative",value:(h=b(regeneratorRuntime.mark((function e(){var t,n,i,r,s,a,o,c,u,l,h=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=h.length>0&&void 0!==h[0]?h[0]:{},n=t.g,i=void 0===n?null:n){e.next=3;break}return e.abrupt("return");case 3:r=i.vertices,s=[],o=_(r),e.prev=5,o.s();case 7:if((c=o.n()).done){e.next=17;break}return u=c.value,a=u,l=[],e.next=13,this.GroupPointsRecurse(l,a);case 13:e.sent.length>0&&this.lastCycle.length>0&&(s.push(this.lastCycle),this.lastCycle=[]);case 15:e.next=7;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(5),o.e(e.t0);case 22:return e.prev=22,o.f(),e.finish(22);case 25:return e.abrupt("return",s);case 26:case"end":return e.stop()}}),e,this,[[5,19,22,25]])}))),function(){return h.apply(this,arguments)})},{key:"rAFCallBack",value:(l=b(regeneratorRuntime.mark((function e(t){var n,i,r,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===this.rAF_StartTimestamp&&(this.rAF_StartTimestamp=t),n=t-this.rAF_StartTimestamp,i=null,e.next=5,this.CalculateCPUCentroid();case 5:if(null===(r=e.sent)){e.next=10;break}i=r,e.next=13;break;case 10:return e.next=12,this.FindRandomCPUPoint();case 12:i=e.sent;case 13:if(null!==i){e.next=17;break}n<2e3&&(this.rAF_FrameID=window.requestAnimationFrame(this.rAFCallBack.bind(this))),e.next=19;break;case 17:return e.next=19,this.SendAsyncData(i,(function(){s.m_bMouseDown=!1,s.m_bHandlingEvent=!1}));case 19:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"StartCPUCalculation",value:function(){null===this.rAF_FrameID&&(this.rAF_FrameID=window.requestAnimationFrame(this.rAFCallBack.bind(this)))}}]),e}();window.addEventListener("load",b(regeneratorRuntime.mark((function e(){var t,n,i,r,s,a,o,c,u,l,h,m,d,_,p,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=void 0!==window.msgpack5,n=window.gameOptions,i=n.inkBallHubName,r=n.iGameID,document.getElementById("gameID").innerHTML=r,document.querySelector(".container.inkgame form > input[type='hidden'][name='GameID']").value=r,s=n.iPlayerID,a=parseInt(document.querySelector(".msgchat").dataset.otherplayerid)||null,document.getElementById("playerID").innerHTML=s,o=n.bPlayingWithRed,c=n.bPlayerActive,u=n.gameType,l=t&&!0===n.isMessagePackProtocol?new signalR.protocols.msgpack.MessagePackHubProtocol:new signalR.JsonHubProtocol,h=n.servTimeoutMillis,m=n.isReadonly,d=n.pathAfterPointDrawAllowanceSecAmount,_=new Date(n.sLastMoveGameTimeStamp).toISOString(),p=n.version,e.next=20,X(n);case 20:return f=new q(r,s,a,i,signalR.LogLevel.Warning,l,signalR.HttpTransportType.None,h,u,o,c,m,d),e.next=23,f.PrepareDrawing("#screen","#Player2Name","#gameStatus","#SurrenderButton","#CancelPath","#Pause","#StopAndDraw","#messageInput","#messagesList","#sendButton",_,null===n.PointsAsJavaScriptArray,p,["#TestBuildGraph","#TestConcaveman","#TestMarkAllCycles","#TestGroupPoints","#TestFindSurroundablePoints","#TestWorkerify"]);case 23:if(null===n.PointsAsJavaScriptArray){e.next=32;break}return e.next=26,f.StartSignalRConnection(!1);case 26:return e.next=28,f.SetAllPoints(n.PointsAsJavaScriptArray);case 28:return e.next=30,f.SetAllPaths(n.PathsAsJavaScriptArray);case 30:e.next=34;break;case 32:return e.next=34,f.StartSignalRConnection(!0);case 34:document.getElementsByClassName("whichColor")[0].style.color=o?"red":"blue",f.CountPointsDebug("#debug2"),delete window.gameOptions,window.game=f;case 38:case"end":return e.stop()}}),e)})))),window.addEventListener("beforeunload",(function(){window.game&&window.game.StopSignalRConnection()}))}();