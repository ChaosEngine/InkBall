!function(e){function t(t){for(var n,i,s=t[0],a=t[1],o=0,c=[];o<s.length;o++)i=s[o],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&c.push(r[i][0]),r[i]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n]);for(u&&u(t);c.length;)c.shift()()}var n={},r={1:0};function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(e){var t=[],n=r[e];if(0!==n)if(n)t.push(n[2]);else{var s=new Promise((function(t,i){n=r[e]=[t,i]}));t.push(n[2]=s);var a,o=document.createElement("script");o.charset="utf-8",o.timeout=120,i.nc&&o.setAttribute("nonce",i.nc),o.src=function(e){return i.p+""+({0:"concavemanDeps",2:"svgvml",3:"svgvmlMin"}[e]||e)+"Bundle.js"}(e);var u=new Error;a=function(t){o.onerror=o.onload=null,clearTimeout(c);var n=r[e];if(0!==n){if(n){var i=t&&("load"===t.type?"missing":t.type),s=t&&t.target&&t.target.src;u.message="Loading chunk "+e+" failed.\n("+i+": "+s+")",u.name="ChunkLoadError",u.type=i,u.request=s,n[1](u)}r[e]=void 0}};var c=setTimeout((function(){a({type:"timeout",target:o})}),12e4);o.onerror=o.onload=a,document.head.appendChild(o)}return Promise.all(t)},i.m=e,i.c=n,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="../js/",i.oe=function(e){throw console.error(e),e};var s=window.webpackJsonp=window.webpackJsonp||[],a=s.push.bind(s);s.push=t,s=s.slice();for(var o=0;o<s.length;o++)t(s[o]);var u=a;i(i.s=0)}([function(e,t,n){"use strict";function r(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){throw e})),f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){u=!0,a=e})),f:function(){try{o||null==n.return||n.return()}finally{if(u)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t,n,r,i,s,a){try{var o=e[s](a),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){s(a,r,i,o,u,"next",e)}function u(e){s(a,r,i,o,u,"throw",e)}o(void 0)}))}}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m(e);if(t){var i=m(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return l(this,n)}}function l(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _(e,t,n){return t&&p(e.prototype,t),n&&p(e,n),e}var f,S,v,b,g,y,P,k,R=Object.freeze({POINT_FREE_RED:-3,POINT_FREE_BLUE:-2,POINT_FREE:-1,POINT_STARTING:0,POINT_IN_PATH:1,POINT_OWNED_BY_RED:2,POINT_OWNED_BY_BLUE:3}),x=Object.freeze({UNKNOWN:-1,PING:0,POINT:1,PATH:2,PLAYER_JOINING:3,PLAYER_SURRENDER:4,WIN:5,POINTS_AND_PATHS:6,USER_SETTINGS:7,STOP_AND_DRAW:8}),w=Object.freeze({FIRST_CAPTURE:0,FIRST_5_CAPTURES:1,FIRST_5_PATHS:2,FIRST_5_ADVANTAGE_PATHS:3}),O=Object.freeze({RED_WINS:0,GREEN_WINS:1,NO_WIN:2,DRAW_WIN:3}),G=function(){function e(){d(this,e)}return _(e,[{key:"GetKind",value:function(){throw new Error("missing GetKind implementation!")}}]),e}(),I=function(e){u(n,e);var t=h(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:R.POINT_FREE,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return d(this,n),(e=t.call(this)).iId=r,e.iGameId=i,e.iPlayerId=s,e.iX=a,e.iY=o,e.Status=u,e.iEnclosingPathId=c,e}return _(n,[{key:"GetKind",value:function(){return x.POINT}}],[{key:"Format",value:function(e,t){var n="("+t.iX+","+t.iY+" - ";switch(void 0!==t.Status?t.Status:t.status){case R.POINT_FREE_RED:n+="red";break;case R.POINT_FREE_BLUE:n+="blue";break;case R.POINT_FREE:n+="";break;case R.POINT_STARTING:n+="starting";break;case R.POINT_IN_PATH:n+="path";break;case R.POINT_OWNED_BY_RED:n+="owned by red";break;case R.POINT_OWNED_BY_BLUE:n+="owned by blue";break;default:throw new Error("Bad point type!")}return e+" places "+n+") point"}}]),n}(G),T=function(e){u(n,e);var t=h(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return d(this,n),(e=t.call(this)).iId=r,e.iGameId=i,e.iPlayerId=s,e.PointsAsString=a,e.OwnedPointsAsString=o,e}return _(n,[{key:"GetKind",value:function(){return x.PATH}}],[{key:"Format",value:function(e,t){var n="(".concat(t.PointsAsString||t.pointsAsString,") [").concat(t.OwnedPointsAsString||t.ownedPointsAsString,"]");return"".concat(e," places ").concat(n," path")}}]),n}(G),C=function(e){u(n,e);var t=h(n);function n(e,r,i){var s;return d(this,n),(s=t.call(this)).OtherPlayerId=e,s.OtherPlayerName=r,s.Message=i,s}return _(n,[{key:"GetKind",value:function(){return x.PLAYER_JOINING}}],[{key:"Format",value:function(e){return e.Message||e.message}}]),n}(G),E=function(e){u(n,e);var t=h(n);function n(e,r,i){var s;return d(this,n),(s=t.call(this)).OtherPlayerId=e,s.thisOrOtherPlayerSurrenders=r,s.Message=i,s}return _(n,[{key:"GetKind",value:function(){return x.PLAYER_SURRENDER}}],[{key:"Format",value:function(e){return e.Message||e.message}}]),n}(G),D=function(e){u(n,e);var t=h(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return d(this,n),(e=t.call(this)).Message=r,e}return _(n,[{key:"GetKind",value:function(){return x.PING}}],[{key:"Format",value:function(e,t){return e+" says '"+(t.Message||t.message)+"'"}}]),n}(G),L=function(e){u(n,e);var t=h(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O.NO_WIN,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"null";return d(this,n),(e=t.call(this)).Status=r,e.WinningPlayerId=i,e.Message=s,e}return _(n,[{key:"GetKind",value:function(){return x.WIN}}],[{key:"Format",value:function(e){var t="";switch(void 0!==e.Status?e.Status:e.status){case O.RED_WINS:t="red.";break;case O.GREEN_WINS:t="blue.";break;case O.NO_WIN:t="no one!";break;case O.DRAW_WIN:t="draw!"}return"And the winner is... "+t}}]),n}(G),A=function(e){u(n,e);var t=h(n);function n(){return d(this,n),t.call(this)}return _(n,[{key:"GetKind",value:function(){return x.STOP_AND_DRAW}}],[{key:"Format",value:function(e){return"User "+e+" started to draw path"}}]),n}(G),N=function(e){u(n,e);var t=h(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return d(this,n),(e=t.call(this)).Points=r,e.Paths=i,e}return _(n,[{key:"GetKind",value:function(){return x.POINTS_AND_PATHS}}],[{key:"Deserialize",value:function(e){var t='{ "Points": '.concat(e.Points||e.points,', "Paths": ').concat(e.Paths||e.paths," }");return JSON.parse(t)}}]),n}(G),B=function(e){u(n,e);var t=h(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return d(this,n),(e=t.call(this)).DesktopNotifications=r,e}return _(n,[{key:"GetKind",value:function(){return x.USER_SETTINGS}}],[{key:"Serialize",value:function(e){return JSON.stringify(e)}},{key:"Deserialize",value:function(e){return JSON.parse(e)}}]),n}(G),M=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.countdownSeconds,r=void 0===n?60:n,i=t.labelSelector,s=void 0===i?null:i,a=t.initialStart,o=void 0!==a&&a,u=t.countdownReachedHandler,c=void 0===u?void 0:u;d(this,e),this.countdownSeconds=r,this.totalSeconds=this.countdownSeconds,this.timerID=-1,this.label=null,this.countdownReachedHandler=c,s&&(this.label=document.querySelector(s)),o&&this.Start()}return _(e,[{key:"setTimeFunc",value:function(){--this.totalSeconds<=0?(this.Stop(),this.countdownReachedHandler&&this.countdownReachedHandler(this.label)):this.label&&(this.label.innerHTML=this.pad(parseInt(this.totalSeconds/60))+":"+this.pad(this.totalSeconds%60))}},{key:"pad",value:function(e){var t=e+"";return t.length<2?"0"+t:t}},{key:"Start",value:function(){this.Stop(),this.timerID=setInterval(this.setTimeFunc.bind(this),1e3)}},{key:"Stop",value:function(){this.timerID>0&&clearInterval(this.timerID),this.label&&(this.label.innerHTML="")}},{key:"Reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.countdownSeconds,n=void 0===t?60:t,r=e.labelSelector,i=void 0===r?null:r,s=e.initialStart,a=void 0!==s&&s,o=e.countdownReachedHandler,u=void 0===o?void 0:o;this.countdownSeconds=n,this.totalSeconds=this.countdownSeconds,this.label=null,this.countdownReachedHandler=u,i&&(this.label=document.querySelector(i)),a&&this.Start()}}]),e}(),W=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;d(this,e),this.DB_NAME="InkballGame",this.DB_POINT_STORE="points",this.DB_PATH_STORE="paths",this.DB_STATE_STORE="state",this.DB_VERSION=3,this.g_DB,t?"indexedDB"in window?t=!0:(z("This browser doesn't support IndexedDB"),t=!1):t=!1;var o=function(){function e(){d(this,e),this.store=new Map}var t,n,r,i,s,o,u;return _(e,[{key:"PrepareStore",value:(u=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)}))),function(){return u.apply(this,arguments)})},{key:"BeginBulkStorage",value:(o=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return o.apply(this,arguments)})},{key:"EndBulkStorage",value:(s=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return s.apply(this,arguments)})},{key:"has",value:(i=a(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.store.has(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"set",value:(r=a(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.store.set(t,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"get",value:(n=a(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.store.get(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"values",value:(t=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.store.values());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),c=function(){function e(){d(this,e),this.store=[]}var t,n,r,i,s;return _(e,[{key:"PrepareStore",value:(s=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)}))),function(){return s.apply(this,arguments)})},{key:"BeginBulkStorage",value:(i=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)})},{key:"EndBulkStorage",value:(r=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"push",value:(n=a(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.store.push(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"all",value:(t=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.store);case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),l=function(e){u(p,e);var t,n,i,s,o,c,l,m=h(p);function p(e,t,n){var r;return d(this,p),(r=m.call(this)).MainGameStateStore=e,r.GetPoint=e.GetPoint.bind(r.MainGameStateStore),r.StorePoint=e.StorePoint.bind(r.MainGameStateStore),r.GetAllPoints=e.GetAllPoints.bind(r.MainGameStateStore),r.UpdateState=e.UpdateState.bind(r.MainGameStateStore),r.PointCreationCallback=t,r.GetGameStateCallback=n,r}return _(p,[{key:"PrepareStore",value:(l=a(regeneratorRuntime.mark((function e(){var t,n,i,s,a,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.PointCreationCallback||!this.GetGameStateCallback){e.next=26;break}return e.next=3,this.GetAllPoints();case 3:t=e.sent,n=this.GetGameStateCallback(),i=r(t),e.prev=6,i.s();case 8:if((s=i.n()).done){e.next=17;break}return a=s.value,e.next=12,this.PointCreationCallback(a.x,a.y,a.Status,a.Color);case 12:o=e.sent,u=a.y*n.iGridWidth+a.x,this.store.set(u,o);case 15:e.next=8;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(6),i.e(e.t0);case 22:return e.prev=22,i.f(),e.finish(22);case 25:return e.abrupt("return",!0);case 26:case"end":return e.stop()}}),e,this,[[6,19,22,25]])}))),function(){return l.apply(this,arguments)})},{key:"BeginBulkStorage",value:(c=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.MainGameStateStore.BeginBulkStorage(this.MainGameStateStore.DB_POINT_STORE,"readwrite");case 2:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"EndBulkStorage",value:(o=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.MainGameStateStore.StoreAllPoints();case 2:return e.next=4,this.MainGameStateStore.EndBulkStorage(this.MainGameStateStore.DB_POINT_STORE);case 4:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"has",value:(s=a(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.store.has(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"set",value:(i=a(regeneratorRuntime.mark((function e(t,n){var r,i,s,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.GetGameStateCallback(),i=n.$GetPosition(),s=n.$GetFillColor(),a={x:parseInt(i.x)/r.iGridSizeX,y:parseInt(i.y)/r.iGridSizeY,Status:n.$GetStatus(),Color:s},e.next=6,this.StorePoint(t,a);case 6:if(!this.UpdateState){e.next=10;break}if(!0!==r.bPointsAndPathsLoaded){e.next=10;break}return e.next=10,this.UpdateState(r.iGameID,r);case 10:return e.abrupt("return",this.store.set(t,n));case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"get",value:(n=a(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.store.get(t)){e.next=12;break}return e.next=4,this.GetPoint(t);case 4:if(!(r=e.sent)||!this.PointCreationCallback){e.next=11;break}return n=this.PointCreationCallback(r.x,r.y,r.Status,r.Color),this.store.set(t,n),e.abrupt("return",n);case 11:return e.abrupt("return",void 0);case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"values",value:(t=a(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.store.values())){e.next=3;break}return e.abrupt("return",t);case 3:return e.next=5,this.GetAllPoints();case 5:return t=e.sent,e.abrupt("return",t);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),p}(o),m=function(e){u(l,e);var t,n,i,s,o,c=h(l);function l(e,t,n){var r;return d(this,l),(r=c.call(this)).MainGameStateStore=e,r.GetAllPaths=e.GetAllPaths.bind(r.MainGameStateStore),r.StorePath=e.StorePath.bind(r.MainGameStateStore),r.UpdateState=e.UpdateState.bind(r.MainGameStateStore),r.PathCreationCallback=t,r.GetGameStateCallback=n,r}return _(l,[{key:"PrepareStore",value:(o=a(regeneratorRuntime.mark((function e(){var t,n,i,s,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.PathCreationCallback){e.next=23;break}return e.next=3,this.GetAllPaths();case 3:t=e.sent,n=r(t),e.prev=5,n.s();case 7:if((i=n.n()).done){e.next=15;break}return s=i.value,e.next=11,this.PathCreationCallback(s.PointsAsString,s.Color,s.iId);case 11:a=e.sent,this.store.push(a);case 13:e.next=7;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(5),n.e(e.t0);case 20:return e.prev=20,n.f(),e.finish(20);case 23:return e.abrupt("return",!0);case 24:case"end":return e.stop()}}),e,this,[[5,17,20,23]])}))),function(){return o.apply(this,arguments)})},{key:"BeginBulkStorage",value:(s=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.MainGameStateStore.BeginBulkStorage([this.MainGameStateStore.DB_POINT_STORE,this.MainGameStateStore.DB_PATH_STORE],"readwrite");case 2:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"EndBulkStorage",value:(i=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.MainGameStateStore.EndBulkStorage([this.MainGameStateStore.DB_POINT_STORE,this.MainGameStateStore.DB_PATH_STORE]);case 2:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"push",value:(n=a(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.$GetID(),r={iId:n,Color:t.$GetFillColor(),PointsAsString:t.$GetPointsString()},e.next=4,this.StorePath(n,r);case 4:if(!this.UpdateState){e.next=9;break}if(!0!==(i=this.GetGameStateCallback()).bPointsAndPathsLoaded){e.next=9;break}return e.next=9,this.UpdateState(i.iGameID,i);case 9:return e.abrupt("return",this.store.push(t));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"all",value:(t=a(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.store)){e.next=3;break}return e.abrupt("return",t);case 3:return e.next=5,this.GetAllPaths();case 5:return t=e.sent,e.abrupt("return",t);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),l}(c);!0===t?(this.PointStore=new l(this,n,s),this.PathStore=new m(this,i,s)):(this.PointStore=new o,this.PathStore=new c)}var t,n,i,s,o,c,l,m,p,f,S,v,b,g,y;return _(e,[{key:"GetPointStore",value:function(){return this.PointStore}},{key:"GetPathStore",value:function(){return this.PathStore}},{key:"OpenDb",value:(y=a(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return z("OpenDb ..."),e.abrupt("return",new Promise((function(e,n){var r=indexedDB.open(t.DB_NAME,t.DB_VERSION);r.onsuccess=function(t){this.g_DB=t.currentTarget.result,z("OpenDb DONE"),e(t.currentTarget.result)}.bind(t),r.onerror=function(e){Y("OpenDb:",e.target.errorCode),n()},r.onupgradeneeded=function(e){z("OpenDb.onupgradeneeded");var t=Array.from(e.currentTarget.result.objectStoreNames);t.includes(this.DB_POINT_STORE)&&e.currentTarget.result.deleteObjectStore(this.DB_POINT_STORE),t.includes(this.DB_PATH_STORE)&&e.currentTarget.result.deleteObjectStore(this.DB_PATH_STORE),t.includes(this.DB_STATE_STORE)&&e.currentTarget.result.deleteObjectStore(this.DB_STATE_STORE),e.currentTarget.result.createObjectStore(this.DB_POINT_STORE,{autoIncrement:!1}),e.currentTarget.result.createObjectStore(this.DB_PATH_STORE,{autoIncrement:!1}),e.currentTarget.result.createObjectStore(this.DB_STATE_STORE,{autoIncrement:!1})}.bind(t)})));case 2:case"end":return e.stop()}}),e)}))),function(){return y.apply(this,arguments)})},{key:"GetObjectStore",value:function(e,t){return this.bulkStores&&this.bulkStores.has(e)?this.bulkStores.get(e):this.g_DB.transaction(e,t).objectStore(e)}},{key:"ClearObjectStore",value:(g=a(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var i=n.GetObjectStore(t,"readwrite").clear();i.onsuccess=function(){e()},i.onerror=function(e){Y("clearObjectStore:",e.target.errorCode),r()}})));case 1:case"end":return e.stop()}}),e)}))),function(e){return g.apply(this,arguments)})},{key:"GetPoint",value:(b=a(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var i=n.GetObjectStore(n.DB_POINT_STORE,"readonly").get(t);i.onerror=function(e){r(new Error("GetPoint => "+e))},i.onsuccess=function(t){e(t.target.result)}})));case 1:case"end":return e.stop()}}),e)}))),function(e){return b.apply(this,arguments)})},{key:"GetAllPoints",value:(v=a(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.GetObjectStore(t.DB_POINT_STORE,"readonly"),i=[],s=r.openCursor();s.onsuccess=function(t){var n=t.target.result;n?(i.push(n.value),n.continue()):e(i)},s.onerror=function(e){n(new Error("GetAllPoints => "+e))}})));case 1:case"end":return e.stop()}}),e)}))),function(){return v.apply(this,arguments)})},{key:"GetState",value:(S=a(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var i=n.GetObjectStore(n.DB_STATE_STORE,"readonly").get(t);i.onerror=function(e){r(new Error("GetState => "+e))},i.onsuccess=function(t){e(t.target.result)}})));case 1:case"end":return e.stop()}}),e)}))),function(e){return S.apply(this,arguments)})},{key:"GetPath",value:(f=a(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var i=n.GetObjectStore(n.DB_PATH_STORE,"readonly").get(t);i.onerror=function(e){r(new Error("GetPath => "+e))},i.onsuccess=function(t){e(t.target.result)}})));case 1:case"end":return e.stop()}}),e)}))),function(e){return f.apply(this,arguments)})},{key:"GetAllPaths",value:(p=a(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.GetObjectStore(t.DB_PATH_STORE,"readonly"),i=[],s=r.openCursor();s.onsuccess=function(t){var n=t.target.result;n?(i.push(n.value),n.continue()):e(i)},s.onerror=function(e){n(new Error("GetAllPaths => "+e))}})));case 1:case"end":return e.stop()}}),e)}))),function(){return p.apply(this,arguments)})},{key:"StorePoint",value:(m=a(regeneratorRuntime.mark((function e(t,n){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.bulkStores||!this.bulkStores.has(this.DB_POINT_STORE)){e.next=4;break}return this.bulkBuffer||(this.bulkBuffer=new Map),this.bulkBuffer.set(t,n),e.abrupt("return",Promise.resolve());case 4:return e.abrupt("return",new Promise((function(e,i){var s,a=r.GetObjectStore(r.DB_POINT_STORE,"readwrite");try{s=a.add(n,t)}catch(e){throw"DataCloneError"===e.name&&Y("This engine doesn't know how to clone a Blob, use Firefox"),e}s.onsuccess=function(){e()},s.onerror=function(){Y("StorePoint error",this.error),i()}})));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"StoreAllPoints",value:(l=a(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t||(t=this.bulkBuffer),t&&this.bulkStores){e.next=3;break}return e.abrupt("return",Promise.reject());case 3:return e.abrupt("return",new Promise((function(e,r){var i=n.GetObjectStore(n.DB_POINT_STORE,"readwrite");try{t.forEach((function(e,t){i.add(e,t)})),n.bulkBuffer=null,e()}catch(e){Y("This engine doesn't know how to clone a Blob, use Firefox"),r(e)}})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"StoreState",value:(c=a(regeneratorRuntime.mark((function e(t,n){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,i){var s,a=r.GetObjectStore(r.DB_STATE_STORE,"readwrite");try{s=a.add(n,t)}catch(e){throw"DataCloneError"===e.name&&Y("This engine doesn't know how to clone a Blob, use Firefox"),e}s.onsuccess=function(){e()},s.onerror=function(){Y("StoreState error",this.error),i()}})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return c.apply(this,arguments)})},{key:"UpdateState",value:(o=a(regeneratorRuntime.mark((function e(t,n){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,i){var s,a=r.GetObjectStore(r.DB_STATE_STORE,"readwrite");try{s=a.put(n,t)}catch(e){throw"DataCloneError"===e.name&&Y("This engine doesn't know how to clone a Blob, use Firefox"),e}s.onsuccess=function(){e()},s.onerror=function(){Y("UpdateState error",this.error),i()}})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return o.apply(this,arguments)})},{key:"StorePath",value:(s=a(regeneratorRuntime.mark((function e(t,n){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,i){var s,a=r.GetObjectStore(r.DB_PATH_STORE,"readwrite");try{s=a.add(n,t)}catch(e){throw"DataCloneError"===e.name&&Y("This engine doesn't know how to clone a Blob, use Firefox"),e}s.onsuccess=function(){e()},s.onerror=function(){Y("StorePath error",this.error),i()}})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return s.apply(this,arguments)})},{key:"PrepareStore",value:(i=a(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.PointStore.GetAllPoints){e.next=2;break}return e.abrupt("return",!1);case 2:if(this.g_DB){e.next=7;break}return e.next=5,this.OpenDb();case 5:e.next=8;break;case 7:return e.abrupt("return",!1);case 8:return t=this.PointStore.GetGameStateCallback(),e.next=11,this.GetState(t.iGameID);case 11:if(n=e.sent){e.next=20;break}return e.next=15,Promise.all([this.ClearObjectStore(this.DB_POINT_STORE),this.ClearObjectStore(this.DB_PATH_STORE),this.ClearObjectStore(this.DB_STATE_STORE)]);case 15:return e.next=17,this.StoreState(t.iGameID,t);case 17:return e.abrupt("return",!1);case 20:if(n.sLastMoveGameTimeStamp===t.sLastMoveGameTimeStamp){e.next=26;break}return e.next=23,Promise.all([this.ClearObjectStore(this.DB_POINT_STORE),this.ClearObjectStore(this.DB_PATH_STORE),this.ClearObjectStore(this.DB_STATE_STORE)]);case 23:return e.abrupt("return",!1);case 26:if(!1!==t.bPointsAndPathsLoaded){e.next=48;break}return e.prev=27,e.next=30,this.BeginBulkStorage([this.DB_POINT_STORE,this.DB_PATH_STORE],"readonly");case 30:return e.next=32,this.PointStore.PrepareStore();case 32:if(e.t1=e.sent,e.t0=!0!==e.t1,e.t0){e.next=39;break}return e.next=37,this.PathStore.PrepareStore();case 37:e.t2=e.sent,e.t0=!0!==e.t2;case 39:if(!e.t0){e.next=43;break}return e.next=42,Promise.all([this.ClearObjectStore(this.DB_POINT_STORE),this.ClearObjectStore(this.DB_PATH_STORE),this.ClearObjectStore(this.DB_STATE_STORE)]);case 42:return e.abrupt("return",!1);case 43:return e.abrupt("return",!0);case 44:return e.prev=44,e.next=47,this.EndBulkStorage([this.DB_POINT_STORE,this.DB_PATH_STORE]);case 47:return e.finish(44);case 48:case"end":return e.stop()}}),e,this,[[27,,44,48]])}))),function(){return i.apply(this,arguments)})},{key:"BeginBulkStorage",value:(n=a(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.bulkStores||(this.bulkStores=new Map),r=t,this.bulkStores.has(r)||(i=this.g_DB.transaction(t,n),Array.isArray(t)?(this.bulkStores.set(r[0],i.objectStore(t[0])),this.bulkStores.set(r[1],i.objectStore(t[1]))):this.bulkStores.set(r,i.objectStore(t)));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"EndBulkStorage",value:(t=a(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.bulkStores&&(Array.isArray(t)?(this.bulkStores.delete(t[0]),this.bulkStores.delete(t[1])):this.bulkStores.delete(t),this.bulkStores.size<=0&&(this.bulkStores=null));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();function $(e){return F.apply(this,arguments)}function F(){return(F=a(regeneratorRuntime.mark((function e(t){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Array.prototype.slice.call(document.getElementsByTagName("script")).map((function(e){return e.src})).find((function(e){return-1!==e.indexOf("inkball")})).split("/").pop(),!(-1!==r.indexOf("min"))){e.next=8;break}return e.next=5,n.e(3).then(n.bind(null,1));case 5:i=e.sent,e.next=11;break;case 8:return e.next=10,n.e(2).then(n.bind(null,2));case 10:i=e.sent;case 11:if(f=i.$createOval,S=i.$createPolyline,v=i.$RemovePolyline,b=i.$createSVGVML,g=i.$createLine,y=i.hasDuplicates,P=i.sortPointsClockwise,-1!==t.iOtherPlayerID){e.next=17;break}return e.next=15,n.e(0).then(n.bind(null,3));case 15:i=e.sent,k=i;case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e){console.log(e)}function Y(){for(var e="",t=0;t<arguments.length;t++){var n=t<0||arguments.length<=t?void 0:arguments[t];n&&(e+=n)}console.error(e)}function H(e){return X.apply(this,arguments)}function X(){return(X=a(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){return setTimeout(e,t)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U=function(){function e(t,n,r,i,s,o,u,c,h){var l=this,m=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],p=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],_=arguments.length>11&&void 0!==arguments[11]&&arguments[11],f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:60,S=arguments.length>13&&void 0!==arguments[13]?arguments[13]:125;d(this,e),this.g_iGameID=t,this.g_iPlayerID=n,this.m_iOtherPlayerId=r,this.m_bIsCPUGame=-1===this.m_iOtherPlayerId,this.GameType=w[h],this.iConnErrCount=0,this.iExponentialBackOffMillis=2e3,this.COLOR_RED="red",this.COLOR_BLUE="blue",this.COLOR_OWNED_RED="#DC143C",this.COLOR_OWNED_BLUE="#8A2BE2",this.DRAWING_PATH_COLOR="black",this.m_bIsWon=!1,this.m_bPointsAndPathsLoaded=!1,this.m_iDelayBetweenMultiCaptures=4e3,this.m_iTooLong2Duration=S,this.m_Timer=null,this.m_ReconnectTimer=null,this.m_WaitStartTime=null,this.m_TimerOpts={countdownSeconds:f,labelSelector:"#debug2",initialStart:!0,countdownReachedHandler:this.CountDownReachedHandler.bind(this)},this.m_iSlowdownLevel=0,this.m_iGridSizeX=0,this.m_iGridSizeY=0,this.m_iGridWidth=0,this.m_iGridHeight=0,this.m_BoardSize=null,this.m_iLastX=-1,this.m_iLastY=-1,this.m_iMouseX=0,this.m_iMouseY=0,this.m_iPosX=0,this.m_iPosY=0,this.m_Screen=null,this.m_Debug=null,this.m_Player2Name=null,this.m_SurrenderButton=null,this.m_sMsgInputSel=null,this.m_sMsgSendButtonSel=null,this.m_sMsgListSel=null,this.m_CancelPath=null,this.m_StopAndDraw=null,this.m_bMouseDown=!1,this.m_bHandlingEvent=!1,this.m_bDrawLines=!1,this.m_sMessage="",this.m_bIsPlayingWithRed=m,this.m_bIsPlayerActive=p,this.m_sDotColor=this.m_bIsPlayingWithRed?this.COLOR_RED:this.COLOR_BLUE,this.m_PointRadius=4,this.m_Line=null,this.m_Lines=null,this.m_Points=null,this.m_bViewOnly=_,this.m_MouseCursorOval=null,this.m_ApplicationUserSettings=null,this.m_sLastMoveGameTimeStamp=null,null!==i&&""!==i&&(this.g_SignalRConnection=(new signalR.HubConnectionBuilder).withUrl(i,{transport:u,accessTokenFactory:function(){return"iGameID=".concat(this.g_iGameID,"&iPlayerID=").concat(this.g_iPlayerID)}.bind(this)}).withHubProtocol(o).configureLogging(s).build(),this.g_SignalRConnection.serverTimeoutInMilliseconds=c,this.g_SignalRConnection.onclose(function(){var e=a(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null!=t&&(Y(t),l.m_Screen.style.cursor="not-allowed",l.iConnErrCount++,setTimeout((function(){return l.Connect()}),4e3+l.iExponentialBackOffMillis*Math.max(l.iConnErrCount,5)));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))}var t,n,i,s,u,c,h,l,m,p,G,$,F,X,U,j,q,K,J,V,Z,Q,ee,te,ne,re,ie,se,ae,oe;return _(e,[{key:"GetPlayerPointsAndPaths",value:(oe=a(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==this.m_bPointsAndPathsLoaded){e.next=15;break}return e.next=3,this.g_SignalRConnection.invoke("GetPlayerPointsAndPaths",this.m_bViewOnly,this.g_iGameID);case 3:if(t=e.sent,void 0===(n=N.Deserialize(t)).Points){e.next=8;break}return e.next=8,this.SetAllPoints(n.Points);case 8:if(void 0===n.Paths){e.next=11;break}return e.next=11,this.SetAllPaths(n.Paths);case 11:return this.m_bPointsAndPathsLoaded=!0,e.abrupt("return",!0);case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,this)}))),function(){return oe.apply(this,arguments)})},{key:"Connect",value:(ae=a(regeneratorRuntime.mark((function e(){var t,n,r,i,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.g_SignalRConnection.start();case 3:if(this.iConnErrCount=0,z("connected; iConnErrCount = "+this.iConnErrCount),!1!==this.m_bViewOnly){e.next=19;break}if(null!==sessionStorage.getItem("ApplicationUserSettings")){e.next=16;break}return e.next=9,this.g_SignalRConnection.invoke("GetUserSettings");case 9:return(t=e.sent)&&(z(t),t=B.Deserialize(t),n=B.Serialize(t),sessionStorage.setItem("ApplicationUserSettings",n)),this.m_ApplicationUserSettings=new B(t.DesktopNotifications),e.next=14,this.GetPlayerPointsAndPaths();case 14:e.next=19;break;case 16:r=sessionStorage.getItem("ApplicationUserSettings"),i=B.Deserialize(r),this.m_ApplicationUserSettings=new B(i.DesktopNotifications);case 19:if(!1!==this.m_bPointsAndPathsLoaded){e.next=22;break}return e.next=22,this.GetPlayerPointsAndPaths();case 22:null!==this.m_ApplicationUserSettings&&!0===this.m_ApplicationUserSettings.DesktopNotifications&&this.SetupNotifications(),!0!==this.m_bIsCPUGame||this.m_bIsPlayerActive||this.StartCPUCalculation(),e.next=32;break;case 26:e.prev=26,e.t0=e.catch(0),Y(e.t0+"; iConnErrCount = "+this.iConnErrCount),this.m_Screen.style.cursor="not-allowed",this.iConnErrCount++,setTimeout((function(){return s.Connect()}),4e3+this.iExponentialBackOffMillis*Math.max(this.iConnErrCount,5));case 32:case"end":return e.stop()}}),e,this,[[0,26]])}))),function(){return ae.apply(this,arguments)})},{key:"SetupNotifications",value:function(){return window.Notification?"granted"===Notification.permission||void Notification.requestPermission().then((function(e){return"granted"===e||(z("User blocked notifications."),!1)})).catch((function(e){return Y(e),!1})):(z("Browser does not support notifications."),!1)}},{key:"NotifyBrowser",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Hi there!",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"How are you doing?";return!!document.hidden&&(window.Notification?"granted"===Notification.permission?(new Notification(e,{body:t,icon:"../img/homescreen.webp"}),!0):void Notification.requestPermission().then((function(n){return"granted"===n?(new Notification(e,{body:t,icon:"../img/homescreen.webp"}),!0):(z("User blocked notifications."),!1)})).catch((function(e){return Y(e),!1})):(z("Browser does not support notifications."),!1))}},{key:"StartSignalRConnection",value:(se=a(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this.g_SignalRConnection){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("signalr conn is null")));case 2:return!1===this.m_bPointsAndPathsLoaded&&(this.m_bPointsAndPathsLoaded=!t),this.g_SignalRConnection.on("ServerToClientPoint",function(){var e=a(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.g_iPlayerID!==t.iPlayerId&&(n=this.m_Player2Name.innerHTML,r=I.Format(n,t),(i=document.createElement("li")).textContent=r,document.querySelector(this.m_sMsgListSel).appendChild(i),this.NotifyBrowser("New Point",r)),e.next=3,this.ReceivedPointProcessing(t);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}().bind(this)),this.g_SignalRConnection.on("ServerToClientPath",function(e){if(Object.prototype.hasOwnProperty.call(e,"PointsAsString")||Object.prototype.hasOwnProperty.call(e,"pointsAsString")){var t=e;if(this.g_iPlayerID!==t.iPlayerId){var n=this.m_Player2Name.innerHTML,r=T.Format(n,t),i=document.createElement("li");i.textContent=r,document.querySelector(this.m_sMsgListSel).appendChild(i),this.NotifyBrowser("New Path",r)}this.ReceivedPathProcessing(t)}else{if(!Object.prototype.hasOwnProperty.call(e,"WinningPlayerId")&&!Object.prototype.hasOwnProperty.call(e,"winningPlayerId"))throw new Error("ServerToClientPath bad GetKind!");var s=e,a=L.Format(s),o=document.createElement("li");o.textContent=a,document.querySelector(this.m_sMsgListSel).appendChild(o),this.ReceivedWinProcessing(s),this.NotifyBrowser("We have a winner",a)}}.bind(this)),this.g_SignalRConnection.on("ServerToClientPlayerJoin",function(e){var t=e.OtherPlayerId||e.otherPlayerId;this.m_iOtherPlayerId=t;var n=C.Format(e),r=document.createElement("li");r.innerHTML='<strong class="text-primary">'.concat(n,"</strong>"),document.querySelector(this.m_sMsgListSel).appendChild(r),null!==this.m_SurrenderButton&&""!==e.OtherPlayerName&&(this.m_Player2Name.innerHTML=e.OtherPlayerName||e.otherPlayerName,this.m_SurrenderButton.value="surrender",this.ShowMobileStatus("Your move")),this.NotifyBrowser("Player joininig",n),this.m_bHandlingEvent=!1}.bind(this)),this.g_SignalRConnection.on("ServerToClientPlayerSurrender",function(e){var t=E.Format(e),n=document.createElement("li");n.innerHTML='<strong class="text-warning">'.concat(t,"</strong>"),document.querySelector(this.m_sMsgListSel).appendChild(n),this.m_bHandlingEvent=!1,t=""===t?"Game interrupted!":t,this.NotifyBrowser("Game interruption",t),alert(t),window.location.href="GamesList"}.bind(this)),this.g_SignalRConnection.on("ServerToClientPlayerWin",function(e){var t=L.Format(e),n=document.createElement("li");n.innerHTML='<strong class="text-warning">'.concat(t,"</strong>"),document.querySelector(this.m_sMsgListSel).appendChild(n),this.ReceivedWinProcessing(e),this.NotifyBrowser("We have a winner",t)}.bind(this)),this.g_SignalRConnection.on("ServerToClientPing",function(e){var t=this.m_Player2Name.innerHTML,n=D.Format(t,e),r=document.createElement("li");r.textContent=n,document.querySelector(this.m_sMsgListSel).appendChild(r),this.NotifyBrowser("User Message",n)}.bind(this)),this.g_SignalRConnection.on("ServerToClientOtherPlayerDisconnected",function(e){var t={countdownSeconds:5,initialStart:!0,countdownReachedHandler:function(){var t=e,n=document.createElement("li");n.innerHTML='<strong class="text-warning">'.concat(t,"</strong>"),document.querySelector(this.m_sMsgListSel).appendChild(n),this.NotifyBrowser("User disconnected",t),this.m_ReconnectTimer=null}.bind(this)};this.m_ReconnectTimer?this.m_ReconnectTimer.Reset(t):this.m_ReconnectTimer=new M(t)}.bind(this)),this.g_SignalRConnection.on("ServerToClientOtherPlayerConnected",function(e){if(this.m_ReconnectTimer)this.m_ReconnectTimer.Stop(),this.m_ReconnectTimer=null;else{var t=e,n=document.createElement("li");n.innerHTML='<strong class="text-primary">'.concat(t,"</strong>"),document.querySelector(this.m_sMsgListSel).appendChild(n),this.NotifyBrowser("User disconnected",t),this.m_ReconnectTimer=null}}.bind(this)),this.g_SignalRConnection.on("ServerToClientStopAndDraw",function(e){if(e){var t=this.m_Player2Name.innerHTML,n=A.Format(t),r=document.createElement("li");r.innerHTML='<strong class="text-info">'.concat(n,"</strong>"),document.querySelector(this.m_sMsgListSel).appendChild(r),this.NotifyBrowser("User "+t+" started drawing new path",n)}}.bind(this)),!1===this.m_bIsCPUGame&&(document.querySelector(this.m_sMsgSendButtonSel).addEventListener("click",function(){var e=a(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),""!==(n=document.querySelector(this.m_sMsgInputSel).value.trim())){e.next=4;break}return e.abrupt("return");case 4:return r=new D(n),e.next=7,this.SendAsyncData(r);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}().bind(this),!1),document.querySelector(this.m_sMsgInputSel).addEventListener("keyup",function(e){e.preventDefault(),13===e.keyCode&&document.querySelector(this.m_sMsgSendButtonSel).click()}.bind(this),!1)),e.abrupt("return",this.Connect());case 14:case"end":return e.stop()}}),e,this)}))),function(e){return se.apply(this,arguments)})},{key:"StopSignalRConnection",value:function(){null!==this.g_SignalRConnection&&(this.g_SignalRConnection.stop(),this.m_ReconnectTimer&&this.m_ReconnectTimer.Stop(),this.m_Timer&&this.m_Timer.Stop(),z("Stopped SignalR connection"))}},{key:"Debug",value:function(){switch(arguments.length){case 1:this.m_Debug.innerHTML=arguments.length<=0?void 0:arguments[0];break;case 2:var e=document.getElementById("debug"+(arguments.length<=1?void 0:arguments[1]));e.innerHTML=arguments.length<=0?void 0:arguments[0];break;default:for(var t=0;t<arguments.length;t++){var n=t<0||arguments.length<=t?void 0:arguments[t];if(n){var r=document.getElementById("debug"+t);r&&(r.innerHTML=n)}}}}},{key:"DisableSelection",value:function(e){void 0!==o(e.onselectstart)?e.onselectstart=function(){return!1}:void 0!==o(e.style.MozUserSelect)?e.style.MozUserSelect="none":e.onmousedown=function(){return!1}}},{key:"f_clientWidth",value:function(){return this.f_filterResults(window.innerWidth?window.innerWidth:0,document.documentElement?document.documentElement.clientWidth:0,document.body?document.body.clientWidth:0)}},{key:"f_clientHeight",value:function(){return this.f_filterResults(window.innerHeight?window.innerHeight:0,document.documentElement?document.documentElement.clientHeight:0,document.body?document.body.clientHeight:0)}},{key:"f_scrollLeft",value:function(){return this.f_filterResults(window.pageXOffset?window.pageXOffset:0,document.documentElement?document.documentElement.scrollLeft:0,document.body?document.body.scrollLeft:0)}},{key:"f_scrollTop",value:function(){return this.f_filterResults(window.pageYOffset?window.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)}},{key:"f_filterResults",value:function(e,t,n){var r=e||0;return t&&(!r||r>t)&&(r=t),n&&(!r||r>n)?n:r}},{key:"SetPoint",value:(ie=a(regeneratorRuntime.mark((function e(t,n,r,i){var s,a,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.m_Points.has(n*this.m_iGridWidth+t);case 2:if(!e.sent){e.next=4;break}return e.abrupt("return");case 4:s=t*this.m_iGridSizeX,a=n*this.m_iGridSizeY,(o=f(this.m_PointRadius,"true")).$move(s,a,this.m_PointRadius),e.t0=r,e.next=e.t0===R.POINT_FREE_RED?11:e.t0===R.POINT_FREE_BLUE?14:e.t0===R.POINT_FREE?17:e.t0===R.POINT_STARTING?20:e.t0===R.POINT_IN_PATH?23:e.t0===R.POINT_OWNED_BY_RED?26:e.t0===R.POINT_OWNED_BY_BLUE?29:32;break;case 11:return u=this.COLOR_RED,o.$SetStatus(r),e.abrupt("break",34);case 14:return u=this.COLOR_BLUE,o.$SetStatus(r),e.abrupt("break",34);case 17:case 20:return u=this.m_sDotColor,o.$SetStatus(r),e.abrupt("break",34);case 23:return u=this.g_iPlayerID===i?!0===this.m_bIsPlayingWithRed?this.COLOR_RED:this.COLOR_BLUE:!0===this.m_bIsPlayingWithRed?this.COLOR_BLUE:this.COLOR_RED,o.$SetStatus(r),e.abrupt("break",34);case 26:return u=this.COLOR_OWNED_RED,o.$SetStatus(r),e.abrupt("break",34);case 29:return u=this.COLOR_OWNED_BLUE,o.$SetStatus(r),e.abrupt("break",34);case 32:return alert("bad point"),e.abrupt("break",34);case 34:return o.$SetFillColor(u),o.$SetStrokeColor(u),e.next=38,this.m_Points.set(n*this.m_iGridWidth+t,o);case 38:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return ie.apply(this,arguments)})},{key:"GetGameStateForIndexedDb",value:function(){return{iGameID:this.g_iGameID,iPlayerID:this.g_iPlayerID,iOtherPlayerId:this.m_iOtherPlayerId,sLastMoveGameTimeStamp:this.m_sLastMoveGameTimeStamp,bPointsAndPathsLoaded:this.m_bPointsAndPathsLoaded,iGridWidth:this.m_iGridWidth,iGridSizeX:this.m_iGridSizeX,iGridSizeY:this.m_iGridSizeY}}},{key:"CreateScreenPointFromIndexedDb",value:function(e,t,n,r){var i,s=e*this.m_iGridSizeX,a=t*this.m_iGridSizeY,o=f(this.m_PointRadius,"true");switch(o.$move(s,a,this.m_PointRadius),n){case R.POINT_FREE_RED:i=this.COLOR_RED,o.$SetStatus(n);break;case R.POINT_FREE_BLUE:i=this.COLOR_BLUE,o.$SetStatus(n);break;case R.POINT_FREE:case R.POINT_STARTING:i=this.m_sDotColor,o.$SetStatus(n);break;case R.POINT_IN_PATH:i=r,o.$SetStatus(n);break;case R.POINT_OWNED_BY_RED:i=this.COLOR_OWNED_RED,o.$SetStatus(n);break;case R.POINT_OWNED_BY_BLUE:i=this.COLOR_OWNED_BLUE,o.$SetStatus(n);break;default:alert("bad point")}return o.$SetFillColor(i),o.$SetStrokeColor(i),o}},{key:"SetAllPoints",value:(re=a(regeneratorRuntime.mark((function e(t){var n,i,s,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=function(e){return e-1},n=function(e){return e-3},e.prev=2,e.next=5,this.m_Points.BeginBulkStorage();case 5:s=r(t),e.prev=6,s.s();case 8:if((a=s.n()).done){e.next=14;break}return o=a.value,e.next=12,this.SetPoint(o[0],o[1],n(o[2]),i(o[3]));case 12:e.next=8;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(6),s.e(e.t0);case 19:return e.prev=19,s.f(),e.finish(19);case 22:return e.prev=22,e.next=25,this.m_Points.EndBulkStorage();case 25:return e.finish(22);case 26:case"end":return e.stop()}}),e,this,[[2,,22,26],[6,16,19,22]])}))),function(e){return re.apply(this,arguments)})},{key:"SetPath",value:(ne=a(regeneratorRuntime.mark((function e(t,n,i){var s,a,o,u,c,h,l,m,d,p,_,f,v=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=v.length>3&&void 0!==v[3]?v[3]:0,a=t.split(" "),o="",u="",c=null,m=R.POINT_STARTING,d=r(a),e.prev=4,d.s();case 6:if((p=d.n()).done){e.next=21;break}return _=p.value,c=_.split(","),h=parseInt(c[0]),l=parseInt(c[1]),e.next=13,this.m_Points.get(l*this.m_iGridWidth+h);case 13:null!=(c=e.sent)&&(c.$SetStatus(m),m=R.POINT_IN_PATH),h*=this.m_iGridSizeX,l*=this.m_iGridSizeY,u+="".concat(o).concat(h,",").concat(l),o=" ";case 19:e.next=6;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(4),d.e(e.t0);case 26:return e.prev=26,d.f(),e.finish(26);case 29:return c=a[0].split(","),h=parseInt(c[0]),l=parseInt(c[1]),e.next=34,this.m_Points.get(l*this.m_iGridWidth+h);case 34:return null!=(c=e.sent)&&c.$SetStatus(m),h*=this.m_iGridSizeX,l*=this.m_iGridSizeY,u+="".concat(o).concat(h,",").concat(l),(f=S(3,u,i?this.m_sDotColor:n?this.COLOR_BLUE:this.COLOR_RED)).$SetID(s),e.next=43,this.m_Lines.push(f);case 43:case"end":return e.stop()}}),e,this,[[4,23,26,29]])}))),function(e,t,n){return ne.apply(this,arguments)})},{key:"CreateScreenPathFromIndexedDb",value:(te=a(regeneratorRuntime.mark((function e(t,n,i){var s,a,o,u,c,h,l,m,d,p,_;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=t.split(" "),a="",o="",u=null,l=R.POINT_STARTING,m=r(s),e.prev=3,m.s();case 5:if((d=m.n()).done){e.next=18;break}return p=d.value,u=p.split(","),c=parseInt(u[0]),h=parseInt(u[1]),e.next=12,this.m_Points.get(h*this.m_iGridWidth+c);case 12:null!=(u=e.sent)&&(u.$SetStatus(l),l=R.POINT_IN_PATH),o+="".concat(a).concat(c,",").concat(h),a=" ";case 16:e.next=5;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(3),m.e(e.t0);case 23:return e.prev=23,m.f(),e.finish(23);case 26:return u=s[0].split(","),c=parseInt(u[0]),h=parseInt(u[1]),e.next=31,this.m_Points.get(h*this.m_iGridWidth+c);case 31:return null!=(u=e.sent)&&u.$SetStatus(l),o+="".concat(a).concat(c,",").concat(h),(_=S(3,o,n)).$SetID(i),e.abrupt("return",_);case 37:case"end":return e.stop()}}),e,this,[[3,20,23,26]])}))),function(e,t,n){return te.apply(this,arguments)})},{key:"SetAllPaths",value:(ee=a(regeneratorRuntime.mark((function e(t){var n,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.m_Lines.BeginBulkStorage();case 3:n=r(t),e.prev=4,n.s();case 6:if((i=n.n()).done){e.next=14;break}if((s=i.value).iGameId===this.g_iGameID){e.next=10;break}throw new Error("Bad game from path!");case 10:return e.next=12,this.SetPath(s.PointsAsString,this.m_bIsPlayingWithRed,s.iPlayerId===this.g_iPlayerID,s.iId);case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),n.e(e.t0);case 19:return e.prev=19,n.f(),e.finish(19);case 22:return e.prev=22,e.next=25,this.m_Lines.EndBulkStorage();case 25:return e.finish(22);case 26:case"end":return e.stop()}}),e,this,[[0,,22,26],[4,16,19,22]])}))),function(e){return ee.apply(this,arguments)})},{key:"IsPointBelongingToLine",value:function(e,t,n){var i,s=r(e);try{for(s.s();!(i=s.n()).done;){var a=i.value.split(","),o=a[0],u=a[1];if(o===t&&u===n)return!0}}catch(e){s.e(e)}finally{s.f()}return!1}},{key:"pnpoly",value:function(e,t,n,r,i){var s,a,o=!1;for(s=0,a=e-1;s<e;a=s++)(n[s]<=i&&i<n[a]||n[a]<=i&&i<n[s])&&r<(t[a]-t[s])*(i-n[s])/(n[a]-n[s])+t[s]&&(o=!o);return o}},{key:"pnpoly2",value:function(e,t,n){var r,i,s=e.length,a=!1;for(r=0,i=s-1;r<s;i=r++){var o=e[r],u=e[i];(o.y<=n&&n<u.y||u.y<=n&&n<o.y)&&t<(u.x-o.x)*(n-o.y)/(u.y-o.y)+o.x&&(a=!a)}return a}},{key:"SurroundOponentPoints",value:(Q=a(regeneratorRuntime.mark((function e(){var t,n,i,s,a,o,u,c,h,l,m,d,p,_,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.m_Line.$GetPointsArray(),!y(t.slice(0,-1).map((function(e){return e.x+"_"+e.y})))&&t[0].x===t[t.length-1].x&&t[0].y===t[t.length-1].y){e.next=4;break}return e.abrupt("return",{OwnedPoints:void 0,owned:"",path:"",errorDesc:"Points not unique"});case 4:return this.m_sDotColor===this.COLOR_RED?(n=this.COLOR_BLUE,i=R.POINT_OWNED_BY_RED,s=this.COLOR_OWNED_RED):(n=this.COLOR_RED,i=R.POINT_OWNED_BY_BLUE,s=this.COLOR_OWNED_BLUE),a="",o="",u="",c=[],e.next=8,this.m_Points.values();case 8:h=e.sent,l=r(h);try{for(l.s();!(m=l.n()).done;)void 0!==(d=m.value)&&d.$GetFillColor()===n&&[R.POINT_FREE_BLUE,R.POINT_FREE_RED].includes(d.$GetStatus())&&(p=d.$GetPosition(),_=p.x,f=p.y,!1!==this.pnpoly2(t,_,f)&&(_/=this.m_iGridSizeX,f/=this.m_iGridSizeY,o+="".concat(u).concat(_,",").concat(f),u=" ",c.push({point:d,revertStatus:d.$GetStatus(),revertFillColor:d.$GetFillColor(),revertStrokeColor:d.$GetStrokeColor()}),d.$SetStatus(i,!0),d.$SetFillColor(s),d.$SetStrokeColor(s)))}catch(e){l.e(e)}finally{l.f()}return""!==o&&(a=t.map(function(e){var t=e.x,n=e.y;return null===t||null===n?"":(t/=this.m_iGridSizeX,n/=this.m_iGridSizeY,"".concat(t,",").concat(n))}.bind(this)).join(" ")),e.abrupt("return",{OwnedPoints:c,owned:o,PathPoints:[],path:a,errorDesc:"No surrounded points"});case 13:case"end":return e.stop()}}),e,this)}))),function(){return Q.apply(this,arguments)})},{key:"IsPointOutsideAllPaths",value:(Z=a(regeneratorRuntime.mark((function e(t,n){var i,s,a,o,u,c,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t*this.m_iGridSizeX,s=n*this.m_iGridSizeY,e.next=3,this.m_Lines.all();case 3:a=e.sent,o=r(a),e.prev=5,o.s();case 7:if((u=o.n()).done){e.next=14;break}if(c=u.value,h=c.$GetPointsArray(),!1===this.pnpoly2(h,i,s)){e.next=12;break}return e.abrupt("return",!1);case 12:e.next=7;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(5),o.e(e.t0);case 19:return e.prev=19,o.f(),e.finish(19);case 22:return e.abrupt("return",!0);case 23:case"end":return e.stop()}}),e,this,[[5,16,19,22]])}))),function(e,t){return Z.apply(this,arguments)})},{key:"CreateXMLWaitForPlayerRequest",value:function(){}},{key:"CreateXMLPutPointRequest",value:function(e,t){return new I(0,this.g_iGameID,this.g_iPlayerID,e,t,this.m_bIsPlayingWithRed?R.POINT_FREE_RED:R.POINT_FREE_BLUE,0)}},{key:"CreateXMLPutPathRequest",value:function(e){return new T(0,this.g_iGameID,this.g_iPlayerID,e.path,e.owned)}},{key:"SendAsyncData",value:(V=a(regeneratorRuntime.mark((function e(t){var n,r,i,s,a,o=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=o.length>1&&void 0!==o[1]?o[1]:void 0,e.t0=t.GetKind(),e.next=e.t0===x.POINT?4:e.t0===x.PATH?19:e.t0===x.PING?44:e.t0===x.STOP_AND_DRAW?55:69;break;case 4:return z(I.Format("some player",t)),this.m_bHandlingEvent=!0,e.prev=6,e.next=9,this.g_SignalRConnection.invoke("ClientToServerPoint",t);case 9:return r=e.sent,e.next=12,this.ReceivedPointProcessing(r);case 12:e.next=18;break;case 14:e.prev=14,e.t1=e.catch(6),Y(e.t1.toString()),void 0!==n&&n();case 18:return e.abrupt("break",71);case 19:return z(T.Format("some player",t)),this.m_bHandlingEvent=!0,e.prev=21,e.next=24,this.g_SignalRConnection.invoke("ClientToServerPath",t);case 24:if(i=e.sent,!Object.prototype.hasOwnProperty.call(i,"WinningPlayerId")&&!Object.prototype.hasOwnProperty.call(i,"winningPlayerId")){e.next=30;break}s=i,this.ReceivedWinProcessing(s),e.next=37;break;case 30:if(!Object.prototype.hasOwnProperty.call(i,"PointsAsString")&&!Object.prototype.hasOwnProperty.call(i,"pointsAsString")){e.next=36;break}return a=i,e.next=34,this.ReceivedPathProcessing(a);case 34:e.next=37;break;case 36:throw new Error("ClientToServerPath bad GetKind!");case 37:e.next=43;break;case 39:e.prev=39,e.t2=e.catch(21),Y(e.t2.toString()),void 0!==n&&n();case 43:return e.abrupt("break",71);case 44:return e.prev=44,e.next=47,this.g_SignalRConnection.invoke("ClientToServerPing",t);case 47:document.querySelector(this.m_sMsgInputSel).value="",document.querySelector(this.m_sMsgSendButtonSel).disabled="disabled",e.next=54;break;case 51:e.prev=51,e.t3=e.catch(44),Y(e.t3.toString());case 54:return e.abrupt("break",71);case 55:return e.prev=55,e.next=58,this.g_SignalRConnection.invoke("ClientToServerStopAndDraw",t);case 58:this.m_bDrawLines=!0,this.m_iLastX=this.m_iLastY=-1,this.m_Line=null,this.m_bIsPlayerActive=!0,this.m_StopAndDraw.disabled="disabled",e.next=68;break;case 65:e.prev=65,e.t4=e.catch(55),Y(e.t4.toString());case 68:return e.abrupt("break",71);case 69:return Y("unknown object"),e.abrupt("break",71);case 71:case"end":return e.stop()}}),e,this,[[6,14],[21,39],[44,51],[55,65]])}))),function(e){return V.apply(this,arguments)})},{key:"CountDownReachedHandler",value:function(e){e&&(e.innerHTML=""),this.m_StopAndDraw.disabled=this.m_CancelPath.disabled="disabled",this.m_Timer=null,this.m_bIsPlayerActive=!1}},{key:"ReceivedPointProcessing",value:(J=a(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.iX,r=t.iY,i=void 0!==t.Status?t.Status:t.status,this.m_sLastMoveGameTimeStamp=(void 0!==t.TimeStamp?t.TimeStamp:new Date(t.timeStamp)).toISOString(),e.next=4,this.SetPoint(n,r,i,t.iPlayerId);case 4:if(this.g_iPlayerID===t.iPlayerId){e.next=16;break}if(this.m_bIsPlayerActive=!0,this.ShowMobileStatus("Oponent has moved, your turn"),this.m_Screen.style.cursor="crosshair",null===this.m_Line){e.next=11;break}return e.next=11,this.OnCancelClick();case 11:this.m_StopAndDraw.disabled="",this.m_bDrawLines?this.m_StopAndDraw.value="Draw dot":this.m_StopAndDraw.value="Draw line",this.m_Timer&&(this.m_Timer.Stop(),this.m_Timer=null),e.next=24;break;case 16:this.m_bIsPlayerActive=!1,this.ShowMobileStatus("Waiting for oponent move"),this.m_Screen.style.cursor="wait",this.m_CancelPath.disabled="disabled",this.m_StopAndDraw.disabled="",this.m_StopAndDraw.value="Stop and Draw",this.m_Timer?this.m_Timer.Reset(this.m_TimerOpts):this.m_Timer=new M(this.m_TimerOpts),!0!==this.m_bIsCPUGame||this.m_bIsPlayerActive||this.StartCPUCalculation();case 24:this.m_bHandlingEvent=!1;case 25:case"end":return e.stop()}}),e,this)}))),function(e){return J.apply(this,arguments)})},{key:"ReceivedPathProcessing",value:(K=a(regeneratorRuntime.mark((function e(t){var n,i,s,a,o,u,c,h,l,m,d,p,_,f,S;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.m_sLastMoveGameTimeStamp=(void 0!==t.TimeStamp?t.TimeStamp:new Date(t.timeStamp)).toISOString(),this.g_iPlayerID===t.iPlayerId){e.next=38;break}return n=t.PointsAsString||t.pointsAsString,i=t.OwnedPointsAsString||t.ownedPointsAsString,e.next=5,this.SetPath(n,this.m_sDotColor===this.COLOR_RED,!1,t.iId);case 5:s=i.split(" "),a=this.m_sDotColor===this.COLOR_RED?R.POINT_OWNED_BY_RED:R.POINT_OWNED_BY_BLUE,o=this.m_sDotColor===this.COLOR_RED?this.COLOR_OWNED_RED:this.COLOR_OWNED_BLUE,u=r(s),e.prev=9,u.s();case 11:if((c=u.n()).done){e.next=21;break}return h=c.value,l=h.split(","),m=parseInt(l[0]),d=parseInt(l[1]),e.next=17,this.m_Points.get(d*this.m_iGridWidth+m);case 17:void 0!==(l=e.sent)&&(l.$SetStatus(a),l.$SetFillColor(o),l.$SetStrokeColor(o));case 19:e.next=11;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(9),u.e(e.t0);case 26:return e.prev=26,u.f(),e.finish(26);case 29:if(this.m_bIsPlayerActive=!0,this.ShowMobileStatus("Oponent has moved, your turn"),this.m_Screen.style.cursor="crosshair",null===this.m_Line){e.next=35;break}return e.next=35,this.OnCancelClick();case 35:this.m_StopAndDraw.disabled="",e.next=57;break;case 38:return p=this.m_Line.$GetPointsArray(),_=p[0].x,f=p[0].y,_/=this.m_iGridSizeX,f/=this.m_iGridSizeY,e.next=44,this.m_Points.get(f*this.m_iGridWidth+_);case 44:return void 0!==(S=e.sent)&&S.$SetStatus(R.POINT_IN_PATH),this.m_Line.$SetWidthAndColor(3,this.m_sDotColor),this.m_Line.$SetID(t.iId),e.next=50,this.m_Lines.push(this.m_Line);case 50:this.m_iLastX=this.m_iLastY=-1,this.m_Line=null,this.m_bIsPlayerActive=!1,this.ShowMobileStatus("Waiting for oponent move"),this.m_Screen.style.cursor="wait",this.m_StopAndDraw.disabled=this.m_CancelPath.disabled="disabled",!0!==this.m_bIsCPUGame||this.m_bIsPlayerActive||this.StartCPUCalculation();case 57:this.m_bDrawLines?this.m_StopAndDraw.value="Draw dot":this.m_StopAndDraw.value="Draw line",this.m_bHandlingEvent=!1,this.m_Timer&&(this.m_Timer.Stop(),this.m_Timer=null);case 60:case"end":return e.stop()}}),e,this,[[9,23,26,29]])}))),function(e){return K.apply(this,arguments)})},{key:"ReceivedWinProcessing",value:function(e){this.ShowMobileStatus("Win situation"),this.m_bHandlingEvent=!1;var t=L.Format(e),n=void 0!==e.Status?e.Status:e.status,r=e.WinningPlayerId||e.winningPlayerId;((n===O.RED_WINS||n===O.GREEN_WINS)&&r>0||n===O.DRAW_WIN)&&(alert(""===t?"Game won!":t),window.location.href="GamesList")}},{key:"Check4Win",value:function(e,t,n,r){var i;switch(this.GameType){case w.FIRST_CAPTURE:return e.length>0?this.m_bIsPlayingWithRed?O.RED_WINS:O.GREEN_WINS:t.length>0?this.m_bIsPlayingWithRed?O.GREEN_WINS:O.RED_WINS:O.NO_WIN;case w.FIRST_5_CAPTURES:return i=this.m_bIsPlayingWithRed?R.POINT_OWNED_BY_BLUE:R.POINT_OWNED_BY_RED,r.filter((function(e){return null!==e.iEnclosingPathId&&e.$GetStatus()===i})).length>=5?this.m_bIsPlayingWithRed?O.GREEN_WINS:O.RED_WINS:(i=this.m_bIsPlayingWithRed?R.POINT_OWNED_BY_RED:R.POINT_OWNED_BY_BLUE,n.filter((function(e){return null!==e.iEnclosingPathId&&e.$GetStatus()===i})).length>=5?this.m_bIsPlayingWithRed?O.RED_WINS:O.GREEN_WINS:O.NO_WIN);case w.FIRST_5_PATHS:return t.length>=5?this.m_bIsPlayingWithRed?O.GREEN_WINS:O.RED_WINS:e.length>=5?this.m_bIsPlayingWithRed?O.RED_WINS:O.GREEN_WINS:O.NO_WIN;case w.FIRST_5_ADVANTAGE_PATHS:var s=e.length-t.length;return s>=5?this.m_bIsPlayingWithRed?O.RED_WINS:O.GREEN_WINS:s<=-5?this.m_bIsPlayingWithRed?O.GREEN_WINS:O.RED_WINS:O.NO_WIN;default:throw new Error("Wrong game type")}}},{key:"ShowMobileStatus",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";"???"===this.m_Player2Name.innerHTML?this.m_bIsPlayerActive?this.m_GameStatus.style.color=this.COLOR_RED:this.m_GameStatus.style.color=this.COLOR_BLUE:this.m_bIsPlayerActive?this.m_bIsPlayingWithRed?this.m_GameStatus.style.color=this.COLOR_RED:this.m_GameStatus.style.color=this.COLOR_BLUE:this.m_bIsPlayingWithRed?this.m_GameStatus.style.color=this.COLOR_BLUE:this.m_GameStatus.style.color=this.COLOR_RED,null!==e&&""!==e?this.Debug(e,0):this.Debug("",0)}},{key:"OnMouseMove",value:(q=a(regeneratorRuntime.mark((function e(t){var n,r,i,s,o,u,c,h,l,m,d,p,_=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.m_bIsPlayerActive&&"???"!==this.m_Player2Name.innerHTML&&!0!==this.m_bHandlingEvent&&!(this.iConnErrCount>0)){e.next=3;break}return this.iConnErrCount<=0&&!this.m_bIsPlayerActive&&(this.m_Screen.style.cursor="wait"),e.abrupt("return");case 3:if(n=(t?t.clientX:window.event.clientX)-this.m_Screen.offsetLeft+this.f_scrollLeft()+.5*this.m_iGridSizeX,r=(t?t.clientY:window.event.clientY)-this.m_Screen.offsetTop+this.f_scrollTop()+.5*this.m_iGridSizeY,n=parseInt(n/this.m_iGridSizeX),r=parseInt(r/this.m_iGridSizeY),i=n*this.m_iGridSizeX,s=r*this.m_iGridSizeY,this.m_MouseCursorOval.$move(i,s,this.m_PointRadius),this.m_MouseCursorOval.$Show(),this.Debug("[".concat(n,",").concat(r,"]"),1),!this.m_bDrawLines){e.next=69;break}if(null!==this.m_Line?this.m_Screen.style.cursor="move":this.m_Screen.style.cursor="crosshair",!0!==this.m_bMouseDown){e.next=67;break}if(!((this.m_iLastX!==n||this.m_iLastY!==r)&&Math.abs(parseInt(this.m_iLastX-n))<=1&&Math.abs(parseInt(this.m_iLastY-r))<=1&&this.m_iLastX>=0&&this.m_iLastY>=0)){e.next=67;break}if(null===this.m_Line){e.next=60;break}return e.next=19,this.m_Points.get(this.m_iLastY*this.m_iGridWidth+this.m_iLastX);case 19:return o=e.sent,e.next=22,this.m_Points.get(r*this.m_iGridWidth+n);case 22:if(u=e.sent,this.m_CancelPath.disabled=this.m_Line.$GetLength()>=2?"":"disabled",void 0===o||void 0===u||o.$GetFillColor()!==this.m_sDotColor||u.$GetFillColor()!==this.m_sDotColor){e.next=58;break}if(!((c=this.m_Line.$ContainsPoint(i,s))<1&&u.$GetStatus()!==R.POINT_STARTING&&!0===this.m_Line.$AppendPoints(i,s,this.m_iGridSizeX,this.m_iGridSizeY))){e.next=32;break}u.$SetStatus(R.POINT_IN_PATH,!0),this.m_iLastX=n,this.m_iLastY=r,e.next=58;break;case 32:if(1!==c||u.$GetStatus()!==R.POINT_STARTING||!0!==this.m_Line.$AppendPoints(i,s,this.m_iGridSizeX,this.m_iGridSizeY)){e.next=48;break}return e.next=35,this.SurroundOponentPoints();case 35:if(!((h=e.sent).owned.length>0)){e.next=43;break}return this.Debug("Closing path",0),this.rAF_FrameID=null,e.next=41,this.SendAsyncData(this.CreateXMLPutPathRequest(h),a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.OnCancelClick();case 2:h.OwnedPoints.forEach((function(e){var t=e.point,n=e.revertFillColor,r=e.revertStrokeColor;t.$RevertOldStatus(),t.$SetFillColor(n),t.$SetStrokeColor(r)})),_.m_bHandlingEvent=!1;case 4:case"end":return e.stop()}}),e)}))));case 41:e.next=44;break;case 43:this.Debug("".concat(h.errorDesc?h.errorDesc:"Wrong path",", cancell it or refresh page"),0);case 44:this.m_iLastX=n,this.m_iLastY=r,e.next=58;break;case 48:if(!(c>=1&&o.$GetStatus()===R.POINT_IN_PATH&&this.m_Line.$GetPointsString().endsWith("".concat(this.m_iLastX*this.m_iGridSizeX,",").concat(this.m_iLastY*this.m_iGridSizeY)))){e.next=58;break}if(!(this.m_Line.$GetLength()>2)){e.next=56;break}o.$RevertOldStatus(),this.m_Line.$RemoveLastPoint(),this.m_iLastX=n,this.m_iLastY=r,e.next=58;break;case 56:return e.next=58,this.OnCancelClick();case 58:e.next=67;break;case 60:return e.next=62,this.m_Points.get(this.m_iLastY*this.m_iGridWidth+this.m_iLastX);case 62:return l=e.sent,e.next=65,this.m_Points.get(r*this.m_iGridWidth+n);case 65:m=e.sent,void 0!==l&&void 0!==m&&l.$GetFillColor()===this.m_sDotColor&&m.$GetFillColor()===this.m_sDotColor&&(d=this.m_iLastX*this.m_iGridSizeX,p=this.m_iLastY*this.m_iGridSizeY,this.m_Line=S(6,d+","+p+" "+i+","+s,this.DRAWING_PATH_COLOR),this.m_CancelPath.disabled="",l.$SetStatus(R.POINT_STARTING,!0),m.$SetStatus(R.POINT_IN_PATH,!0),this.m_iLastX=n,this.m_iLastY=r);case 67:e.next=70;break;case 69:this.m_Screen.style.cursor="crosshair";case 70:case"end":return e.stop()}}),e,this)}))),function(e){return q.apply(this,arguments)})},{key:"OnMouseDown",value:(j=a(regeneratorRuntime.mark((function e(t){var n,r,i,s,o,u,c,h,l,m,d,p,_,f,v,b,g,y=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.m_bIsPlayerActive&&"???"!==this.m_Player2Name.innerHTML&&!0!==this.m_bHandlingEvent&&!(this.iConnErrCount>0)){e.next=2;break}return e.abrupt("return");case 2:if(n=(t?t.clientX:window.event.clientX)-this.m_Screen.offsetLeft+this.f_scrollLeft()+.5*this.m_iGridSizeX,r=(t?t.clientY:window.event.clientY)-this.m_Screen.offsetTop+this.f_scrollTop()+.5*this.m_iGridSizeY,n=this.m_iMouseX=parseInt(n/this.m_iGridSizeX),r=this.m_iMouseY=parseInt(r/this.m_iGridSizeY),this.m_bMouseDown=!0,this.m_bDrawLines){e.next=31;break}return this.m_iLastX=n,this.m_iLastY=r,s=r,n=(i=n)*this.m_iGridSizeX,r=s*this.m_iGridSizeY,e.next=16,this.m_Points.get(s*this.m_iGridWidth+i);case 16:if(e.t0=e.sent,e.t1=void 0,e.t0===e.t1){e.next=21;break}return this.Debug("Wrong point - already existing",0),e.abrupt("return");case 21:return e.next=23,this.IsPointOutsideAllPaths(i,s);case 23:if(e.sent){e.next=26;break}return this.Debug("Wrong point, Point is not outside all paths",0),e.abrupt("return");case 26:return this.rAF_FrameID=null,e.next=29,this.SendAsyncData(this.CreateXMLPutPointRequest(i,s),(function(){y.m_bMouseDown=!1,y.m_bHandlingEvent=!1}));case 29:e.next=94;break;case 31:if(!((this.m_iLastX!==n||this.m_iLastY!==r)&&Math.abs(parseInt(this.m_iLastX-n))<=1&&Math.abs(parseInt(this.m_iLastY-r))<=1&&this.m_iLastX>=0&&this.m_iLastY>=0)){e.next=89;break}if(null===this.m_Line){e.next=78;break}return e.next=35,this.m_Points.get(this.m_iLastY*this.m_iGridWidth+this.m_iLastX);case 35:return o=e.sent,e.next=38,this.m_Points.get(r*this.m_iGridWidth+n);case 38:if(u=e.sent,this.m_CancelPath.disabled=this.m_Line.$GetLength()>=2?"":"disabled",void 0===o||void 0===u||o.$GetFillColor()!==this.m_sDotColor||u.$GetFillColor()!==this.m_sDotColor){e.next=76;break}if(c=n*this.m_iGridSizeX,h=r*this.m_iGridSizeY,!((l=this.m_Line.$ContainsPoint(c,h))<1&&u.$GetStatus()!==R.POINT_STARTING&&!0===this.m_Line.$AppendPoints(c,h,this.m_iGridSizeX,this.m_iGridSizeY))){e.next=50;break}u.$SetStatus(R.POINT_IN_PATH,!0),this.m_iLastX=n,this.m_iLastY=r,e.next=76;break;case 50:if(1!==l||u.$GetStatus()!==R.POINT_STARTING||!0!==this.m_Line.$AppendPoints(c,h,this.m_iGridSizeX,this.m_iGridSizeY)){e.next=66;break}return e.next=53,this.SurroundOponentPoints();case 53:if(!((m=e.sent).owned.length>0)){e.next=61;break}return this.Debug("Closing path",0),this.rAF_FrameID=null,e.next=59,this.SendAsyncData(this.CreateXMLPutPathRequest(m),a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.OnCancelClick();case 2:m.OwnedPoints.forEach((function(e){var t=e.point,n=e.revertFillColor,r=e.revertStrokeColor;t.$RevertOldStatus(),t.$SetFillColor(n),t.$SetStrokeColor(r)})),y.m_bMouseDown=!1,y.m_bHandlingEvent=!1;case 5:case"end":return e.stop()}}),e)}))));case 59:e.next=62;break;case 61:this.Debug("".concat(m.errorDesc?m.errorDesc:"Wrong path",", cancell it or refresh page"),0);case 62:this.m_iLastX=n,this.m_iLastY=r,e.next=76;break;case 66:if(!(l>=1&&o.$GetStatus()===R.POINT_IN_PATH&&this.m_Line.$GetPointsString().endsWith("".concat(this.m_iLastX*this.m_iGridSizeX,",").concat(this.m_iLastY*this.m_iGridSizeY)))){e.next=76;break}if(!(this.m_Line.$GetLength()>2)){e.next=74;break}o.$RevertOldStatus(),this.m_Line.$RemoveLastPoint(),this.m_iLastX=n,this.m_iLastY=r,e.next=76;break;case 74:return e.next=76,this.OnCancelClick();case 76:e.next=87;break;case 78:return e.next=80,this.m_Points.get(this.m_iLastY*this.m_iGridWidth+this.m_iLastX);case 80:return d=e.sent,e.next=83,this.m_Points.get(r*this.m_iGridWidth+n);case 83:p=e.sent,void 0!==d&&void 0!==p&&d.$GetFillColor()===this.m_sDotColor&&p.$GetFillColor()===this.m_sDotColor&&(_=this.m_iLastX*this.m_iGridSizeX,f=this.m_iLastY*this.m_iGridSizeY,v=n*this.m_iGridSizeX,b=r*this.m_iGridSizeY,this.m_Line=S(6,_+","+f+" "+v+","+b,this.DRAWING_PATH_COLOR),this.m_CancelPath.disabled="",d.$SetStatus(R.POINT_STARTING,!0),p.$SetStatus(R.POINT_IN_PATH,!0)),this.m_iLastX=n,this.m_iLastY=r;case 87:e.next=94;break;case 89:if(!(this.m_iLastX<0||this.m_iLastY<0)){e.next=94;break}return e.next=92,this.m_Points.get(r*this.m_iGridWidth+n);case 92:void 0!==(g=e.sent)&&g.$GetFillColor()===this.m_sDotColor&&(this.m_iLastX=n,this.m_iLastY=r);case 94:case"end":return e.stop()}}),e,this)}))),function(e){return j.apply(this,arguments)})},{key:"OnMouseUp",value:function(){this.m_bMouseDown=!1}},{key:"OnMouseLeave",value:function(){this.m_MouseCursorOval.$Hide()}},{key:"OnStopAndDraw",value:(U=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.m_Timer){e.next=11;break}if(null===this.m_Line){e.next=4;break}return e.next=4,this.OnCancelClick();case 4:this.m_bDrawLines=!this.m_bDrawLines,n=t.target,this.m_bDrawLines?n.value="Draw dot":n.value="Draw line",this.m_iLastX=this.m_iLastY=-1,this.m_Line=null,e.next=14;break;case 11:if(null!==this.m_Line){e.next=14;break}return e.next=14,this.SendAsyncData(new A);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return U.apply(this,arguments)})},{key:"OnCancelClick",value:(X=a(regeneratorRuntime.mark((function e(){var t,n,i,s,a,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.m_bDrawLines){e.next=33;break}if(null===this.m_Line){e.next=30;break}t=this.m_Line.$GetPointsArray(),this.m_CancelPath.disabled="disabled",n=r(t),e.prev=5,n.s();case 7:if((i=n.n()).done){e.next=20;break}if(s=i.value,a=s.x,o=s.y,null!==a&&null!==o){e.next=12;break}return e.abrupt("continue",18);case 12:return a/=this.m_iGridSizeX,o/=this.m_iGridSizeY,e.next=16,this.m_Points.get(o*this.m_iGridWidth+a);case 16:void 0!==(u=e.sent)&&u.$RevertOldStatus();case 18:e.next=7;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(5),n.e(e.t0);case 25:return e.prev=25,n.f(),e.finish(25);case 28:v(this.m_Line),this.m_Line=null;case 30:this.m_iLastX=this.m_iLastY=-1,this.m_Timer&&(this.m_StopAndDraw.disabled="disabled"),this.Debug("",0);case 33:case"end":return e.stop()}}),e,this,[[5,22,25,28]])}))),function(){return X.apply(this,arguments)})},{key:"CountPointsDebug",value:function(e){var t="";[{query:"circle:not([z-index])",display:"circles: %s, "},{query:"polyline",display:"lines: %s, "},{query:"circle[data-status='2']",display:"intercepted(P1:%s, "},{query:"circle[data-status='3']",display:"P2:%s)"}].forEach((function(e){var n=document.querySelectorAll(e.query);t+=e.display.replace("%s",n.length)})),document.querySelector(e).innerHTML="SVGs by tags: "+t}},{key:"OnTestBuildCurrentGraph",value:(F=a(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.t0=z,e.next=4,this.BuildGraph();case 4:e.t1=e.sent,(0,e.t0)(e.t1);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"OnTestConcaveman",value:($=a(regeneratorRuntime.mark((function e(t){var n,i,s,a,o,u,c,h,l,m,d,p,_;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,this.BuildGraph();case 3:if(!((n=e.sent.vertices.map(function(e){var t=e.$GetPosition();return[t.x/this.m_iGridSizeX,t.y/this.m_iGridSizeX]}.bind(this)))&&n.length>0)){e.next=32;break}i=k.concaveman(n,2,0),S(6,i.map(function(e){return parseInt(e[0])*this.m_iGridSizeX+","+parseInt(e[1])*this.m_iGridSizeY}.bind(this)).join(" "),"green"),z("convex_hull = ".concat(i)),s=i.map(function(e){return{x:e[0],y:e[1]}}.bind(this)),a=P(s),o="var(--orange)",u=r(a),e.prev=12,u.s();case 14:if((c=u.n()).done){e.next=24;break}return h=c.value,l=h.x,m=h.y,d=l*this.m_iGridSizeX,p=m*this.m_iGridSizeY,(_=document.querySelector('svg > circle[cx="'.concat(d,'"][cy="').concat(p,'"]')))&&(_.$SetStrokeColor(o),_.$SetFillColor(o),_.$SetZIndex(100),_.setAttribute("r","6")),e.next=22,H(50);case 22:e.next=14;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(12),u.e(e.t0);case 29:return e.prev=29,u.f(),e.finish(29);case 32:case"end":return e.stop()}}),e,this,[[12,26,29,32]])}))),function(e){return $.apply(this,arguments)})},{key:"OnTestMarkAllCycles",value:(G=a(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.t0=z,e.t1=this,e.next=5,this.BuildGraph({visuals:!0});case 5:return e.t2=e.sent,e.next=8,e.t1.MarkAllCycles.call(e.t1,e.t2);case 8:e.t3=e.sent,(0,e.t0)(e.t3);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return G.apply(this,arguments)})},{key:"OnTestGroupPoints",value:(p=a(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.t0=S,e.t1=this,e.t2=[],e.next=6,this.m_Points.get(9*this.m_iGridWidth+26);case 6:return e.t3=e.sent,e.next=9,e.t1.GroupPointsRecurse.call(e.t1,e.t2,e.t3);case 9:e.t4=e.sent.map((function(e){var t=e.$GetPosition();return t.x+","+t.y})).join(" "),(0,e.t0)(6,e.t4,"green"),z("game.lastCycle = ".concat(this.lastCycle));case 12:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"OnTestFindFullSurroundedPoints",value:(m=a(regeneratorRuntime.mark((function e(t){var n,i,s,a,o,u,c,h,l,m,d,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n=this.COLOR_RED,i="var(--orange)",e.next=5,this.m_Points.values();case 5:s=e.sent,a=r(s),e.prev=7,a.s();case 9:if((o=a.n()).done){e.next=23;break}if(void 0===(u=o.value)||u.$GetFillColor()!==n||R.POINT_FREE_RED!==u.$GetStatus()){e.next=21;break}return c=u.$GetPosition(),h=c.x,l=c.y,m=h/this.m_iGridSizeX,d=l/this.m_iGridSizeY,e.next=16,this.IsPointOutsideAllPaths(m,d);case 16:if(e.t0=e.sent,!1!==e.t0){e.next=19;break}return e.abrupt("continue",21);case 19:(p=document.querySelector('svg > circle[cx="'.concat(h,'"][cy="').concat(l,'"]')))&&(p.$SetStrokeColor(i),p.$SetFillColor(i),p.setAttribute("r","6"));case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),a.e(e.t1);case 28:return e.prev=28,a.f(),e.finish(28);case 31:case"end":return e.stop()}}),e,this,[[7,25,28,31]])}))),function(e){return m.apply(this,arguments)})},{key:"PrepareDrawing",value:(l=a(regeneratorRuntime.mark((function e(t,n,r,i,s,a,o,u,c,h,l,m,d){var p,_,S,v,g,y,P,k,R=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p=R.length>13&&void 0!==R[13]?R[13]:125,this.m_bIsWon=!1,this.m_iDelayBetweenMultiCaptures=4e3,this.m_iTooLong2Duration=p,this.m_Timer=null,this.m_WaitStartTime=null,this.m_iSlowdownLevel=0,this.m_iLastX=-1,this.m_iLastY=-1,this.m_iMouseX=0,this.m_iMouseY=0,this.m_iPosX=0,this.m_iPosY=0,this.m_bMouseDown=!1,this.m_bHandlingEvent=!1,this.m_bDrawLines=!1,this.m_sMessage="",this.m_sDotColor=this.m_bIsPlayingWithRed?this.COLOR_RED:this.COLOR_BLUE,this.m_Line=null,this.m_Debug=document.getElementById("debug0"),this.m_Player2Name=document.querySelector(n),this.m_GameStatus=document.querySelector(r),this.m_SurrenderButton=document.querySelector(i),this.m_CancelPath=document.querySelector(s),this.m_StopAndDraw=document.querySelector(o),this.m_sMsgInputSel=u,this.m_sMsgListSel=c,this.m_sMsgSendButtonSel=h,this.m_Screen=document.querySelector(t),this.m_Screen){e.next=32;break}return alert("no board"),e.abrupt("return");case 32:return this.m_iPosX=this.m_Screen.offsetLeft,this.m_iPosY=this.m_Screen.offsetTop,_=Array.from(this.m_Screen.classList).find((function(e){return e.startsWith("boardsize")})).split("-")[1].split("x"),this.m_BoardSize={width:parseInt(_[0]),height:parseInt(_[1])},S=this.m_Screen.clientWidth,v=this.m_Screen.clientHeight,g=null,v<=0&&(v=16*this.m_BoardSize.height,this.m_Screen.style.height=v+"px",g="100%"),this.m_iGridSizeX=parseInt(Math.ceil(S/this.m_BoardSize.width)),this.m_iGridSizeY=parseInt(Math.ceil(v/this.m_BoardSize.height)),this.m_iGridWidth=parseInt(Math.ceil(S/this.m_iGridSizeX)),this.m_iGridHeight=parseInt(Math.ceil(v/this.m_iGridSizeY)),this.m_sLastMoveGameTimeStamp=l,this.rAF_StartTimestamp=null,this.rAF_FrameID=null,this.lastCycle=[],b(this.m_Screen,g,g,!0),this.DisableSelection(this.m_Screen),y=new W(m,this.CreateScreenPointFromIndexedDb.bind(this),this.CreateScreenPathFromIndexedDb.bind(this),this.GetGameStateForIndexedDb.bind(this)),this.m_Lines=y.GetPathStore(),this.m_Points=y.GetPointStore(),e.next=55,y.PrepareStore(this);case 55:if(this.m_bPointsAndPathsLoaded=e.sent,!1===this.m_bViewOnly){if(null===this.m_MouseCursorOval&&(this.m_MouseCursorOval=f(this.m_PointRadius,"true"),this.m_MouseCursorOval.$SetFillColor(this.m_sDotColor),this.m_MouseCursorOval.$SetStrokeColor(this.m_sDotColor),this.m_MouseCursorOval.$SetZIndex(-1),this.m_MouseCursorOval.$Hide()),this.m_Screen.onmousedown=this.OnMouseDown.bind(this),this.m_Screen.onmousemove=this.OnMouseMove.bind(this),this.m_Screen.onmouseup=this.OnMouseUp.bind(this),this.m_Screen.onmouseleave=this.OnMouseLeave.bind(this),this.m_CancelPath.onclick=this.OnCancelClick.bind(this),this.m_StopAndDraw.onclick=this.OnStopAndDraw.bind(this),!1===this.m_bIsCPUGame)document.querySelector(this.m_sMsgInputSel).disabled="",document.getElementById("testArea").textContent="";else for(P=0,d.length>P&&(document.querySelector(d[P++]).onclick=this.OnTestBuildCurrentGraph.bind(this)),d.length>P&&(document.querySelector(d[P++]).onclick=this.OnTestConcaveman.bind(this)),d.length>P&&(document.querySelector(d[P++]).onclick=this.OnTestMarkAllCycles.bind(this)),d.length>P&&(document.querySelector(d[P++]).onclick=this.OnTestGroupPoints.bind(this)),d.length>P&&(document.querySelector(d[P++]).onclick=this.OnTestFindFullSurroundedPoints.bind(this)),k=document.getElementById("chatSection");k.lastElementChild;)k.removeChild(k.lastElementChild);this.m_SurrenderButton.disabled="","???"===this.m_Player2Name.innerHTML?(this.ShowMobileStatus("Waiting for other player to connect"),this.m_Screen.style.cursor="wait"):(this.m_SurrenderButton.value="surrender",this.m_bIsPlayerActive?(this.ShowMobileStatus("Your move"),this.m_Screen.style.cursor="crosshair",this.m_StopAndDraw.disabled=""):(this.ShowMobileStatus("Waiting for oponent move"),this.m_Screen.style.cursor="wait"),this.m_bDrawLines?this.m_StopAndDraw.value="Draw dot":this.m_StopAndDraw.value="Draw line")}else document.querySelector(a).innerHTML="back to Game List";case 57:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,i,s,a,o,u,c,h,m,d){return l.apply(this,arguments)})},{key:"GetRandomInt",value:function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e}},{key:"FindRandomCPUPoint",value:(h=a(regeneratorRuntime.mark((function e(){var t,n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=100;case 1:if(!(--t>0)){e.next=15;break}return n=this.GetRandomInt(0,this.m_iGridWidth),r=this.GetRandomInt(0,this.m_iGridHeight),e.next=6,this.m_Points.has(r*this.m_iGridWidth+n);case 6:if(e.t0=!e.sent,!e.t0){e.next=11;break}return e.next=10,this.IsPointOutsideAllPaths(n,r);case 10:e.t0=e.sent;case 11:if(!e.t0){e.next=13;break}return e.abrupt("break",15);case 13:e.next=1;break;case 15:return i=new I(0,this.g_iGameID,-1,n,r,R.POINT_FREE_BLUE,0),e.abrupt("return",i);case 17:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"CalculateCPUCentroid",value:(c=a(regeneratorRuntime.mark((function e(){var t,n,i,s,a,o,u,c,h,l,m,d,p,_,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=0,n=0,i=0,o=this.COLOR_RED,e.next=4,this.m_Points.values();case 4:u=e.sent,c=r(u);try{for(c.s();!(h=c.n()).done;)void 0!==(l=h.value)&&l.$GetFillColor()===o&&l.$GetStatus()===R.POINT_FREE_RED&&(m=l.$GetPosition(),s=m.x,a=m.y,s/=this.m_iGridSizeX,a/=this.m_iGridSizeY,t+=s,n+=a,i++)}catch(e){c.e(e)}finally{c.f()}if(!(i<=0)){e.next=9;break}return e.abrupt("return",null);case 9:s=t/i,a=n/i,s*=this.m_iGridSizeX,a*=this.m_iGridSizeY,d=parseInt(s/this.m_iGridSizeX),p=parseInt(a/this.m_iGridSizeY),s=d,a=p,_=20;case 18:if(!(--_>0)){e.next=30;break}if(e.t0=!this.m_Points.has(a*this.m_iGridWidth+s),!e.t0){e.next=24;break}return e.next=23,this.IsPointOutsideAllPaths(s,a);case 23:e.t0=e.sent;case 24:if(!e.t0){e.next=26;break}return e.abrupt("break",30);case 26:s=this.GetRandomInt(d-2,d+3),a=this.GetRandomInt(p-2,p+3),e.next=18;break;case 30:if(!(_<=0)){e.next=32;break}return e.abrupt("return",null);case 32:return f=new I(0,this.g_iGameID,-1,s,a,R.POINT_FREE_BLUE,0),e.abrupt("return",f);case 34:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"BuildGraph",value:(u=a(regeneratorRuntime.mark((function e(){var t,n,i,s,o,u,c,h,l,m,d,p,_,f,S,v,b,y,P,k,x=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=x.length>0&&void 0!==x[0]?x[0]:{},n=t.freeStat,i=void 0===n?R.POINT_FREE_BLUE:n,s=t.fillCol,o=void 0===s?this.COLOR_BLUE:s,u=t.visuals,c=void 0===u||u,h=[],l=new Map,m=function(e,t){var n=t.$GetStatus();return!(!e.includes(n)||t.$GetFillColor()!==o)},d=function(){var e=a(regeneratorRuntime.mark((function e(t,n,r,s,a,o,u){var d,p,_,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n>=0&&n<this.m_iGridWidth&&r>=0&&r<this.m_iGridHeight)){e.next=5;break}return e.next=3,this.m_Points.get(r*this.m_iGridWidth+n);case 3:(d=e.sent)&&!0===m([i],d)&&(p=d.$GetPosition(),!1===l.has("".concat(o,",").concat(u,"_").concat(n,",").concat(r))&&!1===l.has("".concat(n,",").concat(r,"_").concat(o,",").concat(u))&&(_={from:t,to:d},!0===c&&((f=g(3,"rgba(0, 255, 0, 0.3)")).$move(s,a,p.x,p.y),_.line=f),l.set("".concat(o,",").concat(u,"_").concat(n,",").concat(r),_),!1===h.includes(t)?(t.adjacents=[d],h.push(t)):h.find((function(e){return e===t})).adjacents.push(d),!1===h.includes(d)?(d.adjacents=[t],h.push(d)):h.find((function(e){return e===d})).adjacents.push(t)));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,s,a,o){return e.apply(this,arguments)}}().bind(this),e.next=6,this.m_Points.values();case 6:p=e.sent,_=r(p),e.prev=8,_.s();case 10:if((f=_.n()).done){e.next=33;break}if(!(S=f.value)||!0!==m([i,R.POINT_STARTING,R.POINT_IN_PATH],S)){e.next=31;break}return v=S.$GetPosition(),b=v.x,y=v.y,P=b/this.m_iGridSizeX,k=y/this.m_iGridSizeY,e.next=17,d(S,P+1,k,b,y,P,k);case 17:return e.next=19,d(S,P-1,k,b,y,P,k);case 19:return e.next=21,d(S,P,k-1,b,y,P,k);case 21:return e.next=23,d(S,P,k+1,b,y,P,k);case 23:return e.next=25,d(S,P-1,k-1,b,y,P,k);case 25:return e.next=27,d(S,P+1,k-1,b,y,P,k);case 27:return e.next=29,d(S,P-1,k+1,b,y,P,k);case 29:return e.next=31,d(S,P+1,k+1,b,y,P,k);case 31:e.next=10;break;case 33:e.next=38;break;case 35:e.prev=35,e.t0=e.catch(8),_.e(e.t0);case 38:return e.prev=38,_.f(),e.finish(38);case 41:return e.abrupt("return",{vertices:h,edges:Array.from(l.values())});case 42:case"end":return e.stop()}}),e,this,[[8,35,38,41]])}))),function(){return u.apply(this,arguments)})},{key:"IsGraphCyclic",value:function(e){for(var t=e.vertices,n=function(e,t){e.visited=!0;var i,s=r(e.adjacents);try{for(s.s();!(i=s.n()).done;){var a=i.value;if(a.visited){if(a!==t){var o=a.$GetPosition(),u=o.x,c=o.y,h=u/this.m_iGridSizeX,l=c/this.m_iGridSizeY;return z("cycle found at ".concat(h,",").concat(l)),!0}}else if(n(a,e))return!0}}catch(e){s.e(e)}finally{s.f()}return!1}.bind(this),i=0;i<t.length;i++)t[i].visited=!1;for(var s=0;s<t.length;s++)if(!t[s].visited&&n(t[s],-1))return!0;return!1}},{key:"MarkAllCycles",value:(s=a(regeneratorRuntime.mark((function e(t){var n,i,s,o,u,c,h,l,m,d,p,_;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=t.vertices,i=n.length,s=new Array(i),o=new Array(i),u=new Array(i),c=new Array(i),h=0;h<i;h++)o[h]=[],s[h]=[];l=function(){var e=a(regeneratorRuntime.mark((function e(t,i){var s,a,h,m,p,_;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(2!==u[t]){e.next=2;break}return e.abrupt("return");case 2:if(1!==u[t]){e.next=8;break}for(d++,o[s=i].push(d);s!==t;)s=c[s],o[s].push(d);return e.abrupt("return");case 8:if(c[t]=i,u[t]=1,!(a=n[t])){e.next=36;break}return a.$SetStrokeColor("black"),a.$SetFillColor("black"),e.next=16,H(10);case 16:h=r(a.adjacents),e.prev=17,h.s();case 19:if((m=h.n()).done){e.next=28;break}if(p=m.value,(_=n.indexOf(p))!==c[t]){e.next=24;break}return e.abrupt("continue",26);case 24:return e.next=26,l(_,t);case 26:e.next=19;break;case 28:e.next=33;break;case 30:e.prev=30,e.t0=e.catch(17),h.e(e.t0);case 33:return e.prev=33,h.f(),e.finish(33);case 36:u[t]=2;case 37:case"end":return e.stop()}}),e,null,[[17,30,33,36]])})));return function(t,n){return e.apply(this,arguments)}}(),m=function(){var e=a(regeneratorRuntime.mark((function e(t,i){var a,o,u,c,h,l,m,p,_,f,S,v,b,g,y,k,x,w,O,G,I,T,C,E,D,L,A,N,B,M,W,$,F,Y,X,U=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=0;a<t;a++)if(void 0!==(o=i[a])&&o.length>0)for(u=0;u<o.length;u++)void 0!==(c=s[o[u]])&&c.push(a);return s=s.filter((function(e){return e.length>=4})).sort((function(e,t){return t.length-e.length})),h=[],l=this.COLOR_RED,e.next=6,this.m_Points.values();case 6:m=e.sent,p=r(m),e.prev=8,p.s();case 10:if((_=p.n()).done){e.next=24;break}if(void 0===(f=_.value)||f.$GetFillColor()!==l||R.POINT_FREE_RED!==f.$GetStatus()){e.next=22;break}return S=f.$GetPosition(),v=S.x,b=S.y,g=v/this.m_iGridSizeX,y=b/this.m_iGridSizeY,e.next=17,this.IsPointOutsideAllPaths(g,y);case 17:if(e.t0=e.sent,!1!==e.t0){e.next=20;break}return e.abrupt("continue",22);case 20:document.querySelector('svg > circle[cx="'.concat(v,'"][cy="').concat(b,'"]'))&&h.push({x:g,y:y});case 22:e.next=10;break;case 24:e.next=29;break;case 26:e.prev=26,e.t1=e.catch(8),p.e(e.t1);case 29:return e.prev=29,p.f(),e.finish(29);case 32:k=[],x=0;case 34:if(!(x<=d)){e.next=72;break}if(!((w=s[x])&&w.length>0)){e.next=69;break}O="Cycle Number ".concat(x,": "),G=[],I="var(--indigo)",T=w.map(function(e){var t=n[e].$GetPosition();return{x:t.x/this.m_iGridSizeX,y:t.y/this.m_iGridSizeY}}.bind(this)),C=P(T),E=r(C),e.prev=42,E.s();case 44:if((D=E.n()).done){e.next=53;break}return L=D.value,A=L.x,N=L.y,(B=document.querySelector('svg > circle[cx="'.concat(A*this.m_iGridSizeX,'"][cy="').concat(N*this.m_iGridSizeY,'"]')))&&(O+="(".concat(A,",").concat(N,")"),B.$SetStrokeColor(I),B.$SetFillColor(I),B.setAttribute("r","6")),e.next=51,H(50);case 51:e.next=44;break;case 53:e.next=58;break;case 55:e.prev=55,e.t2=e.catch(42),E.e(e.t2);case 58:return e.prev=58,E.f(),e.finish(58);case 61:M="",W="",$=r(h);try{for($.s();!(F=$.n()).done;)Y=F.value,!1!==this.pnpoly2(C,Y.x,Y.y)&&(M+="".concat(W,"(").concat(Y.x,",").concat(Y.y,")"),(X=document.querySelector('svg > circle[cx="'.concat(Y.x*this.m_iGridSizeX,'"][cy="').concat(Y.y*this.m_iGridSizeY,'"]')))&&(X.$SetStrokeColor("var(--yellow)"),X.$SetFillColor("var(--yellow)"),X.setAttribute("r","6")),W=",")}catch(e){$.e(e)}finally{$.f()}G.unshift(O),k.push(G),z(O+(""!==M?" possible intercepts: ".concat(M):"")),Array.from(document.querySelectorAll('svg > circle[fill="'.concat(I,'"][r="6"]'))).forEach((function(e){e.$SetStrokeColor(U.COLOR_BLUE),e.$SetFillColor(U.COLOR_BLUE),e.setAttribute("r","4")}));case 69:x++,e.next=34;break;case 72:return e.abrupt("return",k);case 73:case"end":return e.stop()}}),e,this,[[8,26,29,32],[42,55,58,61]])})));return function(t,n){return e.apply(this,arguments)}}().bind(this),d=0,p=i,_=0;case 10:if(!(_<i)){e.next=16;break}return e.next=13,l(_+1,_);case 13:_++,e.next=10;break;case 16:return e.next=18,m(p,o);case 18:return e.abrupt("return",e.sent);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"GroupPointsRecurse",value:(i=a(regeneratorRuntime.mark((function e(t,n){var r,i,s,a,o,u,c,h,l,m,d,p,_,f,S,v,b,g,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==n&&!t.includes(n)){e.next=2;break}return e.abrupt("return",t);case 2:if(!1!==[R.POINT_FREE_BLUE,R.POINT_STARTING,R.POINT_IN_PATH].includes(n.$GetStatus())&&n.$GetFillColor()===this.COLOR_BLUE){e.next=4;break}return e.abrupt("return",t);case 4:if(r=n.$GetPosition(),i=r.x,s=r.y,i/=this.m_iGridSizeX,s/=this.m_iGridSizeY,a=null,!(t.length>0)){e.next=21;break}if(a=t[t.length-1],c=a.$GetPosition(),o=c.x,u=c.y,o/=this.m_iGridSizeX,u/=this.m_iGridSizeY,!(Math.abs(parseInt(o-i))<=1&&Math.abs(parseInt(u-s))<=1)){e.next=18;break}t.push(n),e.next=19;break;case 18:return e.abrupt("return",t);case 19:e.next=22;break;case 21:t.push(n);case 22:return t.length>2&&null!==a&&(h=t[0],(l=h.$GetPosition()).x/=this.m_iGridSizeX,l.y/=this.m_iGridSizeY,a=t[t.length-1],m=a.$GetPosition(),o=m.x,u=m.y,o/=this.m_iGridSizeX,u/=this.m_iGridSizeY,Math.abs(parseInt(o-l.x))<=1&&Math.abs(parseInt(u-l.y))<=1&&(d=[],t.forEach((function(e){return d.push(e)})),this.lastCycle.push(d))),e.next=25,this.m_Points.get(s*this.m_iGridWidth+i+1);case 25:return p=e.sent,e.next=28,this.m_Points.get(s*this.m_iGridWidth+i-1);case 28:return _=e.sent,e.next=31,this.m_Points.get((s-1)*this.m_iGridWidth+i);case 31:return f=e.sent,e.next=34,this.m_Points.get((s+1)*this.m_iGridWidth+i);case 34:return S=e.sent,e.next=37,this.m_Points.get((s-1)*this.m_iGridWidth+i-1);case 37:return v=e.sent,e.next=40,this.m_Points.get((s-1)*this.m_iGridWidth+i+1);case 40:return b=e.sent,e.next=43,this.m_Points.get((s+1)*this.m_iGridWidth+i-1);case 43:return g=e.sent,e.next=46,this.m_Points.get((s+1)*this.m_iGridWidth+i+1);case 46:if(y=e.sent,!p){e.next=50;break}return e.next=50,this.GroupPointsRecurse(t,p);case 50:if(!_){e.next=53;break}return e.next=53,this.GroupPointsRecurse(t,_);case 53:if(!f){e.next=56;break}return e.next=56,this.GroupPointsRecurse(t,f);case 56:if(!S){e.next=59;break}return e.next=59,this.GroupPointsRecurse(t,S);case 59:if(!v){e.next=62;break}return e.next=62,this.GroupPointsRecurse(t,v);case 62:if(!b){e.next=65;break}return e.next=65,this.GroupPointsRecurse(t,b);case 65:if(!g){e.next=68;break}return e.next=68,this.GroupPointsRecurse(t,g);case 68:if(!y){e.next=71;break}return e.next=71,this.GroupPointsRecurse(t,y);case 71:return e.abrupt("return",t);case 72:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"GroupPointsIterative",value:(n=a(regeneratorRuntime.mark((function e(){var t,n,i,s,a,o,u,c,h,l,m=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=m.length>0&&void 0!==m[0]?m[0]:{},n=t.g,i=void 0===n?null:n){e.next=3;break}return e.abrupt("return");case 3:s=i.vertices,a=[],u=r(s),e.prev=5,u.s();case 7:if((c=u.n()).done){e.next=17;break}return h=c.value,o=h,l=[],e.next=13,this.GroupPointsRecurse(l,o);case 13:e.sent.length>0&&this.lastCycle.length>0&&(a.push(this.lastCycle),this.lastCycle=[]);case 15:e.next=7;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(5),u.e(e.t0);case 22:return e.prev=22,u.f(),e.finish(22);case 25:return e.abrupt("return",a);case 26:case"end":return e.stop()}}),e,this,[[5,19,22,25]])}))),function(){return n.apply(this,arguments)})},{key:"rAFCallBack",value:(t=a(regeneratorRuntime.mark((function e(t){var n,r,i,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===this.rAF_StartTimestamp&&(this.rAF_StartTimestamp=t),n=t-this.rAF_StartTimestamp,r=null,e.next=5,this.CalculateCPUCentroid();case 5:if(null===(i=e.sent)){e.next=10;break}r=i,e.next=13;break;case 10:return e.next=12,this.FindRandomCPUPoint();case 12:r=e.sent;case 13:if(null!==r){e.next=17;break}n<2e3&&(this.rAF_FrameID=window.requestAnimationFrame(this.rAFCallBack.bind(this))),e.next=19;break;case 17:return e.next=19,this.SendAsyncData(r,(function(){s.m_bMouseDown=!1,s.m_bHandlingEvent=!1}));case 19:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"StartCPUCalculation",value:function(){null===this.rAF_FrameID&&(this.rAF_FrameID=window.requestAnimationFrame(this.rAFCallBack.bind(this)))}}]),e}();window.addEventListener("load",a(regeneratorRuntime.mark((function e(){var t,n,r,i,s,a,o,u,c,h,l,m,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=gameOptions.inkBallHubName,n=gameOptions.iGameID,document.getElementById("gameID").innerHTML=n,document.querySelector(".container.inkgame form > input[type='hidden'][name='GameID']").value=n,r=gameOptions.iPlayerID,i=gameOptions.iOtherPlayerID,document.getElementById("playerID").innerHTML=r,s=gameOptions.bPlayingWithRed,a=gameOptions.bPlayerActive,o=gameOptions.gameType,u=gameOptions.protocol,c=gameOptions.servTimeoutMillis,h=gameOptions.isReadonly,l=gameOptions.pathAfterPointDrawAllowanceSecAmount,m=new Date(gameOptions.sLastMoveGameTimeStamp).toISOString(),e.next=17,$(gameOptions);case 17:return d=new U(n,r,i,t,signalR.LogLevel.Warning,u,signalR.HttpTransportType.None,c,o,s,a,h,l),e.next=20,d.PrepareDrawing("#screen","#Player2Name","#gameStatus","#SurrenderButton","#CancelPath","#Pause","#StopAndDraw","#messageInput","#messagesList","#sendButton",m,null===gameOptions.PointsAsJavaScriptArray,["#TestBuildGraph","#TestConcaveman","#TestMarkAllCycles","#TestGroupPoints","#TestFindFullSurroundedPoints"]);case 20:if(null===gameOptions.PointsAsJavaScriptArray){e.next=29;break}return e.next=23,d.StartSignalRConnection(!1);case 23:return e.next=25,d.SetAllPoints(gameOptions.PointsAsJavaScriptArray);case 25:return e.next=27,d.SetAllPaths(gameOptions.PathsAsJavaScriptArray);case 27:e.next=31;break;case 29:return e.next=31,d.StartSignalRConnection(!0);case 31:document.getElementsByClassName("whichColor")[0].style.color=s?"red":"blue",d.CountPointsDebug("#debug2"),window.game=d;case 34:case"end":return e.stop()}}),e)})))),window.addEventListener("beforeunload",(function(){window.game&&window.game.StopSignalRConnection()}))}]);