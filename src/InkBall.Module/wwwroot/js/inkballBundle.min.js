!function(t){function e(e){for(var n,r,s=e[0],a=e[1],o=0,c=[];o<s.length;o++)r=s[o],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&c.push(i[r][0]),i[r]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n]);for(u&&u(e);c.length;)c.shift()()}var n={},i={1:0};function r(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.e=function(t){var e=[],n=i[t];if(0!==n)if(n)e.push(n[2]);else{var s=new Promise((function(e,r){n=i[t]=[e,r]}));e.push(n[2]=s);var a,o=document.createElement("script");o.charset="utf-8",o.timeout=120,r.nc&&o.setAttribute("nonce",r.nc),o.src=function(t){return r.p+""+({0:"concavemanDeps",2:"svgvml",3:"svgvmlMin"}[t]||t)+"Bundle.js"}(t);var u=new Error;a=function(e){o.onerror=o.onload=null,clearTimeout(c);var n=i[t];if(0!==n){if(n){var r=e&&("load"===e.type?"missing":e.type),s=e&&e.target&&e.target.src;u.message="Loading chunk "+t+" failed.\n("+r+": "+s+")",u.name="ChunkLoadError",u.type=r,u.request=s,n[1](u)}i[t]=void 0}};var c=setTimeout((function(){a({type:"timeout",target:o})}),12e4);o.onerror=o.onload=a,document.head.appendChild(o)}return Promise.all(e)},r.m=t,r.c=n,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="../js/",r.oe=function(t){throw console.error(t),t};var s=window.webpackJsonp=window.webpackJsonp||[],a=s.push.bind(s);s.push=e,s=s.slice();for(var o=0;o<s.length;o++)e(s[o]);var u=a;r(r.s=0)}([function(t,e,n){"use strict";function i(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,s=function(){};return{s:s,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){u=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw a}}}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function s(t,e,n,i,r,s,a){try{var o=t[s](a),u=o.value}catch(t){return void n(t)}o.done?e(u):Promise.resolve(u).then(i,r)}function a(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var a=t.apply(e,n);function o(t){s(a,i,r,o,u,"next",t)}function u(t){s(a,i,r,o,u,"throw",t)}o(void 0)}))}}function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=m(t);if(e){var r=m(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l(this,n)}}function l(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function m(t){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function p(t,e,n){return e&&_(t.prototype,e),n&&_(t,n),t}var f,S,v,g,b,y,P,R,O,k=Object.freeze({POINT_FREE_RED:-3,POINT_FREE_BLUE:-2,POINT_FREE:-1,POINT_STARTING:0,POINT_IN_PATH:1,POINT_OWNED_BY_RED:2,POINT_OWNED_BY_BLUE:3}),w=Object.freeze({UNKNOWN:-1,PING:0,POINT:1,PATH:2,PLAYER_JOINING:3,PLAYER_SURRENDER:4,WIN:5,POINTS_AND_PATHS:6,USER_SETTINGS:7,STOP_AND_DRAW:8}),I=Object.freeze({FIRST_CAPTURE:0,FIRST_5_CAPTURES:1,FIRST_5_PATHS:2,FIRST_5_ADVANTAGE_PATHS:3}),x=Object.freeze({RED_WINS:0,GREEN_WINS:1,NO_WIN:2,DRAW_WIN:3}),C=function(){function t(){d(this,t)}return p(t,[{key:"GetKind",value:function(){throw new Error("missing GetKind implementation!")}}]),t}(),G=function(t){u(n,t);var e=h(n);function n(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:k.POINT_FREE,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return d(this,n),(t=e.call(this)).iId=i,t.iGameId=r,t.iPlayerId=s,t.iX=a,t.iY=o,t.Status=u,t.iEnclosingPathId=c,t}return p(n,[{key:"GetKind",value:function(){return w.POINT}}],[{key:"Format",value:function(t,e){var n="("+e.iX+","+e.iY+" - ";switch(void 0!==e.Status?e.Status:e.status){case k.POINT_FREE_RED:n+="red";break;case k.POINT_FREE_BLUE:n+="blue";break;case k.POINT_FREE:n+="";break;case k.POINT_STARTING:n+="starting";break;case k.POINT_IN_PATH:n+="path";break;case k.POINT_OWNED_BY_RED:n+="owned by red";break;case k.POINT_OWNED_BY_BLUE:n+="owned by blue";break;default:throw new Error("Bad point type!")}return t+" places "+n+") point"}}]),n}(C),L=function(t){u(n,t);var e=h(n);function n(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return d(this,n),(t=e.call(this)).iId=i,t.iGameId=r,t.iPlayerId=s,t.PointsAsString=a,t.OwnedPointsAsString=o,t}return p(n,[{key:"GetKind",value:function(){return w.PATH}}],[{key:"Format",value:function(t,e){var n="(".concat(e.PointsAsString||e.pointsAsString,") [").concat(e.OwnedPointsAsString||e.ownedPointsAsString,"]");return"".concat(t," places ").concat(n," path")}}]),n}(C),E=function(t){u(n,t);var e=h(n);function n(t,i,r){var s;return d(this,n),(s=e.call(this)).OtherPlayerId=t,s.OtherPlayerName=i,s.Message=r,s}return p(n,[{key:"GetKind",value:function(){return w.PLAYER_JOINING}}],[{key:"Format",value:function(t){return t.Message||t.message}}]),n}(C),D=function(t){u(n,t);var e=h(n);function n(t,i,r){var s;return d(this,n),(s=e.call(this)).OtherPlayerId=t,s.thisOrOtherPlayerSurrenders=i,s.Message=r,s}return p(n,[{key:"GetKind",value:function(){return w.PLAYER_SURRENDER}}],[{key:"Format",value:function(t){return t.Message||t.message}}]),n}(C),T=function(t){u(n,t);var e=h(n);function n(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return d(this,n),(t=e.call(this)).Message=i,t}return p(n,[{key:"GetKind",value:function(){return w.PING}}],[{key:"Format",value:function(t,e){return t+" says '"+(e.Message||e.message)+"'"}}]),n}(C),N=function(t){u(n,t);var e=h(n);function n(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x.NO_WIN,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"null";return d(this,n),(t=e.call(this)).Status=i,t.WinningPlayerId=r,t.Message=s,t}return p(n,[{key:"GetKind",value:function(){return w.WIN}}],[{key:"Format",value:function(t){var e="";switch(void 0!==t.Status?t.Status:t.status){case x.RED_WINS:e="red.";break;case x.GREEN_WINS:e="blue.";break;case x.NO_WIN:e="no one!";break;case x.DRAW_WIN:e="draw!"}return"And the winner is... "+e}}]),n}(C),A=function(t){u(n,t);var e=h(n);function n(){return d(this,n),e.call(this)}return p(n,[{key:"GetKind",value:function(){return w.STOP_AND_DRAW}}],[{key:"Format",value:function(t){return"User "+t+" started to draw path"}}]),n}(C),W=function(t){u(n,t);var e=h(n);function n(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return d(this,n),(t=e.call(this)).Points=i,t.Paths=r,t}return p(n,[{key:"GetKind",value:function(){return w.POINTS_AND_PATHS}}],[{key:"Deserialize",value:function(t){var e='{ "Points": '.concat(t.Points||t.points,', "Paths": ').concat(t.Paths||t.paths," }");return JSON.parse(e)}}]),n}(C),M=function(t){u(n,t);var e=h(n);function n(){var t,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return d(this,n),(t=e.call(this)).DesktopNotifications=i,t}return p(n,[{key:"GetKind",value:function(){return w.USER_SETTINGS}}],[{key:"Serialize",value:function(t){return JSON.stringify(t)}},{key:"Deserialize",value:function(t){return JSON.parse(t)}}]),n}(C),$=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.countdownSeconds,i=void 0===n?60:n,r=e.labelSelector,s=void 0===r?null:r,a=e.initialStart,o=void 0!==a&&a,u=e.countdownReachedHandler,c=void 0===u?void 0:u;d(this,t),this.countdownSeconds=i,this.totalSeconds=this.countdownSeconds,this.timerID=-1,this.label=null,this.countdownReachedHandler=c,s&&(this.label=document.querySelector(s)),o&&this.Start()}return p(t,[{key:"setTimeFunc",value:function(){--this.totalSeconds<=0?(this.Stop(),this.countdownReachedHandler&&this.countdownReachedHandler(this.label)):this.label&&(this.label.innerHTML=this.pad(parseInt(this.totalSeconds/60))+":"+this.pad(this.totalSeconds%60))}},{key:"pad",value:function(t){var e=t+"";return e.length<2?"0"+e:e}},{key:"Start",value:function(){this.Stop(),this.timerID=setInterval(this.setTimeFunc.bind(this),1e3)}},{key:"Stop",value:function(){this.timerID>0&&clearInterval(this.timerID),this.label&&(this.label.innerHTML="")}},{key:"Reset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.countdownSeconds,n=void 0===e?60:e,i=t.labelSelector,r=void 0===i?null:i,s=t.initialStart,a=void 0!==s&&s,o=t.countdownReachedHandler,u=void 0===o?void 0:o;this.countdownSeconds=n,this.totalSeconds=this.countdownSeconds,this.label=null,this.countdownReachedHandler=u,r&&(this.label=document.querySelector(r)),a&&this.Start()}}]),t}();function F(t){return B.apply(this,arguments)}function B(){return(B=a(regeneratorRuntime.mark((function t(e){var i,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=Array.prototype.slice.call(document.getElementsByTagName("script")).map((function(t){return t.src})).find((function(t){return-1!==t.indexOf("inkball")})).split("/").pop(),!(-1!==i.indexOf("min"))){t.next=8;break}return t.next=5,n.e(3).then(n.bind(null,1));case 5:r=t.sent,t.next=11;break;case 8:return t.next=10,n.e(2).then(n.bind(null,2));case 10:r=t.sent;case 11:if(f=r.$createOval,S=r.$createPolyline,v=r.$RemovePolyline,g=r.$createSVGVML,b=r.$createLine,y=r.hasDuplicates,P=r.sortPointsClockwise,R=r.GameStateStore,-1!==e.iOtherPlayerID){t.next=18;break}return t.next=16,n.e(0).then(n.bind(null,3));case 16:r=t.sent,O=r;case 18:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Y(t){console.log(t)}function z(t){console.error(t)}function X(t){return H.apply(this,arguments)}function H(){return(H=a(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){return setTimeout(t,e)})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var U=function(){function t(e,n,i,r,s,o,u,c,h){var l=this,m=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],_=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],p=arguments.length>11&&void 0!==arguments[11]&&arguments[11],f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:60,S=arguments.length>13&&void 0!==arguments[13]?arguments[13]:125;d(this,t),this.g_iGameID=e,this.g_iPlayerID=n,this.m_iOtherPlayerId=i,this.m_bIsCPUGame=-1===this.m_iOtherPlayerId,this.GameType=I[h],this.iConnErrCount=0,this.iExponentialBackOffMillis=2e3,this.COLOR_RED="red",this.COLOR_BLUE="blue",this.COLOR_OWNED_RED="#DC143C",this.COLOR_OWNED_BLUE="#8A2BE2",this.DRAWING_PATH_COLOR="black",this.m_bIsWon=!1,this.m_bPointsAndPathsLoaded=!1,this.m_iDelayBetweenMultiCaptures=4e3,this.m_iTooLong2Duration=S,this.m_Timer=null,this.m_ReconnectTimer=null,this.m_WaitStartTime=null,this.m_TimerOpts={countdownSeconds:f,labelSelector:"#debug2",initialStart:!0,countdownReachedHandler:this.CountDownReachedHandler.bind(this)},this.m_iSlowdownLevel=0,this.m_iGridSizeX=0,this.m_iGridSizeY=0,this.m_iGridWidth=0,this.m_iGridHeight=0,this.m_BoardSize=null,this.m_iLastX=-1,this.m_iLastY=-1,this.m_iMouseX=0,this.m_iMouseY=0,this.m_iPosX=0,this.m_iPosY=0,this.m_Screen=null,this.m_Debug=null,this.m_Player2Name=null,this.m_SurrenderButton=null,this.m_sMsgInputSel=null,this.m_sMsgSendButtonSel=null,this.m_sMsgListSel=null,this.m_CancelPath=null,this.m_StopAndDraw=null,this.m_bMouseDown=!1,this.m_bHandlingEvent=!1,this.m_bDrawLines=!1,this.m_sMessage="",this.m_bIsPlayingWithRed=m,this.m_bIsPlayerActive=_,this.m_sDotColor=this.m_bIsPlayingWithRed?this.COLOR_RED:this.COLOR_BLUE,this.m_PointRadius=4,this.m_Line=null,this.m_Lines=null,this.m_Points=null,this.m_bViewOnly=p,this.m_MouseCursorOval=null,this.m_ApplicationUserSettings=null,this.m_sLastMoveGameTimeStamp=null,null!==r&&""!==r&&(this.g_SignalRConnection=(new signalR.HubConnectionBuilder).withUrl(r,{transport:u,accessTokenFactory:function(){return"iGameID=".concat(this.g_iGameID,"&iPlayerID=").concat(this.g_iPlayerID)}.bind(this)}).withHubProtocol(o).configureLogging(s).build(),this.g_SignalRConnection.serverTimeoutInMilliseconds=c,this.g_SignalRConnection.onclose(function(){var t=a(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:null!=e&&(z(e),l.m_Screen.style.cursor="not-allowed",l.iConnErrCount++,setTimeout((function(){return l.Connect()}),4e3+l.iExponentialBackOffMillis*Math.max(l.iConnErrCount,5)));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()))}var e,n,r,s,u,c,h,l,m,_,C,F,B,H,U,q,j,K,J,V,Z,Q,tt,et,nt,it,rt,st;return p(t,[{key:"GetPlayerPointsAndPaths",value:(st=a(regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!1!==this.m_bPointsAndPathsLoaded){t.next=15;break}return t.next=3,this.g_SignalRConnection.invoke("GetPlayerPointsAndPaths",this.m_bViewOnly,this.g_iGameID);case 3:if(e=t.sent,void 0===(n=W.Deserialize(e)).Points){t.next=8;break}return t.next=8,this.SetAllPoints(n.Points);case 8:if(void 0===n.Paths){t.next=11;break}return t.next=11,this.SetAllPaths(n.Paths);case 11:return this.m_bPointsAndPathsLoaded=!0,t.abrupt("return",!0);case 15:return t.abrupt("return",!1);case 16:case"end":return t.stop()}}),t,this)}))),function(){return st.apply(this,arguments)})},{key:"Connect",value:(rt=a(regeneratorRuntime.mark((function t(){var e,n,i,r,s=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.g_SignalRConnection.start();case 3:if(this.iConnErrCount=0,Y("connected; iConnErrCount = "+this.iConnErrCount),!1!==this.m_bViewOnly){t.next=19;break}if(null!==sessionStorage.getItem("ApplicationUserSettings")){t.next=16;break}return t.next=9,this.g_SignalRConnection.invoke("GetUserSettings");case 9:return(e=t.sent)&&(Y(e),e=M.Deserialize(e),n=M.Serialize(e),sessionStorage.setItem("ApplicationUserSettings",n)),this.m_ApplicationUserSettings=new M(e.DesktopNotifications),t.next=14,this.GetPlayerPointsAndPaths();case 14:t.next=19;break;case 16:i=sessionStorage.getItem("ApplicationUserSettings"),r=M.Deserialize(i),this.m_ApplicationUserSettings=new M(r.DesktopNotifications);case 19:if(!1!==this.m_bPointsAndPathsLoaded){t.next=22;break}return t.next=22,this.GetPlayerPointsAndPaths();case 22:null!==this.m_ApplicationUserSettings&&!0===this.m_ApplicationUserSettings.DesktopNotifications&&this.SetupNotifications(),!0!==this.m_bIsCPUGame||this.m_bIsPlayerActive||this.StartCPUCalculation(),t.next=32;break;case 26:t.prev=26,t.t0=t.catch(0),z(t.t0+"; iConnErrCount = "+this.iConnErrCount),this.m_Screen.style.cursor="not-allowed",this.iConnErrCount++,setTimeout((function(){return s.Connect()}),4e3+this.iExponentialBackOffMillis*Math.max(this.iConnErrCount,5));case 32:case"end":return t.stop()}}),t,this,[[0,26]])}))),function(){return rt.apply(this,arguments)})},{key:"SetupNotifications",value:function(){return window.Notification?"granted"===Notification.permission||void Notification.requestPermission().then((function(t){return"granted"===t||(Y("User blocked notifications."),!1)})).catch((function(t){return z(t),!1})):(Y("Browser does not support notifications."),!1)}},{key:"NotifyBrowser",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Hi there!",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"How are you doing?";return!!document.hidden&&(window.Notification?"granted"===Notification.permission?(new Notification(t,{body:e,icon:"../img/homescreen.webp"}),!0):void Notification.requestPermission().then((function(n){return"granted"===n?(new Notification(t,{body:e,icon:"../img/homescreen.webp"}),!0):(Y("User blocked notifications."),!1)})).catch((function(t){return z(t),!1})):(Y("Browser does not support notifications."),!1))}},{key:"StartSignalRConnection",value:(it=a(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!==this.g_SignalRConnection){t.next=2;break}return t.abrupt("return",Promise.reject(new Error("signalr conn is null")));case 2:return!1===this.m_bPointsAndPathsLoaded&&(this.m_bPointsAndPathsLoaded=!e),this.g_SignalRConnection.on("ServerToClientPoint",function(){var t=a(regeneratorRuntime.mark((function t(e){var n,i,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.g_iPlayerID!==e.iPlayerId&&(n=this.m_Player2Name.innerHTML,i=G.Format(n,e),(r=document.createElement("li")).textContent=i,document.querySelector(this.m_sMsgListSel).appendChild(r),this.NotifyBrowser("New Point",i)),t.next=3,this.ReceivedPointProcessing(e);case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}().bind(this)),this.g_SignalRConnection.on("ServerToClientPath",function(t){if(Object.prototype.hasOwnProperty.call(t,"PointsAsString")||Object.prototype.hasOwnProperty.call(t,"pointsAsString")){var e=t;if(this.g_iPlayerID!==e.iPlayerId){var n=this.m_Player2Name.innerHTML,i=L.Format(n,e),r=document.createElement("li");r.textContent=i,document.querySelector(this.m_sMsgListSel).appendChild(r),this.NotifyBrowser("New Path",i)}this.ReceivedPathProcessing(e)}else{if(!Object.prototype.hasOwnProperty.call(t,"WinningPlayerId")&&!Object.prototype.hasOwnProperty.call(t,"winningPlayerId"))throw new Error("ServerToClientPath bad GetKind!");var s=t,a=N.Format(s),o=document.createElement("li");o.textContent=a,document.querySelector(this.m_sMsgListSel).appendChild(o),this.ReceivedWinProcessing(s),this.NotifyBrowser("We have a winner",a)}}.bind(this)),this.g_SignalRConnection.on("ServerToClientPlayerJoin",function(t){var e=t.OtherPlayerId||t.otherPlayerId;this.m_iOtherPlayerId=e;var n=E.Format(t),i=document.createElement("li");i.innerHTML='<strong class="text-primary">'.concat(n,"</strong>"),document.querySelector(this.m_sMsgListSel).appendChild(i),null!==this.m_SurrenderButton&&""!==t.OtherPlayerName&&(this.m_Player2Name.innerHTML=t.OtherPlayerName||t.otherPlayerName,this.m_SurrenderButton.value="surrender",this.ShowMobileStatus("Your move")),this.NotifyBrowser("Player joininig",n),this.m_bHandlingEvent=!1}.bind(this)),this.g_SignalRConnection.on("ServerToClientPlayerSurrender",function(t){var e=D.Format(t),n=document.createElement("li");n.innerHTML='<strong class="text-warning">'.concat(e,"</strong>"),document.querySelector(this.m_sMsgListSel).appendChild(n),this.m_bHandlingEvent=!1,e=""===e?"Game interrupted!":e,this.NotifyBrowser("Game interruption",e),alert(e),window.location.href="Games"}.bind(this)),this.g_SignalRConnection.on("ServerToClientPlayerWin",function(t){var e=N.Format(t),n=document.createElement("li");n.innerHTML='<strong class="text-warning">'.concat(e,"</strong>"),document.querySelector(this.m_sMsgListSel).appendChild(n),this.ReceivedWinProcessing(t),this.NotifyBrowser("We have a winner",e)}.bind(this)),this.g_SignalRConnection.on("ServerToClientPing",function(t){var e=this.m_Player2Name.innerHTML,n=T.Format(e,t),i=document.createElement("li");i.textContent=n,document.querySelector(this.m_sMsgListSel).appendChild(i),this.NotifyBrowser("User Message",n)}.bind(this)),this.g_SignalRConnection.on("ServerToClientOtherPlayerDisconnected",function(t){var e={countdownSeconds:5,initialStart:!0,countdownReachedHandler:function(){var e=t,n=document.createElement("li");n.innerHTML='<strong class="text-warning">'.concat(e,"</strong>"),document.querySelector(this.m_sMsgListSel).appendChild(n),this.NotifyBrowser("User disconnected",e),this.m_ReconnectTimer=null}.bind(this)};this.m_ReconnectTimer?this.m_ReconnectTimer.Reset(e):this.m_ReconnectTimer=new $(e)}.bind(this)),this.g_SignalRConnection.on("ServerToClientOtherPlayerConnected",function(t){if(this.m_ReconnectTimer)this.m_ReconnectTimer.Stop(),this.m_ReconnectTimer=null;else{var e=t,n=document.createElement("li");n.innerHTML='<strong class="text-primary">'.concat(e,"</strong>"),document.querySelector(this.m_sMsgListSel).appendChild(n),this.NotifyBrowser("User disconnected",e),this.m_ReconnectTimer=null}}.bind(this)),this.g_SignalRConnection.on("ServerToClientStopAndDraw",function(t){if(t){var e=this.m_Player2Name.innerHTML,n=A.Format(e),i=document.createElement("li");i.innerHTML='<strong class="text-info">'.concat(n,"</strong>"),document.querySelector(this.m_sMsgListSel).appendChild(i),this.NotifyBrowser("User "+e+" started drawing new path",n)}}.bind(this)),!1===this.m_bIsCPUGame&&(document.querySelector(this.m_sMsgSendButtonSel).addEventListener("click",function(t){t.preventDefault();var e=document.querySelector(this.m_sMsgInputSel).value.trim();if(""!==e){var n=new T(e);this.SendAsyncData(n)}}.bind(this),!1),document.querySelector(this.m_sMsgInputSel).addEventListener("keyup",function(t){t.preventDefault(),13===t.keyCode&&document.querySelector(this.m_sMsgSendButtonSel).click()}.bind(this),!1)),t.abrupt("return",this.Connect());case 14:case"end":return t.stop()}}),t,this)}))),function(t){return it.apply(this,arguments)})},{key:"StopSignalRConnection",value:function(){null!==this.g_SignalRConnection&&(this.g_SignalRConnection.stop(),this.m_ReconnectTimer&&this.m_ReconnectTimer.Stop(),this.m_Timer&&this.m_Timer.Stop(),Y("Stopped SignalR connection"))}},{key:"Debug",value:function(){switch(arguments.length){case 1:this.m_Debug.innerHTML=arguments.length<=0?void 0:arguments[0];break;case 2:var t=document.getElementById("debug"+(arguments.length<=1?void 0:arguments[1]));t.innerHTML=arguments.length<=0?void 0:arguments[0];break;default:for(var e=0;e<arguments.length;e++){var n=e<0||arguments.length<=e?void 0:arguments[e];if(n){var i=document.getElementById("debug"+e);i&&(i.innerHTML=n)}}}}},{key:"DisableSelection",value:function(t){void 0!==o(t.onselectstart)?t.onselectstart=function(){return!1}:void 0!==o(t.style.MozUserSelect)?t.style.MozUserSelect="none":t.onmousedown=function(){return!1}}},{key:"f_clientWidth",value:function(){return this.f_filterResults(window.innerWidth?window.innerWidth:0,document.documentElement?document.documentElement.clientWidth:0,document.body?document.body.clientWidth:0)}},{key:"f_clientHeight",value:function(){return this.f_filterResults(window.innerHeight?window.innerHeight:0,document.documentElement?document.documentElement.clientHeight:0,document.body?document.body.clientHeight:0)}},{key:"f_scrollLeft",value:function(){return this.f_filterResults(window.pageXOffset?window.pageXOffset:0,document.documentElement?document.documentElement.scrollLeft:0,document.body?document.body.scrollLeft:0)}},{key:"f_scrollTop",value:function(){return this.f_filterResults(window.pageYOffset?window.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)}},{key:"f_filterResults",value:function(t,e,n){var i=t||0;return e&&(!i||i>e)&&(i=e),n&&(!i||i>n)?n:i}},{key:"SetPoint",value:(nt=a(regeneratorRuntime.mark((function t(e,n,i,r){var s,a,o,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.m_Points.has(n*this.m_iGridWidth+e);case 2:if(!t.sent){t.next=4;break}return t.abrupt("return");case 4:s=e*this.m_iGridSizeX,a=n*this.m_iGridSizeY,(o=f(this.m_PointRadius,"true")).$move(s,a,this.m_PointRadius),t.t0=i,t.next=t.t0===k.POINT_FREE_RED?11:t.t0===k.POINT_FREE_BLUE?14:t.t0===k.POINT_FREE?17:t.t0===k.POINT_STARTING?20:t.t0===k.POINT_IN_PATH?23:t.t0===k.POINT_OWNED_BY_RED?26:t.t0===k.POINT_OWNED_BY_BLUE?29:32;break;case 11:return u=this.COLOR_RED,o.$SetStatus(i),t.abrupt("break",34);case 14:return u=this.COLOR_BLUE,o.$SetStatus(i),t.abrupt("break",34);case 17:case 20:return u=this.m_sDotColor,o.$SetStatus(i),t.abrupt("break",34);case 23:return u=this.g_iPlayerID===r?!0===this.m_bIsPlayingWithRed?this.COLOR_RED:this.COLOR_BLUE:!0===this.m_bIsPlayingWithRed?this.COLOR_BLUE:this.COLOR_RED,o.$SetStatus(i),t.abrupt("break",34);case 26:return u=this.COLOR_OWNED_RED,o.$SetStatus(i),t.abrupt("break",34);case 29:return u=this.COLOR_OWNED_BLUE,o.$SetStatus(i),t.abrupt("break",34);case 32:return alert("bad point"),t.abrupt("break",34);case 34:return o.$SetFillColor(u),o.$SetStrokeColor(u),t.next=38,this.m_Points.set(n*this.m_iGridWidth+e,o);case 38:case"end":return t.stop()}}),t,this)}))),function(t,e,n,i){return nt.apply(this,arguments)})},{key:"GetGameStateForIndexedDb",value:function(){return{iGameID:this.g_iGameID,iPlayerID:this.g_iPlayerID,iOtherPlayerId:this.m_iOtherPlayerId,sLastMoveGameTimeStamp:this.m_sLastMoveGameTimeStamp,bPointsAndPathsLoaded:this.m_bPointsAndPathsLoaded,iGridWidth:this.m_iGridWidth,iGridSizeX:this.m_iGridSizeX,iGridSizeY:this.m_iGridSizeY}}},{key:"CreateScreenPointFromIndexedDb",value:function(t,e,n,i){var r,s=t*this.m_iGridSizeX,a=e*this.m_iGridSizeY,o=f(this.m_PointRadius,"true");switch(o.$move(s,a,this.m_PointRadius),n){case k.POINT_FREE_RED:r=this.COLOR_RED,o.$SetStatus(n);break;case k.POINT_FREE_BLUE:r=this.COLOR_BLUE,o.$SetStatus(n);break;case k.POINT_FREE:case k.POINT_STARTING:r=this.m_sDotColor,o.$SetStatus(n);break;case k.POINT_IN_PATH:r=i,o.$SetStatus(n);break;case k.POINT_OWNED_BY_RED:r=this.COLOR_OWNED_RED,o.$SetStatus(n);break;case k.POINT_OWNED_BY_BLUE:r=this.COLOR_OWNED_BLUE,o.$SetStatus(n);break;default:alert("bad point")}return o.$SetFillColor(r),o.$SetStrokeColor(r),o}},{key:"SetAllPoints",value:(et=a(regeneratorRuntime.mark((function t(e){var n,r,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=i(e),t.prev=1,n.s();case 3:if((r=n.n()).done){t.next=9;break}return s=r.value,t.next=7,this.SetPoint(s[0],s[1],s[2],s[3]);case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),n.e(t.t0);case 14:return t.prev=14,n.f(),t.finish(14);case 17:case"end":return t.stop()}}),t,this,[[1,11,14,17]])}))),function(t){return et.apply(this,arguments)})},{key:"SetPath",value:(tt=a(regeneratorRuntime.mark((function t(e,n,r){var s,a,o,u,c,h,l,m,d,_,p,f,v=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:s=v.length>3&&void 0!==v[3]?v[3]:0,a=e.split(" "),o="",u="",c=null,m=k.POINT_STARTING,d=i(a),t.prev=4,d.s();case 6:if((_=d.n()).done){t.next=21;break}return p=_.value,c=p.split(","),h=parseInt(c[0]),l=parseInt(c[1]),t.next=13,this.m_Points.get(l*this.m_iGridWidth+h);case 13:null!=(c=t.sent)&&(c.$SetStatus(m),m=k.POINT_IN_PATH),h*=this.m_iGridSizeX,l*=this.m_iGridSizeY,u+="".concat(o).concat(h,",").concat(l),o=" ";case 19:t.next=6;break;case 21:t.next=26;break;case 23:t.prev=23,t.t0=t.catch(4),d.e(t.t0);case 26:return t.prev=26,d.f(),t.finish(26);case 29:return c=a[0].split(","),h=parseInt(c[0]),l=parseInt(c[1]),t.next=34,this.m_Points.get(l*this.m_iGridWidth+h);case 34:return null!=(c=t.sent)&&c.$SetStatus(m),h*=this.m_iGridSizeX,l*=this.m_iGridSizeY,u+="".concat(o).concat(h,",").concat(l),(f=S(3,u,r?this.m_sDotColor:n?this.COLOR_BLUE:this.COLOR_RED)).$SetID(s),t.next=43,this.m_Lines.push(f);case 43:case"end":return t.stop()}}),t,this,[[4,23,26,29]])}))),function(t,e,n){return tt.apply(this,arguments)})},{key:"CreateScreenPathFromIndexedDb",value:(Q=a(regeneratorRuntime.mark((function t(e,n,r){var s,a,o,u,c,h,l,m,d,_,p;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:s=e.split(" "),a="",o="",u=null,l=k.POINT_STARTING,m=i(s),t.prev=3,m.s();case 5:if((d=m.n()).done){t.next=18;break}return _=d.value,u=_.split(","),c=parseInt(u[0]),h=parseInt(u[1]),t.next=12,this.m_Points.get(h*this.m_iGridWidth+c);case 12:null!=(u=t.sent)&&(u.$SetStatus(l),l=k.POINT_IN_PATH),o+="".concat(a).concat(c,",").concat(h),a=" ";case 16:t.next=5;break;case 18:t.next=23;break;case 20:t.prev=20,t.t0=t.catch(3),m.e(t.t0);case 23:return t.prev=23,m.f(),t.finish(23);case 26:return u=s[0].split(","),c=parseInt(u[0]),h=parseInt(u[1]),t.next=31,this.m_Points.get(h*this.m_iGridWidth+c);case 31:return null!=(u=t.sent)&&u.$SetStatus(l),o+="".concat(a).concat(c,",").concat(h),(p=S(3,o,n)).$SetID(r),t.abrupt("return",p);case 37:case"end":return t.stop()}}),t,this,[[3,20,23,26]])}))),function(t,e,n){return Q.apply(this,arguments)})},{key:"SetAllPaths",value:(Z=a(regeneratorRuntime.mark((function t(e){var n,r,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=i(e),t.prev=1,n.s();case 3:if((r=n.n()).done){t.next=11;break}if((s=r.value).iGameId===this.g_iGameID){t.next=7;break}throw new Error("Bad game from path!");case 7:return t.next=9,this.SetPath(s.PointsAsString,this.m_bIsPlayingWithRed,s.iPlayerId===this.g_iPlayerID,s.iId);case 9:t.next=3;break;case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(1),n.e(t.t0);case 16:return t.prev=16,n.f(),t.finish(16);case 19:case"end":return t.stop()}}),t,this,[[1,13,16,19]])}))),function(t){return Z.apply(this,arguments)})},{key:"IsPointBelongingToLine",value:function(t,e,n){var r,s=i(t);try{for(s.s();!(r=s.n()).done;){var a=r.value.split(","),o=a[0],u=a[1];if(o===e&&u===n)return!0}}catch(t){s.e(t)}finally{s.f()}return!1}},{key:"pnpoly",value:function(t,e,n,i,r){var s,a,o=!1;for(s=0,a=t-1;s<t;a=s++)(n[s]<=r&&r<n[a]||n[a]<=r&&r<n[s])&&i<(e[a]-e[s])*(r-n[s])/(n[a]-n[s])+e[s]&&(o=!o);return o}},{key:"pnpoly2",value:function(t,e,n){var i,r,s=t.length,a=!1;for(i=0,r=s-1;i<s;r=i++){var o=t[i],u=t[r];(o.y<=n&&n<u.y||u.y<=n&&n<o.y)&&e<(u.x-o.x)*(n-o.y)/(u.y-o.y)+o.x&&(a=!a)}return a}},{key:"SurroundOponentPoints",value:(V=a(regeneratorRuntime.mark((function t(){var e,n,r,s,a,o,u,c,h,l,m,d,_,p,f;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.m_Line.$GetPointsArray(),!y(e.slice(0,-1).map((function(t){return t.x+"_"+t.y})))&&e[0].x===e[e.length-1].x&&e[0].y===e[e.length-1].y){t.next=4;break}return t.abrupt("return",{OwnedPoints:void 0,owned:"",path:"",errorDesc:"Points not unique"});case 4:return this.m_sDotColor===this.COLOR_RED?(n=this.COLOR_BLUE,r=k.POINT_OWNED_BY_RED,s=this.COLOR_OWNED_RED):(n=this.COLOR_RED,r=k.POINT_OWNED_BY_BLUE,s=this.COLOR_OWNED_BLUE),a="",o="",u="",c=[],t.next=8,this.m_Points.values();case 8:h=t.sent,l=i(h);try{for(l.s();!(m=l.n()).done;)void 0!==(d=m.value)&&d.$GetFillColor()===n&&[k.POINT_FREE_BLUE,k.POINT_FREE_RED].includes(d.$GetStatus())&&(_=d.$GetPosition(),p=_.x,f=_.y,!1!==this.pnpoly2(e,p,f)&&(p/=this.m_iGridSizeX,f/=this.m_iGridSizeY,o+="".concat(u).concat(p,",").concat(f),u=" ",c.push({point:d,revertStatus:d.$GetStatus(),revertFillColor:d.$GetFillColor(),revertStrokeColor:d.$GetStrokeColor()}),d.$SetStatus(r,!0),d.$SetFillColor(s),d.$SetStrokeColor(s)))}catch(t){l.e(t)}finally{l.f()}return""!==o&&(a=e.map(function(t){var e=t.x,n=t.y;return null===e||null===n?"":(e/=this.m_iGridSizeX,n/=this.m_iGridSizeY,"".concat(e,",").concat(n))}.bind(this)).join(" ")),t.abrupt("return",{OwnedPoints:c,owned:o,PathPoints:[],path:a,errorDesc:"No surrounded points"});case 13:case"end":return t.stop()}}),t,this)}))),function(){return V.apply(this,arguments)})},{key:"IsPointOutsideAllPaths",value:(J=a(regeneratorRuntime.mark((function t(e,n){var r,s,a,o,u,c,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e*this.m_iGridSizeX,s=n*this.m_iGridSizeY,t.next=3,this.m_Lines.all();case 3:a=t.sent,o=i(a),t.prev=5,o.s();case 7:if((u=o.n()).done){t.next=14;break}if(c=u.value,h=c.$GetPointsArray(),!1===this.pnpoly2(h,r,s)){t.next=12;break}return t.abrupt("return",!1);case 12:t.next=7;break;case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(5),o.e(t.t0);case 19:return t.prev=19,o.f(),t.finish(19);case 22:return t.abrupt("return",!0);case 23:case"end":return t.stop()}}),t,this,[[5,16,19,22]])}))),function(t,e){return J.apply(this,arguments)})},{key:"CreateXMLWaitForPlayerRequest",value:function(){}},{key:"CreateXMLPutPointRequest",value:function(t,e){return new G(0,this.g_iGameID,this.g_iPlayerID,t,e,this.m_bIsPlayingWithRed?k.POINT_FREE_RED:k.POINT_FREE_BLUE,0)}},{key:"CreateXMLPutPathRequest",value:function(t){return new L(0,this.g_iGameID,this.g_iPlayerID,t.path,t.owned)}},{key:"SendAsyncData",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;switch(t.GetKind()){case w.POINT:Y(G.Format("some player",t)),this.m_bHandlingEvent=!0,this.g_SignalRConnection.invoke("ClientToServerPoint",t).then(function(){var t=a(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ReceivedPointProcessing(e);case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}().bind(this)).catch(function(t){z(t.toString()),void 0!==e&&e()}.bind(this));break;case w.PATH:Y(L.Format("some player",t)),this.m_bHandlingEvent=!0,this.g_SignalRConnection.invoke("ClientToServerPath",t).then(function(t){if(Object.prototype.hasOwnProperty.call(t,"WinningPlayerId")||Object.prototype.hasOwnProperty.call(t,"winningPlayerId")){var e=t;this.ReceivedWinProcessing(e)}else{if(!Object.prototype.hasOwnProperty.call(t,"PointsAsString")&&!Object.prototype.hasOwnProperty.call(t,"pointsAsString"))throw new Error("ClientToServerPath bad GetKind!");var n=t;this.ReceivedPathProcessing(n)}}.bind(this)).catch(function(t){z(t.toString()),void 0!==e&&e()}.bind(this));break;case w.PING:this.g_SignalRConnection.invoke("ClientToServerPing",t).then(function(){document.querySelector(this.m_sMsgInputSel).value="",document.querySelector(this.m_sMsgSendButtonSel).disabled="disabled"}.bind(this)).catch((function(t){z(t.toString())}));break;case w.STOP_AND_DRAW:this.g_SignalRConnection.invoke("ClientToServerStopAndDraw",t).then(function(){this.m_bDrawLines=!0,this.m_iLastX=this.m_iLastY=-1,this.m_Line=null,this.m_bIsPlayerActive=!0,this.m_StopAndDraw.disabled="disabled"}.bind(this)).catch((function(t){z(t.toString())}));break;default:z("unknown object")}}},{key:"CountDownReachedHandler",value:function(t){t&&(t.innerHTML=""),this.m_StopAndDraw.disabled=this.m_CancelPath.disabled="disabled",this.m_Timer=null,this.m_bIsPlayerActive=!1}},{key:"ReceivedPointProcessing",value:(K=a(regeneratorRuntime.mark((function t(e){var n,i,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.iX,i=e.iY,r=void 0!==e.Status?e.Status:e.status,this.m_sLastMoveGameTimeStamp=(void 0!==e.TimeStamp?e.TimeStamp:e.timeStamp).toISOString(),t.next=4,this.SetPoint(n,i,r,e.iPlayerId);case 4:this.g_iPlayerID!==e.iPlayerId?(this.m_bIsPlayerActive=!0,this.ShowMobileStatus("Oponent has moved, your turn"),this.m_Screen.style.cursor="crosshair",null!==this.m_Line&&this.OnCancelClick(),this.m_StopAndDraw.disabled="",this.m_bDrawLines?this.m_StopAndDraw.value="Draw dot":this.m_StopAndDraw.value="Draw line",this.m_Timer&&(this.m_Timer.Stop(),this.m_Timer=null)):(this.m_bIsPlayerActive=!1,this.ShowMobileStatus("Waiting for oponent move"),this.m_Screen.style.cursor="wait",this.m_CancelPath.disabled="disabled",this.m_StopAndDraw.disabled="",this.m_StopAndDraw.value="Stop and Draw",this.m_Timer?this.m_Timer.Reset(this.m_TimerOpts):this.m_Timer=new $(this.m_TimerOpts),!0!==this.m_bIsCPUGame||this.m_bIsPlayerActive||this.StartCPUCalculation()),this.m_bHandlingEvent=!1;case 6:case"end":return t.stop()}}),t,this)}))),function(t){return K.apply(this,arguments)})},{key:"ReceivedPathProcessing",value:(j=a(regeneratorRuntime.mark((function t(e){var n,r,s,a,o,u,c,h,l,m,d,_,p,f,S;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.m_sLastMoveGameTimeStamp=(void 0!==e.TimeStamp?e.TimeStamp:e.timeStamp).toISOString(),this.g_iPlayerID===e.iPlayerId){t.next=36;break}return n=e.PointsAsString||e.pointsAsString,r=e.OwnedPointsAsString||e.ownedPointsAsString,t.next=5,this.SetPath(n,this.m_sDotColor===this.COLOR_RED,!1,e.iId);case 5:s=r.split(" "),a=this.m_sDotColor===this.COLOR_RED?k.POINT_OWNED_BY_RED:k.POINT_OWNED_BY_BLUE,o=this.m_sDotColor===this.COLOR_RED?this.COLOR_OWNED_RED:this.COLOR_OWNED_BLUE,u=i(s),t.prev=9,u.s();case 11:if((c=u.n()).done){t.next=21;break}return h=c.value,l=h.split(","),m=parseInt(l[0]),d=parseInt(l[1]),t.next=17,this.m_Points.get(d*this.m_iGridWidth+m);case 17:void 0!==(l=t.sent)&&(l.$SetStatus(a),l.$SetFillColor(o),l.$SetStrokeColor(o));case 19:t.next=11;break;case 21:t.next=26;break;case 23:t.prev=23,t.t0=t.catch(9),u.e(t.t0);case 26:return t.prev=26,u.f(),t.finish(26);case 29:this.m_bIsPlayerActive=!0,this.ShowMobileStatus("Oponent has moved, your turn"),this.m_Screen.style.cursor="crosshair",null!==this.m_Line&&this.OnCancelClick(),this.m_StopAndDraw.disabled="",t.next=55;break;case 36:return _=this.m_Line.$GetPointsArray(),p=_[0].x,f=_[0].y,p/=this.m_iGridSizeX,f/=this.m_iGridSizeY,t.next=42,this.m_Points.get(f*this.m_iGridWidth+p);case 42:return void 0!==(S=t.sent)&&S.$SetStatus(k.POINT_IN_PATH),this.m_Line.$SetWidthAndColor(3,this.m_sDotColor),this.m_Line.$SetID(e.iId),t.next=48,this.m_Lines.push(this.m_Line);case 48:this.m_iLastX=this.m_iLastY=-1,this.m_Line=null,this.m_bIsPlayerActive=!1,this.ShowMobileStatus("Waiting for oponent move"),this.m_Screen.style.cursor="wait",this.m_StopAndDraw.disabled=this.m_CancelPath.disabled="disabled",!0!==this.m_bIsCPUGame||this.m_bIsPlayerActive||this.StartCPUCalculation();case 55:this.m_bDrawLines?this.m_StopAndDraw.value="Draw dot":this.m_StopAndDraw.value="Draw line",this.m_bHandlingEvent=!1,this.m_Timer&&(this.m_Timer.Stop(),this.m_Timer=null);case 58:case"end":return t.stop()}}),t,this,[[9,23,26,29]])}))),function(t){return j.apply(this,arguments)})},{key:"ReceivedWinProcessing",value:function(t){this.ShowMobileStatus("Win situation"),this.m_bHandlingEvent=!1;var e=N.Format(t),n=void 0!==t.Status?t.Status:t.status,i=t.WinningPlayerId||t.winningPlayerId;((n===x.RED_WINS||n===x.GREEN_WINS)&&i>0||n===x.DRAW_WIN)&&(alert(""===e?"Game won!":e),window.location.href="Games")}},{key:"Check4Win",value:function(t,e,n,i){var r;switch(this.GameType){case I.FIRST_CAPTURE:return t.length>0?this.m_bIsPlayingWithRed?x.RED_WINS:x.GREEN_WINS:e.length>0?this.m_bIsPlayingWithRed?x.GREEN_WINS:x.RED_WINS:x.NO_WIN;case I.FIRST_5_CAPTURES:return r=this.m_bIsPlayingWithRed?k.POINT_OWNED_BY_BLUE:k.POINT_OWNED_BY_RED,i.filter((function(t){return null!==t.iEnclosingPathId&&t.$GetStatus()===r})).length>=5?this.m_bIsPlayingWithRed?x.GREEN_WINS:x.RED_WINS:(r=this.m_bIsPlayingWithRed?k.POINT_OWNED_BY_RED:k.POINT_OWNED_BY_BLUE,n.filter((function(t){return null!==t.iEnclosingPathId&&t.$GetStatus()===r})).length>=5?this.m_bIsPlayingWithRed?x.RED_WINS:x.GREEN_WINS:x.NO_WIN);case I.FIRST_5_PATHS:return e.length>=5?this.m_bIsPlayingWithRed?x.GREEN_WINS:x.RED_WINS:t.length>=5?this.m_bIsPlayingWithRed?x.RED_WINS:x.GREEN_WINS:x.NO_WIN;case I.FIRST_5_ADVANTAGE_PATHS:var s=t.length-e.length;return s>=5?this.m_bIsPlayingWithRed?x.RED_WINS:x.GREEN_WINS:s<=-5?this.m_bIsPlayingWithRed?x.GREEN_WINS:x.RED_WINS:x.NO_WIN;default:throw new Error("Wrong game type")}}},{key:"ShowMobileStatus",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";"???"===this.m_Player2Name.innerHTML?this.m_bIsPlayerActive?this.m_GameStatus.style.color=this.COLOR_RED:this.m_GameStatus.style.color=this.COLOR_BLUE:this.m_bIsPlayerActive?this.m_bIsPlayingWithRed?this.m_GameStatus.style.color=this.COLOR_RED:this.m_GameStatus.style.color=this.COLOR_BLUE:this.m_bIsPlayingWithRed?this.m_GameStatus.style.color=this.COLOR_BLUE:this.m_GameStatus.style.color=this.COLOR_RED,null!==t&&""!==t?this.Debug(t,0):this.Debug("",0)}},{key:"OnMouseMove",value:(q=a(regeneratorRuntime.mark((function t(e){var n,i,r,s,a,o,u,c,h,l,m,d,_=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.m_bIsPlayerActive&&"???"!==this.m_Player2Name.innerHTML&&!0!==this.m_bHandlingEvent&&!(this.iConnErrCount>0)){t.next=3;break}return this.iConnErrCount<=0&&!this.m_bIsPlayerActive&&(this.m_Screen.style.cursor="wait"),t.abrupt("return");case 3:if(n=(e?e.clientX:window.event.clientX)-this.m_Screen.offsetLeft+this.f_scrollLeft()+.5*this.m_iGridSizeX,i=(e?e.clientY:window.event.clientY)-this.m_Screen.offsetTop+this.f_scrollTop()+.5*this.m_iGridSizeY,n=parseInt(n/this.m_iGridSizeX),i=parseInt(i/this.m_iGridSizeY),r=n*this.m_iGridSizeX,s=i*this.m_iGridSizeY,this.m_MouseCursorOval.$move(r,s,this.m_PointRadius),this.m_MouseCursorOval.$Show(),this.Debug("[".concat(n,",").concat(i,"]"),1),!this.m_bDrawLines){t.next=53;break}if(null!==this.m_Line?this.m_Screen.style.cursor="move":this.m_Screen.style.cursor="crosshair",!0!==this.m_bMouseDown){t.next=51;break}if(!((this.m_iLastX!==n||this.m_iLastY!==i)&&Math.abs(parseInt(this.m_iLastX-n))<=1&&Math.abs(parseInt(this.m_iLastY-i))<=1&&this.m_iLastX>=0&&this.m_iLastY>=0)){t.next=51;break}if(null===this.m_Line){t.next=44;break}return t.next=19,this.m_Points.get(this.m_iLastY*this.m_iGridWidth+this.m_iLastX);case 19:return a=t.sent,t.next=22,this.m_Points.get(i*this.m_iGridWidth+n);case 22:if(o=t.sent,this.m_CancelPath.disabled=this.m_Line.$GetLength()>=2?"":"disabled",void 0===a||void 0===o||a.$GetFillColor()!==this.m_sDotColor||o.$GetFillColor()!==this.m_sDotColor){t.next=42;break}if(!((u=this.m_Line.$ContainsPoint(r,s))<1&&o.$GetStatus()!==k.POINT_STARTING&&!0===this.m_Line.$AppendPoints(r,s,this.m_iGridSizeX,this.m_iGridSizeY))){t.next=32;break}o.$SetStatus(k.POINT_IN_PATH,!0),this.m_iLastX=n,this.m_iLastY=i,t.next=42;break;case 32:if(1!==u||o.$GetStatus()!==k.POINT_STARTING||!0!==this.m_Line.$AppendPoints(r,s,this.m_iGridSizeX,this.m_iGridSizeY)){t.next=41;break}return t.next=35,this.SurroundOponentPoints();case 35:(c=t.sent).owned.length>0?(this.Debug("Closing path",0),this.rAF_FrameID=null,this.SendAsyncData(this.CreateXMLPutPathRequest(c),(function(){_.OnCancelClick(),c.OwnedPoints.forEach((function(t){var e=t.point,n=t.revertFillColor,i=t.revertStrokeColor;e.$RevertOldStatus(),e.$SetFillColor(n),e.$SetStrokeColor(i)})),_.m_bHandlingEvent=!1}))):this.Debug("".concat(c.errorDesc?c.errorDesc:"Wrong path",", cancell it or refresh page"),0),this.m_iLastX=n,this.m_iLastY=i,t.next=42;break;case 41:u>=1&&a.$GetStatus()===k.POINT_IN_PATH&&this.m_Line.$GetPointsString().endsWith("".concat(this.m_iLastX*this.m_iGridSizeX,",").concat(this.m_iLastY*this.m_iGridSizeY))&&(this.m_Line.$GetLength()>2?(a.$RevertOldStatus(),this.m_Line.$RemoveLastPoint(),this.m_iLastX=n,this.m_iLastY=i):this.OnCancelClick());case 42:t.next=51;break;case 44:return t.next=46,this.m_Points.get(this.m_iLastY*this.m_iGridWidth+this.m_iLastX);case 46:return h=t.sent,t.next=49,this.m_Points.get(i*this.m_iGridWidth+n);case 49:l=t.sent,void 0!==h&&void 0!==l&&h.$GetFillColor()===this.m_sDotColor&&l.$GetFillColor()===this.m_sDotColor&&(m=this.m_iLastX*this.m_iGridSizeX,d=this.m_iLastY*this.m_iGridSizeY,this.m_Line=S(6,m+","+d+" "+r+","+s,this.DRAWING_PATH_COLOR),this.m_CancelPath.disabled="",h.$SetStatus(k.POINT_STARTING,!0),l.$SetStatus(k.POINT_IN_PATH,!0),this.m_iLastX=n,this.m_iLastY=i);case 51:t.next=54;break;case 53:this.m_Screen.style.cursor="crosshair";case 54:case"end":return t.stop()}}),t,this)}))),function(t){return q.apply(this,arguments)})},{key:"OnMouseDown",value:(U=a(regeneratorRuntime.mark((function t(e){var n,i,r,s,a,o,u,c,h,l,m,d,_,p,f,v,g,b=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.m_bIsPlayerActive&&"???"!==this.m_Player2Name.innerHTML&&!0!==this.m_bHandlingEvent&&!(this.iConnErrCount>0)){t.next=2;break}return t.abrupt("return");case 2:if(n=(e?e.clientX:window.event.clientX)-this.m_Screen.offsetLeft+this.f_scrollLeft()+.5*this.m_iGridSizeX,i=(e?e.clientY:window.event.clientY)-this.m_Screen.offsetTop+this.f_scrollTop()+.5*this.m_iGridSizeY,n=this.m_iMouseX=parseInt(n/this.m_iGridSizeX),i=this.m_iMouseY=parseInt(i/this.m_iGridSizeY),this.m_bMouseDown=!0,this.m_bDrawLines){t.next=30;break}return this.m_iLastX=n,this.m_iLastY=i,s=i,n=(r=n)*this.m_iGridSizeX,i=s*this.m_iGridSizeY,t.next=16,this.m_Points.get(s*this.m_iGridWidth+r);case 16:if(t.t0=t.sent,t.t1=void 0,t.t0===t.t1){t.next=21;break}return this.Debug("Wrong point - already existing",0),t.abrupt("return");case 21:return t.next=23,this.IsPointOutsideAllPaths(r,s);case 23:if(t.sent){t.next=26;break}return this.Debug("Wrong point, Point is not outside all paths",0),t.abrupt("return");case 26:this.rAF_FrameID=null,this.SendAsyncData(this.CreateXMLPutPointRequest(r,s),(function(){b.m_bMouseDown=!1,b.m_bHandlingEvent=!1})),t.next=77;break;case 30:if(!((this.m_iLastX!==n||this.m_iLastY!==i)&&Math.abs(parseInt(this.m_iLastX-n))<=1&&Math.abs(parseInt(this.m_iLastY-i))<=1&&this.m_iLastX>=0&&this.m_iLastY>=0)){t.next=72;break}if(null===this.m_Line){t.next=61;break}return t.next=34,this.m_Points.get(this.m_iLastY*this.m_iGridWidth+this.m_iLastX);case 34:return a=t.sent,t.next=37,this.m_Points.get(i*this.m_iGridWidth+n);case 37:if(o=t.sent,this.m_CancelPath.disabled=this.m_Line.$GetLength()>=2?"":"disabled",void 0===a||void 0===o||a.$GetFillColor()!==this.m_sDotColor||o.$GetFillColor()!==this.m_sDotColor){t.next=59;break}if(u=n*this.m_iGridSizeX,c=i*this.m_iGridSizeY,!((h=this.m_Line.$ContainsPoint(u,c))<1&&o.$GetStatus()!==k.POINT_STARTING&&!0===this.m_Line.$AppendPoints(u,c,this.m_iGridSizeX,this.m_iGridSizeY))){t.next=49;break}o.$SetStatus(k.POINT_IN_PATH,!0),this.m_iLastX=n,this.m_iLastY=i,t.next=59;break;case 49:if(1!==h||o.$GetStatus()!==k.POINT_STARTING||!0!==this.m_Line.$AppendPoints(u,c,this.m_iGridSizeX,this.m_iGridSizeY)){t.next=58;break}return t.next=52,this.SurroundOponentPoints();case 52:(l=t.sent).owned.length>0?(this.Debug("Closing path",0),this.rAF_FrameID=null,this.SendAsyncData(this.CreateXMLPutPathRequest(l),(function(){b.OnCancelClick(),l.OwnedPoints.forEach((function(t){var e=t.point,n=t.revertFillColor,i=t.revertStrokeColor;e.$RevertOldStatus(),e.$SetFillColor(n),e.$SetStrokeColor(i)})),b.m_bMouseDown=!1,b.m_bHandlingEvent=!1}))):this.Debug("".concat(l.errorDesc?l.errorDesc:"Wrong path",", cancell it or refresh page"),0),this.m_iLastX=n,this.m_iLastY=i,t.next=59;break;case 58:h>=1&&a.$GetStatus()===k.POINT_IN_PATH&&this.m_Line.$GetPointsString().endsWith("".concat(this.m_iLastX*this.m_iGridSizeX,",").concat(this.m_iLastY*this.m_iGridSizeY))&&(this.m_Line.$GetLength()>2?(a.$RevertOldStatus(),this.m_Line.$RemoveLastPoint(),this.m_iLastX=n,this.m_iLastY=i):this.OnCancelClick());case 59:t.next=70;break;case 61:return t.next=63,this.m_Points.get(this.m_iLastY*this.m_iGridWidth+this.m_iLastX);case 63:return m=t.sent,t.next=66,this.m_Points.get(i*this.m_iGridWidth+n);case 66:d=t.sent,void 0!==m&&void 0!==d&&m.$GetFillColor()===this.m_sDotColor&&d.$GetFillColor()===this.m_sDotColor&&(_=this.m_iLastX*this.m_iGridSizeX,p=this.m_iLastY*this.m_iGridSizeY,f=n*this.m_iGridSizeX,v=i*this.m_iGridSizeY,this.m_Line=S(6,_+","+p+" "+f+","+v,this.DRAWING_PATH_COLOR),this.m_CancelPath.disabled="",m.$SetStatus(k.POINT_STARTING,!0),d.$SetStatus(k.POINT_IN_PATH,!0)),this.m_iLastX=n,this.m_iLastY=i;case 70:t.next=77;break;case 72:if(!(this.m_iLastX<0||this.m_iLastY<0)){t.next=77;break}return t.next=75,this.m_Points.get(i*this.m_iGridWidth+n);case 75:void 0!==(g=t.sent)&&g.$GetFillColor()===this.m_sDotColor&&(this.m_iLastX=n,this.m_iLastY=i);case 77:case"end":return t.stop()}}),t,this)}))),function(t){return U.apply(this,arguments)})},{key:"OnMouseUp",value:function(){this.m_bMouseDown=!1}},{key:"OnMouseLeave",value:function(){this.m_MouseCursorOval.$Hide()}},{key:"OnStopAndDraw",value:function(t){if(this.m_Timer)null===this.m_Line&&this.SendAsyncData(new A);else{null!==this.m_Line&&this.OnCancelClick(),this.m_bDrawLines=!this.m_bDrawLines;var e=t.target;this.m_bDrawLines?e.value="Draw dot":e.value="Draw line",this.m_iLastX=this.m_iLastY=-1,this.m_Line=null}}},{key:"OnCancelClick",value:(H=a(regeneratorRuntime.mark((function t(){var e,n,r,s,a,o,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.m_bDrawLines){t.next=33;break}if(null===this.m_Line){t.next=30;break}e=this.m_Line.$GetPointsArray(),this.m_CancelPath.disabled="disabled",n=i(e),t.prev=5,n.s();case 7:if((r=n.n()).done){t.next=20;break}if(s=r.value,a=s.x,o=s.y,null!==a&&null!==o){t.next=12;break}return t.abrupt("continue",18);case 12:return a/=this.m_iGridSizeX,o/=this.m_iGridSizeY,t.next=16,this.m_Points.get(o*this.m_iGridWidth+a);case 16:void 0!==(u=t.sent)&&u.$RevertOldStatus();case 18:t.next=7;break;case 20:t.next=25;break;case 22:t.prev=22,t.t0=t.catch(5),n.e(t.t0);case 25:return t.prev=25,n.f(),t.finish(25);case 28:v(this.m_Line),this.m_Line=null;case 30:this.m_iLastX=this.m_iLastY=-1,this.m_Timer&&(this.m_StopAndDraw.disabled="disabled"),this.Debug("",0);case 33:case"end":return t.stop()}}),t,this,[[5,22,25,28]])}))),function(){return H.apply(this,arguments)})},{key:"CountPointsDebug",value:function(t){var e="";[{query:"circle:not([z-index])",display:"circles: %s, "},{query:"polyline",display:"lines: %s, "},{query:"circle[data-status='2']",display:"intercepted(P1:%s, "},{query:"circle[data-status='3']",display:"P2:%s)"}].forEach((function(t){var n=document.querySelectorAll(t.query);e+=t.display.replace("%s",n.length)})),document.querySelector(t).innerHTML="SVGs by tags: "+e}},{key:"OnTestBuildCurrentGraph",value:(B=a(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),t.t0=Y,t.next=4,this.BuildGraph();case 4:t.t1=t.sent,(0,t.t0)(t.t1);case 6:case"end":return t.stop()}}),t,this)}))),function(t){return B.apply(this,arguments)})},{key:"OnTestConcaveman",value:(F=a(regeneratorRuntime.mark((function t(e){var n,r,s,a,o,u,c,h,l,m,d,_,p;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),t.next=3,this.BuildGraph();case 3:if(!((n=t.sent.vertices.map(function(t){var e=t.$GetPosition();return[e.x/this.m_iGridSizeX,e.y/this.m_iGridSizeX]}.bind(this)))&&n.length>0)){t.next=32;break}r=O.concaveman(n,2,0),S(6,r.map(function(t){return parseInt(t[0])*this.m_iGridSizeX+","+parseInt(t[1])*this.m_iGridSizeY}.bind(this)).join(" "),"green"),Y("convex_hull = ".concat(r)),s=r.map(function(t){return{x:t[0],y:t[1]}}.bind(this)),a=P(s),o="var(--orange)",u=i(a),t.prev=12,u.s();case 14:if((c=u.n()).done){t.next=24;break}return h=c.value,l=h.x,m=h.y,d=l*this.m_iGridSizeX,_=m*this.m_iGridSizeY,(p=document.querySelector('svg > circle[cx="'.concat(d,'"][cy="').concat(_,'"]')))&&(p.$SetStrokeColor(o),p.$SetFillColor(o),p.$SetZIndex(100),p.setAttribute("r","6")),t.next=22,X(50);case 22:t.next=14;break;case 24:t.next=29;break;case 26:t.prev=26,t.t0=t.catch(12),u.e(t.t0);case 29:return t.prev=29,u.f(),t.finish(29);case 32:case"end":return t.stop()}}),t,this,[[12,26,29,32]])}))),function(t){return F.apply(this,arguments)})},{key:"OnTestMarkAllCycles",value:(C=a(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),t.t0=Y,t.t1=this,t.next=5,this.BuildGraph({visuals:!0});case 5:return t.t2=t.sent,t.next=8,t.t1.MarkAllCycles.call(t.t1,t.t2);case 8:t.t3=t.sent,(0,t.t0)(t.t3);case 10:case"end":return t.stop()}}),t,this)}))),function(t){return C.apply(this,arguments)})},{key:"OnTestGroupPoints",value:(_=a(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),t.t0=S,t.t1=this,t.t2=[],t.next=6,this.m_Points.get(9*this.m_iGridWidth+26);case 6:return t.t3=t.sent,t.next=9,t.t1.GroupPointsRecurse.call(t.t1,t.t2,t.t3);case 9:t.t4=t.sent.map((function(t){var e=t.$GetPosition();return e.x+","+e.y})).join(" "),(0,t.t0)(6,t.t4,"green"),Y("game.lastCycle = ".concat(this.lastCycle));case 12:case"end":return t.stop()}}),t,this)}))),function(t){return _.apply(this,arguments)})},{key:"OnTestFindFullSurroundedPoints",value:(m=a(regeneratorRuntime.mark((function t(e){var n,r,s,a,o,u,c,h,l,m,d,_;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),n=this.COLOR_RED,r="var(--orange)",t.next=5,this.m_Points.values();case 5:s=t.sent,a=i(s),t.prev=7,a.s();case 9:if((o=a.n()).done){t.next=23;break}if(void 0===(u=o.value)||u.$GetFillColor()!==n||k.POINT_FREE_RED!==u.$GetStatus()){t.next=21;break}return c=u.$GetPosition(),h=c.x,l=c.y,m=h/this.m_iGridSizeX,d=l/this.m_iGridSizeY,t.next=16,this.IsPointOutsideAllPaths(m,d);case 16:if(t.t0=t.sent,!1!==t.t0){t.next=19;break}return t.abrupt("continue",21);case 19:(_=document.querySelector('svg > circle[cx="'.concat(h,'"][cy="').concat(l,'"]')))&&(_.$SetStrokeColor(r),_.$SetFillColor(r),_.setAttribute("r","6"));case 21:t.next=9;break;case 23:t.next=28;break;case 25:t.prev=25,t.t1=t.catch(7),a.e(t.t1);case 28:return t.prev=28,a.f(),t.finish(28);case 31:case"end":return t.stop()}}),t,this,[[7,25,28,31]])}))),function(t){return m.apply(this,arguments)})},{key:"PrepareDrawing",value:(l=a(regeneratorRuntime.mark((function t(e,n,i,r,s,a,o,u,c,h,l,m){var d,_,p,S,v,b,y=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(d=y.length>12&&void 0!==y[12]?y[12]:125,this.m_bIsWon=!1,this.m_iDelayBetweenMultiCaptures=4e3,this.m_iTooLong2Duration=d,this.m_Timer=null,this.m_WaitStartTime=null,this.m_iSlowdownLevel=0,this.m_iLastX=-1,this.m_iLastY=-1,this.m_iMouseX=0,this.m_iMouseY=0,this.m_iPosX=0,this.m_iPosY=0,this.m_bMouseDown=!1,this.m_bHandlingEvent=!1,this.m_bDrawLines=!1,this.m_sMessage="",this.m_sDotColor=this.m_bIsPlayingWithRed?this.COLOR_RED:this.COLOR_BLUE,this.m_Line=null,this.m_Debug=document.getElementById("debug0"),this.m_Player2Name=document.querySelector(n),this.m_GameStatus=document.querySelector(i),this.m_SurrenderButton=document.querySelector(r),this.m_CancelPath=document.querySelector(s),this.m_StopAndDraw=document.querySelector(o),this.m_sMsgInputSel=u,this.m_sMsgListSel=c,this.m_sMsgSendButtonSel=h,this.m_Screen=document.querySelector(e),this.m_Screen){t.next=32;break}return alert("no board"),t.abrupt("return");case 32:return this.m_iPosX=this.m_Screen.offsetLeft,this.m_iPosY=this.m_Screen.offsetTop,this.m_BoardSize={width:parseInt(this.m_Screen.style.width),height:parseInt(this.m_Screen.style.height)},_=this.m_Screen.clientWidth,p=this.m_Screen.clientHeight,this.m_iGridSizeX=parseInt(Math.ceil(_/this.m_BoardSize.width)),this.m_iGridSizeY=parseInt(Math.ceil(p/this.m_BoardSize.height)),this.m_iGridWidth=parseInt(Math.ceil(_/this.m_iGridSizeX)),this.m_iGridHeight=parseInt(Math.ceil(p/this.m_iGridSizeY)),this.m_sLastMoveGameTimeStamp=l,this.rAF_StartTimestamp=null,this.rAF_FrameID=null,this.lastCycle=[],g(this.m_Screen,this.m_Screen.style.width,this.m_Screen.style.height,!0),this.DisableSelection(this.m_Screen),S=new R(this.CreateScreenPointFromIndexedDb.bind(this),this.CreateScreenPathFromIndexedDb.bind(this),this.GetGameStateForIndexedDb.bind(this)),this.m_Lines=S.GetPathStore(),this.m_Points=S.GetPointStore(),t.next=52,S.PrepareStore(this);case 52:if(this.m_bPointsAndPathsLoaded=t.sent,!1===this.m_bViewOnly){if(null===this.m_MouseCursorOval&&(this.m_MouseCursorOval=f(this.m_PointRadius,"true"),this.m_MouseCursorOval.$SetFillColor(this.m_sDotColor),this.m_MouseCursorOval.$SetStrokeColor(this.m_sDotColor),this.m_MouseCursorOval.$SetZIndex(-1),this.m_MouseCursorOval.$Hide()),this.m_Screen.onmousedown=this.OnMouseDown.bind(this),this.m_Screen.onmousemove=this.OnMouseMove.bind(this),this.m_Screen.onmouseup=this.OnMouseUp.bind(this),this.m_Screen.onmouseleave=this.OnMouseLeave.bind(this),this.m_CancelPath.onclick=this.OnCancelClick.bind(this),this.m_StopAndDraw.onclick=this.OnStopAndDraw.bind(this),!1===this.m_bIsCPUGame)document.querySelector(this.m_sMsgInputSel).disabled="",document.getElementById("testArea").textContent="";else for(v=0,m.length>v&&(document.querySelector(m[v++]).onclick=this.OnTestBuildCurrentGraph.bind(this)),m.length>v&&(document.querySelector(m[v++]).onclick=this.OnTestConcaveman.bind(this)),m.length>v&&(document.querySelector(m[v++]).onclick=this.OnTestMarkAllCycles.bind(this)),m.length>v&&(document.querySelector(m[v++]).onclick=this.OnTestGroupPoints.bind(this)),m.length>v&&(document.querySelector(m[v++]).onclick=this.OnTestFindFullSurroundedPoints.bind(this)),b=document.getElementById("chatSection");b.lastElementChild;)b.removeChild(b.lastElementChild);this.m_SurrenderButton.disabled="","???"===this.m_Player2Name.innerHTML?(this.ShowMobileStatus("Waiting for other player to connect"),this.m_Screen.style.cursor="wait"):(this.m_SurrenderButton.value="surrender",this.m_bIsPlayerActive?(this.ShowMobileStatus("Your move"),this.m_Screen.style.cursor="crosshair",this.m_StopAndDraw.disabled=""):(this.ShowMobileStatus("Waiting for oponent move"),this.m_Screen.style.cursor="wait"),this.m_bDrawLines?this.m_StopAndDraw.value="Draw dot":this.m_StopAndDraw.value="Draw line")}else document.querySelector(a).innerHTML="back to Game List";case 54:case"end":return t.stop()}}),t,this)}))),function(t,e,n,i,r,s,a,o,u,c,h,m){return l.apply(this,arguments)})},{key:"GetRandomInt",value:function(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t}},{key:"FindRandomCPUPoint",value:(h=a(regeneratorRuntime.mark((function t(){var e,n,i,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=100;case 1:if(!(--e>0)){t.next=13;break}if(n=this.GetRandomInt(0,this.m_iGridWidth),i=this.GetRandomInt(0,this.m_iGridHeight),t.t0=!this.m_Points.has(i*this.m_iGridWidth+n),!t.t0){t.next=9;break}return t.next=8,this.IsPointOutsideAllPaths(n,i);case 8:t.t0=t.sent;case 9:if(!t.t0){t.next=11;break}return t.abrupt("break",13);case 11:t.next=1;break;case 13:return r=new G(0,this.g_iGameID,-1,n,i,k.POINT_FREE_BLUE,0),t.abrupt("return",r);case 15:case"end":return t.stop()}}),t,this)}))),function(){return h.apply(this,arguments)})},{key:"CalculateCPUCentroid",value:(c=a(regeneratorRuntime.mark((function t(){var e,n,r,s,a,o,u,c,h,l,m,d,_,p,f;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=0,n=0,r=0,o=this.COLOR_RED,t.next=4,this.m_Points.values();case 4:u=t.sent,c=i(u);try{for(c.s();!(h=c.n()).done;)void 0!==(l=h.value)&&l.$GetFillColor()===o&&l.$GetStatus()===k.POINT_FREE_RED&&(m=l.$GetPosition(),s=m.x,a=m.y,s/=this.m_iGridSizeX,a/=this.m_iGridSizeY,e+=s,n+=a,r++)}catch(t){c.e(t)}finally{c.f()}if(!(r<=0)){t.next=9;break}return t.abrupt("return",null);case 9:s=e/r,a=n/r,s*=this.m_iGridSizeX,a*=this.m_iGridSizeY,d=parseInt(s/this.m_iGridSizeX),_=parseInt(a/this.m_iGridSizeY),s=d,a=_,p=20;case 18:if(!(--p>0)){t.next=30;break}if(t.t0=!this.m_Points.has(a*this.m_iGridWidth+s),!t.t0){t.next=24;break}return t.next=23,this.IsPointOutsideAllPaths(s,a);case 23:t.t0=t.sent;case 24:if(!t.t0){t.next=26;break}return t.abrupt("break",30);case 26:s=this.GetRandomInt(d-2,d+3),a=this.GetRandomInt(_-2,_+3),t.next=18;break;case 30:if(!(p<=0)){t.next=32;break}return t.abrupt("return",null);case 32:return f=new G(0,this.g_iGameID,-1,s,a,k.POINT_FREE_BLUE,0),t.abrupt("return",f);case 34:case"end":return t.stop()}}),t,this)}))),function(){return c.apply(this,arguments)})},{key:"BuildGraph",value:(u=a(regeneratorRuntime.mark((function t(){var e,n,r,s,o,u,c,h,l,m,d,_,p,f,S,v,g,y,P,R,O=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=O.length>0&&void 0!==O[0]?O[0]:{},n=e.freeStat,r=void 0===n?k.POINT_FREE_BLUE:n,s=e.fillCol,o=void 0===s?this.COLOR_BLUE:s,u=e.visuals,c=void 0===u||u,h=[],l=new Map,m=function(t,e){var n=e.$GetStatus();return!(!t.includes(n)||e.$GetFillColor()!==o)},d=function(){var t=a(regeneratorRuntime.mark((function t(e,n,i,s,a,o,u){var d,_,p,f;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n>=0&&n<this.m_iGridWidth&&i>=0&&i<this.m_iGridHeight)){t.next=5;break}return t.next=3,this.m_Points.get(i*this.m_iGridWidth+n);case 3:(d=t.sent)&&!0===m([r],d)&&(_=d.$GetPosition(),!1===l.has("".concat(o,",").concat(u,"_").concat(n,",").concat(i))&&!1===l.has("".concat(n,",").concat(i,"_").concat(o,",").concat(u))&&(p={from:e,to:d},!0===c&&((f=b(3,"rgba(0, 255, 0, 0.3)")).$move(s,a,_.x,_.y),p.line=f),l.set("".concat(o,",").concat(u,"_").concat(n,",").concat(i),p),!1===h.includes(e)?(e.adjacents=[d],h.push(e)):h.find((function(t){return t===e})).adjacents.push(d),!1===h.includes(d)?(d.adjacents=[e],h.push(d)):h.find((function(t){return t===d})).adjacents.push(e)));case 5:case"end":return t.stop()}}),t,this)})));return function(e,n,i,r,s,a,o){return t.apply(this,arguments)}}().bind(this),t.next=6,this.m_Points.values();case 6:_=t.sent,p=i(_),t.prev=8,p.s();case 10:if((f=p.n()).done){t.next=33;break}if(!(S=f.value)||!0!==m([r,k.POINT_STARTING,k.POINT_IN_PATH],S)){t.next=31;break}return v=S.$GetPosition(),g=v.x,y=v.y,P=g/this.m_iGridSizeX,R=y/this.m_iGridSizeY,t.next=17,d(S,P+1,R,g,y,P,R);case 17:return t.next=19,d(S,P-1,R,g,y,P,R);case 19:return t.next=21,d(S,P,R-1,g,y,P,R);case 21:return t.next=23,d(S,P,R+1,g,y,P,R);case 23:return t.next=25,d(S,P-1,R-1,g,y,P,R);case 25:return t.next=27,d(S,P+1,R-1,g,y,P,R);case 27:return t.next=29,d(S,P-1,R+1,g,y,P,R);case 29:return t.next=31,d(S,P+1,R+1,g,y,P,R);case 31:t.next=10;break;case 33:t.next=38;break;case 35:t.prev=35,t.t0=t.catch(8),p.e(t.t0);case 38:return t.prev=38,p.f(),t.finish(38);case 41:return t.abrupt("return",{vertices:h,edges:Array.from(l.values())});case 42:case"end":return t.stop()}}),t,this,[[8,35,38,41]])}))),function(){return u.apply(this,arguments)})},{key:"IsGraphCyclic",value:function(t){for(var e=t.vertices,n=function(t,e){t.visited=!0;var r,s=i(t.adjacents);try{for(s.s();!(r=s.n()).done;){var a=r.value;if(a.visited){if(a!==e){var o=a.$GetPosition(),u=o.x,c=o.y,h=u/this.m_iGridSizeX,l=c/this.m_iGridSizeY;return Y("cycle found at ".concat(h,",").concat(l)),!0}}else if(n(a,t))return!0}}catch(t){s.e(t)}finally{s.f()}return!1}.bind(this),r=0;r<e.length;r++)e[r].visited=!1;for(var s=0;s<e.length;s++)if(!e[s].visited&&n(e[s],-1))return!0;return!1}},{key:"MarkAllCycles",value:(s=a(regeneratorRuntime.mark((function t(e){var n,r,s,o,u,c,h,l,m,d,_,p;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=e.vertices,r=n.length,s=new Array(r),o=new Array(r),u=new Array(r),c=new Array(r),h=0;h<r;h++)o[h]=[],s[h]=[];l=function(){var t=a(regeneratorRuntime.mark((function t(e,r){var s,a,h,m,_,p;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(2!==u[e]){t.next=2;break}return t.abrupt("return");case 2:if(1!==u[e]){t.next=8;break}for(d++,o[s=r].push(d);s!==e;)s=c[s],o[s].push(d);return t.abrupt("return");case 8:if(c[e]=r,u[e]=1,!(a=n[e])){t.next=36;break}return a.$SetStrokeColor("black"),a.$SetFillColor("black"),t.next=16,X(10);case 16:h=i(a.adjacents),t.prev=17,h.s();case 19:if((m=h.n()).done){t.next=28;break}if(_=m.value,(p=n.indexOf(_))!==c[e]){t.next=24;break}return t.abrupt("continue",26);case 24:return t.next=26,l(p,e);case 26:t.next=19;break;case 28:t.next=33;break;case 30:t.prev=30,t.t0=t.catch(17),h.e(t.t0);case 33:return t.prev=33,h.f(),t.finish(33);case 36:u[e]=2;case 37:case"end":return t.stop()}}),t,null,[[17,30,33,36]])})));return function(e,n){return t.apply(this,arguments)}}(),m=function(){var t=a(regeneratorRuntime.mark((function t(e,r){var a,o,u,c,h,l,m,_,p,f,S,v,g,b,y,R,O,w,I,x,C,G,L,E,D,T,N,A,W,M,$,F,B,z,H,U=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(a=0;a<e;a++)if(void 0!==(o=r[a])&&o.length>0)for(u=0;u<o.length;u++)void 0!==(c=s[o[u]])&&c.push(a);return s=s.filter((function(t){return t.length>=4})).sort((function(t,e){return e.length-t.length})),h=[],l=this.COLOR_RED,t.next=6,this.m_Points.values();case 6:m=t.sent,_=i(m),t.prev=8,_.s();case 10:if((p=_.n()).done){t.next=24;break}if(void 0===(f=p.value)||f.$GetFillColor()!==l||k.POINT_FREE_RED!==f.$GetStatus()){t.next=22;break}return S=f.$GetPosition(),v=S.x,g=S.y,b=v/this.m_iGridSizeX,y=g/this.m_iGridSizeY,t.next=17,this.IsPointOutsideAllPaths(b,y);case 17:if(t.t0=t.sent,!1!==t.t0){t.next=20;break}return t.abrupt("continue",22);case 20:document.querySelector('svg > circle[cx="'.concat(v,'"][cy="').concat(g,'"]'))&&h.push({x:b,y:y});case 22:t.next=10;break;case 24:t.next=29;break;case 26:t.prev=26,t.t1=t.catch(8),_.e(t.t1);case 29:return t.prev=29,_.f(),t.finish(29);case 32:R=[],O=0;case 34:if(!(O<=d)){t.next=72;break}if(!((w=s[O])&&w.length>0)){t.next=69;break}I="Cycle Number ".concat(O,": "),x=[],C="var(--indigo)",G=w.map(function(t){var e=n[t].$GetPosition();return{x:e.x/this.m_iGridSizeX,y:e.y/this.m_iGridSizeY}}.bind(this)),L=P(G),E=i(L),t.prev=42,E.s();case 44:if((D=E.n()).done){t.next=53;break}return T=D.value,N=T.x,A=T.y,(W=document.querySelector('svg > circle[cx="'.concat(N*this.m_iGridSizeX,'"][cy="').concat(A*this.m_iGridSizeY,'"]')))&&(I+="(".concat(N,",").concat(A,")"),W.$SetStrokeColor(C),W.$SetFillColor(C),W.setAttribute("r","6")),t.next=51,X(50);case 51:t.next=44;break;case 53:t.next=58;break;case 55:t.prev=55,t.t2=t.catch(42),E.e(t.t2);case 58:return t.prev=58,E.f(),t.finish(58);case 61:M="",$="",F=i(h);try{for(F.s();!(B=F.n()).done;)z=B.value,!1!==this.pnpoly2(L,z.x,z.y)&&(M+="".concat($,"(").concat(z.x,",").concat(z.y,")"),(H=document.querySelector('svg > circle[cx="'.concat(z.x*this.m_iGridSizeX,'"][cy="').concat(z.y*this.m_iGridSizeY,'"]')))&&(H.$SetStrokeColor("var(--yellow)"),H.$SetFillColor("var(--yellow)"),H.setAttribute("r","6")),$=",")}catch(t){F.e(t)}finally{F.f()}x.unshift(I),R.push(x),Y(I+(""!==M?" possible intercepts: ".concat(M):"")),Array.from(document.querySelectorAll('svg > circle[fill="'.concat(C,'"][r="6"]'))).forEach((function(t){t.$SetStrokeColor(U.COLOR_BLUE),t.$SetFillColor(U.COLOR_BLUE),t.setAttribute("r","4")}));case 69:O++,t.next=34;break;case 72:return t.abrupt("return",R);case 73:case"end":return t.stop()}}),t,this,[[8,26,29,32],[42,55,58,61]])})));return function(e,n){return t.apply(this,arguments)}}().bind(this),d=0,_=r,p=0;case 10:if(!(p<r)){t.next=16;break}return t.next=13,l(p+1,p);case 13:p++,t.next=10;break;case 16:return t.next=18,m(_,o);case 18:return t.abrupt("return",t.sent);case 19:case"end":return t.stop()}}),t,this)}))),function(t){return s.apply(this,arguments)})},{key:"GroupPointsRecurse",value:(r=a(regeneratorRuntime.mark((function t(e,n){var i,r,s,a,o,u,c,h,l,m,d,_,p,f,S,v,g,b,y;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==n&&!e.includes(n)){t.next=2;break}return t.abrupt("return",e);case 2:if(!1!==[k.POINT_FREE_BLUE,k.POINT_STARTING,k.POINT_IN_PATH].includes(n.$GetStatus())&&n.$GetFillColor()===this.COLOR_BLUE){t.next=4;break}return t.abrupt("return",e);case 4:if(i=n.$GetPosition(),r=i.x,s=i.y,r/=this.m_iGridSizeX,s/=this.m_iGridSizeY,a=null,!(e.length>0)){t.next=21;break}if(a=e[e.length-1],c=a.$GetPosition(),o=c.x,u=c.y,o/=this.m_iGridSizeX,u/=this.m_iGridSizeY,!(Math.abs(parseInt(o-r))<=1&&Math.abs(parseInt(u-s))<=1)){t.next=18;break}e.push(n),t.next=19;break;case 18:return t.abrupt("return",e);case 19:t.next=22;break;case 21:e.push(n);case 22:return e.length>2&&null!==a&&(h=e[0],(l=h.$GetPosition()).x/=this.m_iGridSizeX,l.y/=this.m_iGridSizeY,a=e[e.length-1],m=a.$GetPosition(),o=m.x,u=m.y,o/=this.m_iGridSizeX,u/=this.m_iGridSizeY,Math.abs(parseInt(o-l.x))<=1&&Math.abs(parseInt(u-l.y))<=1&&(d=[],e.forEach((function(t){return d.push(t)})),this.lastCycle.push(d))),t.next=25,this.m_Points.get(s*this.m_iGridWidth+r+1);case 25:return _=t.sent,t.next=28,this.m_Points.get(s*this.m_iGridWidth+r-1);case 28:return p=t.sent,t.next=31,this.m_Points.get((s-1)*this.m_iGridWidth+r);case 31:return f=t.sent,t.next=34,this.m_Points.get((s+1)*this.m_iGridWidth+r);case 34:return S=t.sent,t.next=37,this.m_Points.get((s-1)*this.m_iGridWidth+r-1);case 37:return v=t.sent,t.next=40,this.m_Points.get((s-1)*this.m_iGridWidth+r+1);case 40:return g=t.sent,t.next=43,this.m_Points.get((s+1)*this.m_iGridWidth+r-1);case 43:return b=t.sent,t.next=46,this.m_Points.get((s+1)*this.m_iGridWidth+r+1);case 46:if(y=t.sent,!_){t.next=50;break}return t.next=50,this.GroupPointsRecurse(e,_);case 50:if(!p){t.next=53;break}return t.next=53,this.GroupPointsRecurse(e,p);case 53:if(!f){t.next=56;break}return t.next=56,this.GroupPointsRecurse(e,f);case 56:if(!S){t.next=59;break}return t.next=59,this.GroupPointsRecurse(e,S);case 59:if(!v){t.next=62;break}return t.next=62,this.GroupPointsRecurse(e,v);case 62:if(!g){t.next=65;break}return t.next=65,this.GroupPointsRecurse(e,g);case 65:if(!b){t.next=68;break}return t.next=68,this.GroupPointsRecurse(e,b);case 68:if(!y){t.next=71;break}return t.next=71,this.GroupPointsRecurse(e,y);case 71:return t.abrupt("return",e);case 72:case"end":return t.stop()}}),t,this)}))),function(t,e){return r.apply(this,arguments)})},{key:"GroupPointsIterative",value:(n=a(regeneratorRuntime.mark((function t(){var e,n,r,s,a,o,u,c,h,l,m=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=m.length>0&&void 0!==m[0]?m[0]:{},n=e.g,r=void 0===n?null:n){t.next=3;break}return t.abrupt("return");case 3:s=r.vertices,a=[],u=i(s),t.prev=5,u.s();case 7:if((c=u.n()).done){t.next=17;break}return h=c.value,o=h,l=[],t.next=13,this.GroupPointsRecurse(l,o);case 13:t.sent.length>0&&this.lastCycle.length>0&&(a.push(this.lastCycle),this.lastCycle=[]);case 15:t.next=7;break;case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(5),u.e(t.t0);case 22:return t.prev=22,u.f(),t.finish(22);case 25:return t.abrupt("return",a);case 26:case"end":return t.stop()}}),t,this,[[5,19,22,25]])}))),function(){return n.apply(this,arguments)})},{key:"rAFCallBack",value:(e=a(regeneratorRuntime.mark((function t(e){var n,i,r,s=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return null===this.rAF_StartTimestamp&&(this.rAF_StartTimestamp=e),n=e-this.rAF_StartTimestamp,i=null,t.next=5,this.CalculateCPUCentroid();case 5:if(null===(r=t.sent)){t.next=10;break}i=r,t.next=13;break;case 10:return t.next=12,this.FindRandomCPUPoint();case 12:i=t.sent;case 13:null===i?n<2e3&&(this.rAF_FrameID=window.requestAnimationFrame(this.rAFCallBack.bind(this))):this.SendAsyncData(i,(function(){s.m_bMouseDown=!1,s.m_bHandlingEvent=!1}));case 14:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"StartCPUCalculation",value:function(){null===this.rAF_FrameID&&(this.rAF_FrameID=window.requestAnimationFrame(this.rAFCallBack.bind(this)))}}]),t}();window.addEventListener("load",a(regeneratorRuntime.mark((function t(){var e,n,i,r,s,a,o,u,c,h,l,m,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=gameOptions.inkBallHubName,n=gameOptions.iGameID,document.getElementById("gameID").innerHTML=n,document.querySelector(".container .inkgame form > input[type='hidden'][name='GameID']").value=n,i=gameOptions.iPlayerID,r=gameOptions.iOtherPlayerID,document.getElementById("playerID").innerHTML=i,s=gameOptions.bPlayingWithRed,a=gameOptions.bPlayerActive,o=gameOptions.gameType,u=gameOptions.protocol,c=gameOptions.servTimeoutMillis,h=gameOptions.isReadonly,l=gameOptions.pathAfterPointDrawAllowanceSecAmount,m=new Date(gameOptions.sLastMoveGameTimeStamp).toISOString(),t.next=17,F(gameOptions);case 17:return d=new U(n,i,r,e,signalR.LogLevel.Warning,u,signalR.HttpTransportType.None,c,o,s,a,h,l),t.next=20,d.PrepareDrawing("#screen","#Player2Name","#gameStatus","#SurrenderButton","#CancelPath","#Pause","#StopAndDraw","#messageInput","#messagesList","#sendButton",m,["#TestBuildGraph","#TestConcaveman","#TestMarkAllCycles","#TestGroupPoints","#TestFindFullSurroundedPoints"]);case 20:if(null===gameOptions.PointsAsJavaScriptArray){t.next=30;break}return t.next=23,d.StartSignalRConnection(!1);case 23:if(!1!==d.m_bPointsAndPathsLoaded){t.next=28;break}return t.next=26,d.SetAllPoints(gameOptions.PointsAsJavaScriptArray);case 26:return t.next=28,d.SetAllPaths(gameOptions.PathsAsJavaScriptArray);case 28:t.next=32;break;case 30:return t.next=32,d.StartSignalRConnection(!0);case 32:document.getElementsByClassName("whichColor")[0].style.color=s?"red":"blue",d.CountPointsDebug("#debug2"),window.game=d;case 35:case"end":return t.stop()}}),t)})))),window.addEventListener("beforeunload",(function(){window.game&&window.game.StopSignalRConnection()}))}]);